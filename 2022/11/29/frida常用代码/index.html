<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>frida常用代码 | 听说你是小兔叽的博客</title><meta name="author" content="听说你是小兔叽"><meta name="copyright" content="听说你是小兔叽"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="经常用懒得写可以来copy">
<meta property="og:type" content="article">
<meta property="og:title" content="frida常用代码">
<meta property="og:url" content="http://example.com/2022/11/29/frida%E5%B8%B8%E7%94%A8%E4%BB%A3%E7%A0%81/index.html">
<meta property="og:site_name" content="听说你是小兔叽的博客">
<meta property="og:description" content="经常用懒得写可以来copy">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/5521.png">
<meta property="article:published_time" content="2022-11-29T08:04:21.000Z">
<meta property="article:modified_time" content="2022-11-30T13:23:57.979Z">
<meta property="article:author" content="听说你是小兔叽">
<meta property="article:tag" content="frida">
<meta property="article:tag" content="基础">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/5521.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2022/11/29/frida%E5%B8%B8%E7%94%A8%E4%BB%A3%E7%A0%81/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'frida常用代码',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-11-30 21:23:57'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/favicon.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">10</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">14</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">听说你是小兔叽的博客</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">frida常用代码</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-11-29T08:04:21.000Z" title="发表于 2022-11-29 16:04:21">2022-11-29</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-11-30T13:23:57.979Z" title="更新于 2022-11-30 21:23:57">2022-11-30</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="frida常用代码"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2022/11/29/frida%E5%B8%B8%E7%94%A8%E4%BB%A3%E7%A0%81/#post-comment"><span class="gitalk-comment-count"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div><article class="post-content" id="article-container"><h1 id="JAVA"><a href="#JAVA" class="headerlink" title="JAVA"></a>JAVA</h1><h2 id="常用代码"><a href="#常用代码" class="headerlink" title="常用代码"></a>常用代码</h2><h3 id="普通函数hook"><a href="#普通函数hook" class="headerlink" title="普通函数hook"></a>普通函数hook</h3> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash">var use = Java.use(<span class="hljs-string">&quot;类名&quot;</span>);<br>var use = Java.use(<span class="hljs-string">&quot;类名&quot;</span>);<br>use.函数名.implementation = <span class="hljs-keyword">function</span> (参数)&#123;<br>    <span class="hljs-built_in">return</span> 函数名(参数);<br>&#125;<br><br>//<span class="hljs-variable">$init</span>代表构造函数<br>use.<span class="hljs-variable">$init</span>.implementation = <span class="hljs-keyword">function</span> (参数)&#123;<br>    <span class="hljs-built_in">return</span> this.<span class="hljs-variable">$init</span>(参数);<br>&#125;<br>//修改返回值<br>var use = Java.use(<span class="hljs-string">&quot;类名&quot;</span>);<br>use.函数名.implementation = <span class="hljs-keyword">function</span> (参数)&#123;<br>    var result = 1;<br>    <span class="hljs-built_in">return</span> result;<br>&#125;<br>      <br>//修改参数<br>    use.函数名.implementation = <span class="hljs-keyword">function</span>(i, str)&#123;<br>    i = 1;<br>    str = 2;<br>    <span class="hljs-built_in">let</span> ret = this.isGridInScreen(i, str);<br>    <span class="hljs-built_in">return</span> ret;<br>&#125;;<br>//hook重载函数<br>use.函数名.overload(<span class="hljs-string">&quot;参数列表&quot;</span>).implementation = <span class="hljs-keyword">function</span> (A)&#123;<br><span class="hljs-built_in">return</span> this.函数名(A);<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="函数名或者类名加密函数"><a href="#函数名或者类名加密函数" class="headerlink" title="函数名或者类名加密函数"></a>函数名或者类名加密函数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">let</span> use = Java.use(<span class="hljs-string">&quot;com.baidu.\u96C6\u5408&quot;</span>);<br>    use[<span class="hljs-string">&quot;\u53D6\u9879\u76EE\u603B\u6570&quot;</span>].implementation = <span class="hljs-function"><span class="hljs-title">function</span></span> () &#123;<br>        console.log(<span class="hljs-string">&#x27;\u53D6\u9879\u76EE\u603B\u6570 is called&#x27;</span>);<br>        <span class="hljs-built_in">let</span> ret = this[<span class="hljs-string">&quot;\u53D6\u9879\u76EE\u603B\u6570&quot;</span>]();<br>        console.log(<span class="hljs-string">&#x27;\u53D6\u9879\u76EE\u603B\u6570 ret value is &#x27;</span> + ret);<br>        <span class="hljs-built_in">return</span> ret;<br>    &#125;;<br></code></pre></td></tr></table></figure>
<h3 id="frida-主动调用"><a href="#frida-主动调用" class="headerlink" title="frida 主动调用"></a>frida 主动调用</h3><h4 id="静态函数"><a href="#静态函数" class="headerlink" title="静态函数"></a>静态函数</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">let</span> use = Java.use(<span class="hljs-string">&quot;类名&quot;</span>);<br>var ret = use.getString(<span class="hljs-string">&quot;参数&quot;</span>);<br></code></pre></td></tr></table></figure>
<h4 id="非静态函数"><a href="#非静态函数" class="headerlink" title="非静态函数"></a>非静态函数</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">//hook实例方法  实例方法需要获取到类的对象 才能调用<br><span class="hljs-built_in">let</span> use = Java.use(<span class="hljs-string">&quot;类名&quot;</span>).<span class="hljs-variable">$new</span>();<br>var ret = use.getString(<span class="hljs-string">&quot;参数&quot;</span>);<br><br>//或者在hook到某个函数时<br> <span class="hljs-built_in">let</span> ComposeMessageView = Java.use(<span class="hljs-string">&quot;com.android.messaging.ui.conversation.ComposeMessageView&quot;</span>);<br>ComposeMessageView[<span class="hljs-string">&quot;sendMessageInternal&quot;</span>].implementation = <span class="hljs-keyword">function</span> (z) &#123;<br>    console.log(<span class="hljs-string">&#x27;sendMessageInternal is called&#x27;</span> + <span class="hljs-string">&#x27;, &#x27;</span> + <span class="hljs-string">&#x27;z: &#x27;</span> + z);<br>    //this 就是当前类的对象<br>    this.getString();<br>    <span class="hljs-built_in">let</span> ret = this.sendMessageInternal(z);<br>    console.log(<span class="hljs-string">&#x27;sendMessageInternal ret value is &#x27;</span> + ret);<br>    <span class="hljs-built_in">return</span> ret;<br>&#125;;<br><br>//在或者 在内存中搜索需要调用的类的对象<br>Java.choose(<span class="hljs-string">&quot;com.android.messaging.ui.conversation.ComposeMessageView&quot;</span>,&#123;<br>    onMatch: <span class="hljs-keyword">function</span> (obj)&#123;<br>        console.log(<span class="hljs-string">&quot;内存中每找到一次就会调用一次&quot;</span>);<br>        //实例方法的第三种种调用方式<br>        obj.getString();<br>    &#125;,<br>    onComplete:<span class="hljs-function"><span class="hljs-title">function</span></span> ()&#123;<br>        console.log(<span class="hljs-string">&quot;内存中搜索完毕后执行&quot;</span>)<br>    &#125;<br>&#125;);<br><br></code></pre></td></tr></table></figure>
<h3 id="堆栈代码的打印-打印异常输出信息"><a href="#堆栈代码的打印-打印异常输出信息" class="headerlink" title="堆栈代码的打印 打印异常输出信息"></a>堆栈代码的打印 打印异常输出信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">var <span class="hljs-built_in">log</span> = Java.use(<span class="hljs-string">&quot;android.util.Log&quot;</span>).getStackTraceString(Java.use(<span class="hljs-string">&quot;java.lang.Throwable&quot;</span>).<span class="hljs-variable">$new</span>());<br> console.log(<span class="hljs-built_in">log</span>);<br></code></pre></td></tr></table></figure>



<h3 id="hookMethods"><a href="#hookMethods" class="headerlink" title="hookMethods"></a>hookMethods</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">tuzihookMethods</span></span>()&#123;<br>    var utils = Java.use(<span class="hljs-string">&quot;com.tuzi&quot;</span>);<br>    var methods = utils.class.getDeclaredMethods();<br>    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">let</span> j = 0; j &lt;methods.length ; j++) &#123;<br>        <span class="hljs-built_in">let</span> methodName = methods[j].getName();<br>        var overloadsArr = utils[methodName].overloads;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">let</span> i = 0; i &lt; overloadsArr.length; i++) &#123;<br>            overloadsArr[i].implementation = <span class="hljs-function"><span class="hljs-title">function</span></span> () &#123;<br>                var params = <span class="hljs-string">&quot;&quot;</span>;<br>                <span class="hljs-keyword">for</span> (<span class="hljs-built_in">let</span> j = 0; j &lt; arguments.length; j++) &#123;<br>                    params += arguments[j] + <span class="hljs-string">&quot; &quot;</span>;<br>                &#125;<br>                console.log(<span class="hljs-string">&quot;utils.getCalc is called! params is: &quot;</span>, params);<br>                console.log(this);<br>                <span class="hljs-built_in">return</span> this[methodName].apply(this, arguments);<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="enumclass"><a href="#enumclass" class="headerlink" title="enumclass"></a>enumclass</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">tuzienumclass</span></span>()&#123;<br>    Java.perform(<span class="hljs-function"><span class="hljs-title">function</span></span> ()&#123;<br>        //枚举所有已加载的类<br>        // console.log(Java.enumerateLoadedClassesSync().<span class="hljs-built_in">join</span>(<span class="hljs-string">&quot;\n&quot;</span>));<br>        // console.log(Java.enumerateLoadedClassesSync().length);<br>        //java反射<br>        Java.openClassFile(<span class="hljs-string">&quot;/data/local/tmp/out.dex&quot;</span>).load();<br>        var wallet = Java.use(<span class="hljs-string">&quot;com.example.myapplication.MainActivity&quot;</span>);<br>        var Methods = wallet.class.getDeclaredMethods();<br>        var Constructors = wallet.class.getDeclaredConstructors();<br>        var Fiedlds = wallet.class.getDeclaredFields();<br>        var Classes = wallet.class.getDeclaredClasses();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">let</span> i = 0; i &lt; Constructors.length; i++) &#123;<br>            console.log(<span class="hljs-string">&quot;构造函数&quot;</span>+Constructors[i].getName());<br>        &#125;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">let</span> i = 0; i &lt; Methods.length; i++) &#123;<br>            console.log(<span class="hljs-string">&quot;函数&quot;</span>+Methods[i].getName());<br>        &#125;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">let</span> i = 0; i &lt; Fiedlds.length; i++) &#123;<br>            console.log(<span class="hljs-string">&quot;字段&quot;</span>+Fiedlds[i].getName());<br>        &#125;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">let</span> i = 0; i &lt; Classes.length; i++) &#123;<br>            console.log(<span class="hljs-string">&quot;内部类&quot;</span>+Classes[i].getName());<br>            var Wallet<span class="hljs-variable">$InnerStructure</span> = Classes[i].getDeclaredFields();<br>            var Wallet<span class="hljs-variable">$InnerStructureMethods</span> = Classes[i].getDeclaredMethods();<br>            var Wallet<span class="hljs-variable">$InnerStructuregetConstructors</span> = Classes[i].getDeclaredConstructors();<br><br>            <span class="hljs-keyword">for</span> (<span class="hljs-built_in">let</span> j = 0; j &lt; Wallet<span class="hljs-variable">$InnerStructure</span>.length; j++) &#123;<br>               console.log(<span class="hljs-string">&quot;内部类字段&quot;</span>+Wallet<span class="hljs-variable">$InnerStructure</span>[j].getName());<br>            &#125;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-built_in">let</span> j = 0; j &lt; Wallet<span class="hljs-variable">$InnerStructureMethods</span>.length; j++) &#123;<br>                console.log(<span class="hljs-string">&quot;内部类方法&quot;</span>+Wallet<span class="hljs-variable">$InnerStructureMethods</span>[j].getName());<br>            &#125;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-built_in">let</span> j = 0; j &lt; Wallet<span class="hljs-variable">$InnerStructuregetConstructors</span>.length; j++) &#123;<br>                console.log(<span class="hljs-string">&quot;内部类构造方法&quot;</span>+Wallet<span class="hljs-variable">$InnerStructuregetConstructors</span>[j].getName());<br>            &#125;<br>        &#125;<br><br>    &#125;);<br>&#125;<br><br><br></code></pre></td></tr></table></figure>





<h3 id="注入dex"><a href="#注入dex" class="headerlink" title="注入dex"></a>注入dex</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">tuziopenDex</span></span>()&#123;<br>    Java.perform(<span class="hljs-function"><span class="hljs-title">function</span></span> ()&#123;<br>        Java.openClassFile(<span class="hljs-string">&quot;/data/local/tmp/dexfile.dex&quot;</span>).load();<br>        var use = Java.use(<span class="hljs-string">&quot;android.content.Intent&quot;</span>);<br>        var dialog = Java.use(<span class="hljs-string">&quot;com.example.myapplication.dialog&quot;</span>);<br>        use.<span class="hljs-variable">$init</span>.overload(<span class="hljs-string">&#x27;android.content.Context&#x27;</span>, <span class="hljs-string">&#x27;java.lang.Class&#x27;</span>).implementation = <span class="hljs-keyword">function</span> (a,b)&#123;<br>            //console.log(a+b);<br>            dialog.showAlterDialog(a);<br>        &#125;<br>&#125;);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="启动activity"><a href="#启动activity" class="headerlink" title="启动activity"></a>启动activity</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">var ActivityThread = Java.use(<span class="hljs-string">&quot;android.app.ActivityThread&quot;</span>);<br>       var application = ActivityThread.currentApplication();<br>       //获取context<br>       var context = application.getApplicationContext();<br>       console.log(context);<br>       var FridaActivity7 = Java.use(<span class="hljs-string">&quot;com.github.lastingyang.androiddemo.Activity.FridaActivity7&quot;</span>);<br>       var Intent = Java.use(<span class="hljs-string">&quot;android.content.Intent&quot;</span>);<br>       Java.scheduleOnMainThread(<span class="hljs-function"><span class="hljs-title">function</span></span>() &#123;<br>           var intent = Intent.<span class="hljs-variable">$new</span>(context, FridaActivity7.<span class="hljs-variable">$new</span>().getClass());<br>           intent.setFlags(0x10000000);<br>           console.log(intent);<br>           context.startActivity(intent);<br>       &#125;)<br></code></pre></td></tr></table></figure>
<h3 id="getContext"><a href="#getContext" class="headerlink" title="getContext"></a>getContext</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">var current_application = Java.use(<span class="hljs-string">&#x27;android.app.ActivityThread&#x27;</span>).currentApplication();<br>var context = current_application.getApplicationContext();<br></code></pre></td></tr></table></figure>

<h3 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">tuzicast</span></span>()&#123;<br>    Java.perform(<span class="hljs-function"><span class="hljs-title">function</span></span> ()&#123;<br>        //JAVA.cast<br>       // 向上转型的，不能用toString直接得到结果，比如Map、List类型的打印会输出objcet<br>        var utils = Java.use(<span class="hljs-string">&quot;com.tuzi&quot;</span>);<br>        utils.shufferMap2.implementation = <span class="hljs-keyword">function</span> (map) &#123;<br>            console.log(<span class="hljs-string">&quot;map: &quot;</span>, map);<br>            var result = Java.cast(map, Java.use(<span class="hljs-string">&quot;java.util.HashMap&quot;</span>));<br>            console.log(<span class="hljs-string">&quot;map: &quot;</span>, result);<br>            <span class="hljs-built_in">return</span> this.shufferMap2(result);<br>        &#125;<br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="构造数组"><a href="#构造数组" class="headerlink" title="构造数组"></a>构造数组</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">tuziArray</span></span>()&#123;<br>    Java.perform(<span class="hljs-function"><span class="hljs-title">function</span></span> ()&#123;<br>        <span class="hljs-built_in">let</span> Utils = Java.use(<span class="hljs-string">&quot;com.tuzi&quot;</span>);<br>        var  strarr = Java.array(<br>            <span class="hljs-string">&quot;Ljava.lang.String&quot;</span>, //数组类型<br>            [<span class="hljs-string">&quot;sjaldhja&quot;</span>,<span class="hljs-string">&quot;sakhydo8iqw&quot;</span>,<span class="hljs-string">&quot;sajwiqo&quot;</span>,<span class="hljs-string">&quot;zutiaji&quot;</span>]<br>        );<br><br>        var bool = Java.use(<span class="hljs-string">&#x27;java.lang.Boolean&#x27;</span>);<br>        var Integer = Java.use(<span class="hljs-string">&#x27;java.lang.Integer&#x27;</span>);<br>        var  strarr1 = Java.array(<br>            <span class="hljs-string">&quot;Ljava.lang.Object&quot;</span>, //数组类型<br>            [Integer.<span class="hljs-variable">$init</span>(100),bool.<span class="hljs-variable">$init</span>(<span class="hljs-literal">true</span>),<span class="hljs-string">&quot;sajwiqo&quot;</span>,<span class="hljs-string">&quot;zutiaji&quot;</span>]<br>        );<br><br>     //   var retval = Utils.myPrint([<span class="hljs-string">&quot;tuzi&quot;</span>,<span class="hljs-string">&quot;Frida&quot;</span>,<span class="hljs-string">&quot;lalla&quot;</span>]);<br>        var retval = Utils.myPrint(strarr1);<br>        console.log(retval)<br>    &#125;);<br>&#125;<br><br></code></pre></td></tr></table></figure>
<h3 id="加载so"><a href="#加载so" class="headerlink" title="加载so"></a>加载so</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">tuziloadlibrary</span></span>()&#123;<br>    Java.perform(<span class="hljs-function"><span class="hljs-title">function</span></span> ()&#123;<br>        <span class="hljs-built_in">let</span> SplshActivity = Java.use(<span class="hljs-string">&quot;com.hange.hangevip.SplshActivity&quot;</span>);<br>        SplshActivity.onCreate.implementation = <span class="hljs-keyword">function</span>(bundle)&#123;<br>            console.log(<span class="hljs-string">&#x27;onCreate is called&#x27;</span>);<br>            <span class="hljs-built_in">let</span> ret = this.onCreate(bundle);<br>            console.log(<span class="hljs-string">&#x27;onCreate ret value is &#x27;</span> + ret);<br>            var system = Java.use(<span class="hljs-string">&quot;java.lang.System&quot;</span>);<br>            system.loadLibrary(<span class="hljs-string">&quot;neonuijni_public&quot;</span>);<br>            // var targetSo = Module.findBaseAddress(<span class="hljs-string">&#x27;libneonuijni_public.so&#x27;</span>);<br>            //hook_suspected_function(targetSo);<br>            <span class="hljs-built_in">return</span> ret;<br>        &#125;;<br>    &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>


<h2 id="常用的定位手段"><a href="#常用的定位手段" class="headerlink" title="常用的定位手段"></a>常用的定位手段</h2><h3 id="定位弹窗"><a href="#定位弹窗" class="headerlink" title="定位弹窗"></a>定位弹窗</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">showStack</span></span>()&#123;<br>    console.log(Java.use(<span class="hljs-string">&quot;android.util.Log&quot;</span>).getStackTraceString(Java.use(<span class="hljs-string">&quot;java.lang.Throwable&quot;</span>).<span class="hljs-variable">$new</span>()));<br>&#125;<br>var toast = Java.use(<span class="hljs-string">&quot;android.widget.Toast&quot;</span>);<br>toast.show.implementation = <span class="hljs-function"><span class="hljs-title">function</span></span> () &#123;<br>    showStack();<br>    <span class="hljs-built_in">return</span> this.show();<br>&#125;<br><br>var Dialog = Java.use(<span class="hljs-string">&quot;android.app.Dialog&quot;</span>);<br>    Dialog.setCancelable.implementation = <span class="hljs-keyword">function</span> (bool)&#123;<br>    showStack();<br>    this.setCancelable(bool);<br>&#125;<br><br></code></pre></td></tr></table></figure>
<h3 id="String的getBytes、isEmpty方法"><a href="#String的getBytes、isEmpty方法" class="headerlink" title="String的getBytes、isEmpty方法"></a>String的getBytes、isEmpty方法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs bahs">    var str = Java.use(&quot;java.lang.String&quot;);<br>    str.getBytes.overload().implementation = function () &#123;<br>        showStack();<br>        var result = this.getBytes();<br>        var newStr = str.$new(result);<br>        console.log(&quot;str.getBytes result: &quot;, newStr);<br>        return result;<br>    &#125;<br>    str.getBytes.overload(&#x27;java.lang.String&#x27;).implementation = function (a) &#123;<br>        showStack();<br>        var result = this.getBytes(a);<br>        var newStr = str.$new(result, a);<br>        console.log(&quot;str.getBytes result: &quot;, newStr);<br>        return result;<br>    &#125;<br><br>    str.split.overload(&#x27;java.lang.String&#x27;).implementation = function (s)&#123;<br>        var ret = this.split(s);<br>        console.log(ret);<br>        return ret;<br>    &#125;<br>    str.split.overload(&#x27;java.lang.String&#x27;, &#x27;int&#x27;).implementation = function (s,i)&#123;<br>        var ret = this.split(s,i);<br>        console.log(ret);<br>        return ret;<br>    &#125;<br>    var StringBuffer = Java.use(&quot;java.lang.StringBuffer&quot;);<br><br><br>    str.getBytes.overload().implementation = function () &#123;<br>        //    showStack();<br>        var result = this.getBytes();<br>        var newStr = str.$new(result);<br>        console.log(&quot;str.getBytes result: &quot;, newStr);<br>        return result;<br>    &#125;<br>    str.getBytes.overload(&#x27;java.lang.String&#x27;).implementation = function (a) &#123;<br>//        showStack();<br>        console.log(&quot;str.getBytes crete: &quot;, a);<br>        var result = this.getBytes(a);<br>        var newStr = str.$new(result, a);<br>        console.log(&quot;str.getBytes result: &quot;, newStr);<br>        return result;<br>    &#125;<br><br>    StringBuffer.toString.implementation = function () &#123;<br>        var result = this.toString.apply(this, arguments);<br>        console.log(result);<br>        var result = this.toString();<br>        console.log(result);<br>        return result;<br>    &#125;<br><br><br>    str.valueOf.overload(&#x27;int&#x27;).implementation = function (c)&#123;<br>        var ret = this.valueOf(c);<br>        console.log(ret);<br>        return ret;<br>    &#125;<br><br>    str.valueOf.overload(&#x27;char&#x27;).implementation = function ()&#123;<br>        var ret = this.valueOf();<br>        console.log(ret);<br>        return ret;<br>    &#125;<br></code></pre></td></tr></table></figure>

<h3 id="getContext-1"><a href="#getContext-1" class="headerlink" title="getContext"></a>getContext</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">var current_application = Java.use(<span class="hljs-string">&#x27;android.app.ActivityThread&#x27;</span>).currentApplication();<br>var context = current_application.getApplicationContext();<br></code></pre></td></tr></table></figure>

<h3 id="hookJSON"><a href="#hookJSON" class="headerlink" title="hookJSON"></a>hookJSON</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">var jSONObject = Java.use(<span class="hljs-string">&quot;org.json.JSONObject&quot;</span>);<br> jSONObject.getString.implementation = <span class="hljs-keyword">function</span> (a) &#123;<br>     console.log(<span class="hljs-string">&quot;jSONObject.getString: &quot;</span>, a);<br>     var result = this.getString(a);<br>     console.log(<span class="hljs-string">&quot;jSONObject.getString result: &quot;</span>, result);<br>     <span class="hljs-built_in">return</span> result;<br> &#125;<br> jSONObject.optString.overload(<span class="hljs-string">&#x27;java.lang.String&#x27;</span>).implementation = <span class="hljs-keyword">function</span> (a) &#123;<br>     console.log(<span class="hljs-string">&quot;jSONObject.optString: &quot;</span>, a);<br>     var result = this.optString(a);<br>     console.log(<span class="hljs-string">&quot;jSONObject.optString result: &quot;</span>, result);<br>     <span class="hljs-built_in">return</span> result;<br> &#125;<br> jSONObject.<span class="hljs-variable">$init</span>.overload(<span class="hljs-string">&#x27;java.lang.String&#x27;</span>).implementation = <span class="hljs-keyword">function</span> (s)&#123;<br><br>     console.log(s);<br>     var result = this.<span class="hljs-variable">$init</span>(s);<br>     console.log(<span class="hljs-string">&quot;jSONObject.<span class="hljs-variable">$init</span> result: &quot;</span>, result);<br>     <span class="hljs-built_in">return</span> result;<br> &#125;<br> var JSONArray = Java.use(<span class="hljs-string">&quot;org.json.JSONArray&quot;</span>);<br> JSONArray.getJSONObject.overload(<span class="hljs-string">&#x27;int&#x27;</span>).implementation = <span class="hljs-keyword">function</span> (i)&#123;<br>     console.log(<span class="hljs-string">&quot;JSONArray.getJSONObject: &quot;</span>,i);<br>     var reslut = this.getJSONObject(i);<br>     console.log(<span class="hljs-string">&quot;JSONArray.getJSONObject: &quot;</span>,reslut);<br>     <span class="hljs-built_in">return</span> reslut;<br> &#125;<br></code></pre></td></tr></table></figure>

<h3 id="hook加固的app"><a href="#hook加固的app" class="headerlink" title="hook加固的app"></a>hook加固的app</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">Java.perform(<span class="hljs-function"><span class="hljs-title">function</span></span> () &#123;<br>    var application = Java.use(<span class="hljs-string">&#x27;android.app.Application&#x27;</span>);<br>    application.attach.overload(<span class="hljs-string">&#x27;android.content.Context&#x27;</span>).implementation = <span class="hljs-keyword">function</span> (context) &#123;<br>        var result = this.attach(context);<br>        var classloader = context.getClassLoader();<br>        Java.classFactory.loader = classloader;<br>        var activation = Java.classFactory.use(<span class="hljs-string">&#x27;com.baidu.input.activation&#x27;</span>);<br>        console.log(<span class="hljs-string">&quot;activation:&quot;</span> + activation);<br>        activation.aaa.implementation = <span class="hljs-keyword">function</span> (z) &#123;<br>            console.log(<span class="hljs-string">&#x27;aaa is called&#x27;</span> + <span class="hljs-string">&#x27;, &#x27;</span> + <span class="hljs-string">&#x27;z: &#x27;</span> + z);<br>            <span class="hljs-built_in">let</span> ret = this.aaa(z);<br>            console.log(<span class="hljs-string">&#x27;aaa ret value is &#x27;</span> + ret);<br>            <span class="hljs-built_in">return</span> ret;<br>        &#125;;<br>    &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>

<h2 id="java层的各种好用工具"><a href="#java层的各种好用工具" class="headerlink" title="java层的各种好用工具"></a>java层的各种好用工具</h2><h3 id="r0trace-肉丝大佬"><a href="#r0trace-肉丝大佬" class="headerlink" title="r0trace   肉丝大佬"></a>r0trace   肉丝大佬</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br></pre></td><td class="code"><pre><code class="hljs bash">var isLite = <span class="hljs-literal">false</span>;<br>var ByPassTracerPid = <span class="hljs-function"><span class="hljs-title">function</span></span> () &#123;<br>    var fgetsPtr = Module.findExportByName(<span class="hljs-string">&quot;libc.so&quot;</span>, <span class="hljs-string">&quot;fgets&quot;</span>);<br>    var fgets = new NativeFunction(fgetsPtr, <span class="hljs-string">&#x27;pointer&#x27;</span>, [<span class="hljs-string">&#x27;pointer&#x27;</span>, <span class="hljs-string">&#x27;int&#x27;</span>, <span class="hljs-string">&#x27;pointer&#x27;</span>]);<br>    Interceptor.replace(fgetsPtr, new NativeCallback(<span class="hljs-keyword">function</span> (buffer, size, fp) &#123;<br>        var retval = fgets(buffer, size, fp);<br>        var bufstr = Memory.readUtf8String(buffer);<br>        <span class="hljs-keyword">if</span> (bufstr.indexOf(<span class="hljs-string">&quot;TracerPid:&quot;</span>) &gt; -1) &#123;<br>            Memory.writeUtf8String(buffer, <span class="hljs-string">&quot;TracerPid:\t0&quot;</span>);<br>            console.log(<span class="hljs-string">&quot;tracerpid replaced: &quot;</span> + Memory.readUtf8String(buffer));<br>        &#125;<br>        <span class="hljs-built_in">return</span> retval;<br>    &#125;, <span class="hljs-string">&#x27;pointer&#x27;</span>, [<span class="hljs-string">&#x27;pointer&#x27;</span>, <span class="hljs-string">&#x27;int&#x27;</span>, <span class="hljs-string">&#x27;pointer&#x27;</span>]));<br>&#125;;<br>setImmediate(ByPassTracerPid);<br><br>(<span class="hljs-function"><span class="hljs-title">function</span></span>()&#123;<br>    <span class="hljs-built_in">let</span> Color = &#123;RESET: <span class="hljs-string">&quot;\x1b[39;49;00m&quot;</span>, Black: <span class="hljs-string">&quot;0;01&quot;</span>, Blue: <span class="hljs-string">&quot;4;01&quot;</span>, Cyan: <span class="hljs-string">&quot;6;01&quot;</span>, Gray: <span class="hljs-string">&quot;7;11&quot;</span>, <span class="hljs-string">&quot;Green&quot;</span>: <span class="hljs-string">&quot;2;01&quot;</span>, Purple: <span class="hljs-string">&quot;5;01&quot;</span>, Red: <span class="hljs-string">&quot;1;01&quot;</span>, Yellow: <span class="hljs-string">&quot;3;01&quot;</span>&#125;;<br>    <span class="hljs-built_in">let</span> LightColor = &#123;RESET: <span class="hljs-string">&quot;\x1b[39;49;00m&quot;</span>, Black: <span class="hljs-string">&quot;0;11&quot;</span>, Blue: <span class="hljs-string">&quot;4;11&quot;</span>, Cyan: <span class="hljs-string">&quot;6;11&quot;</span>, Gray: <span class="hljs-string">&quot;7;01&quot;</span>, <span class="hljs-string">&quot;Green&quot;</span>: <span class="hljs-string">&quot;2;11&quot;</span>, Purple: <span class="hljs-string">&quot;5;11&quot;</span>, Red: <span class="hljs-string">&quot;1;11&quot;</span>, Yellow: <span class="hljs-string">&quot;3;11&quot;</span>&#125;;    <br>    var colorPrefix = <span class="hljs-string">&#x27;\x1b[3&#x27;</span>, colorSuffix = <span class="hljs-string">&#x27;m&#x27;</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">let</span> c <span class="hljs-keyword">in</span> Color)&#123;<br>        <span class="hljs-keyword">if</span> (c  == <span class="hljs-string">&quot;RESET&quot;</span>) <span class="hljs-built_in">continue</span>;<br>        console[c] = <span class="hljs-keyword">function</span>(message)&#123;<br>            console.log(colorPrefix + Color[c] + colorSuffix + message + Color.RESET);<br>        &#125;<br>        console[<span class="hljs-string">&quot;Light&quot;</span> + c] = <span class="hljs-keyword">function</span>(message)&#123;<br>            console.log(colorPrefix + LightColor[c] + colorSuffix + message + Color.RESET);<br>        &#125;<br>    &#125;<br>&#125;)();<br><span class="hljs-keyword">function</span> uniqBy(array, key) &#123;<br>    var seen = &#123;&#125;;<br>    <span class="hljs-built_in">return</span> array.filter(<span class="hljs-keyword">function</span> (item) &#123;<br>        var k = key(item);<br>        <span class="hljs-built_in">return</span> seen.hasOwnProperty(k) ? <span class="hljs-literal">false</span> : (seen[k] = <span class="hljs-literal">true</span>);<br>    &#125;);<br>&#125;<br><span class="hljs-keyword">function</span> hasOwnProperty(obj, name) &#123;<br>    try &#123;<br>        <span class="hljs-built_in">return</span> obj.hasOwnProperty(name) || name <span class="hljs-keyword">in</span> obj;<br>    &#125; catch (e) &#123;<br>        <span class="hljs-built_in">return</span> obj.hasOwnProperty(name);<br>    &#125;<br>&#125;<br><span class="hljs-keyword">function</span> getHandle(object) &#123;<br>    <span class="hljs-keyword">if</span> (hasOwnProperty(object, <span class="hljs-string">&#x27;$handle&#x27;</span>)) &#123;<br>        <span class="hljs-keyword">if</span> (object.<span class="hljs-variable">$handle</span> != undefined) &#123;<br>            <span class="hljs-built_in">return</span> object.<span class="hljs-variable">$handle</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (hasOwnProperty(object, <span class="hljs-string">&#x27;$h&#x27;</span>)) &#123;<br>        <span class="hljs-keyword">if</span> (object.<span class="hljs-variable">$h</span> != undefined) &#123;<br>            <span class="hljs-built_in">return</span> object.<span class="hljs-variable">$h</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-built_in">return</span> null;<br>&#125;<br>//查看域值<br><span class="hljs-keyword">function</span> inspectObject(obj, input) &#123;<br>    var isInstance = <span class="hljs-literal">false</span>;<br>    var obj_class = null;<br>    <span class="hljs-keyword">if</span> (getHandle(obj) === null) &#123;<br>        obj_class = obj.class;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        var Class = Java.use(<span class="hljs-string">&quot;java.lang.Class&quot;</span>);<br>        obj_class = Java.cast(obj.getClass(), Class);<br>        isInstance = <span class="hljs-literal">true</span>;<br>    &#125;<br>    input = input.concat(<span class="hljs-string">&quot;Inspecting Fields: =&gt; &quot;</span>, isInstance, <span class="hljs-string">&quot; =&gt; &quot;</span>, obj_class.toString());<br>    input = input.concat(<span class="hljs-string">&quot;\r\n&quot;</span>)<br>    var fields = obj_class.getDeclaredFields();<br>    <span class="hljs-keyword">for</span> (var i <span class="hljs-keyword">in</span> fields) &#123;<br>        <span class="hljs-keyword">if</span> (isInstance || Boolean(fields[i].toString().indexOf(<span class="hljs-string">&quot;static &quot;</span>) &gt;= 0)) &#123;<br>            // output = output.concat(<span class="hljs-string">&quot;\t\t static static static &quot;</span> + fields[i].toString());<br>            var className = obj_class.toString().trim().<span class="hljs-built_in">split</span>(<span class="hljs-string">&quot; &quot;</span>)[1];<br>            // console.Red(<span class="hljs-string">&quot;className is =&gt; &quot;</span>,className);<br>            var fieldName = fields[i].toString().<span class="hljs-built_in">split</span>(className.concat(<span class="hljs-string">&quot;.&quot;</span>)).pop();<br>            var fieldType = fields[i].toString().<span class="hljs-built_in">split</span>(<span class="hljs-string">&quot; &quot;</span>).slice(-2)[0];<br>            var fieldValue = undefined;<br>            <span class="hljs-keyword">if</span> (!(obj[fieldName] === undefined))<br>                fieldValue = obj[fieldName].value;<br>            input = input.concat(fieldType + <span class="hljs-string">&quot; \t&quot;</span> + fieldName + <span class="hljs-string">&quot; =&gt; &quot;</span>, fieldValue + <span class="hljs-string">&quot; =&gt; &quot;</span>, JSON.stringify(fieldValue));<br>            input = input.concat(<span class="hljs-string">&quot;\r\n&quot;</span>)<br>        &#125;<br>    &#125;<br>    <span class="hljs-built_in">return</span> input;<br>&#125;<br><br>// trace单个类的所有静态和实例方法包括构造方法 trace a specific Java Method<br><span class="hljs-keyword">function</span> traceMethod(targetClassMethod) &#123;<br>    var delim = targetClassMethod.lastIndexOf(<span class="hljs-string">&quot;.&quot;</span>);<br>    <span class="hljs-keyword">if</span> (delim === -1) <span class="hljs-built_in">return</span>;<br>    var targetClass = targetClassMethod.slice(0, delim)<br>    var targetMethod = targetClassMethod.slice(delim + 1, targetClassMethod.length)<br>    var hook = Java.use(targetClass);<br>    var overloadCount = hook[targetMethod].overloads.length;<br>    console.Red(<span class="hljs-string">&quot;Tracing Method : &quot;</span> + targetClassMethod + <span class="hljs-string">&quot; [&quot;</span> + overloadCount + <span class="hljs-string">&quot; overload(s)]&quot;</span>);<br>    <span class="hljs-keyword">for</span> (var i = 0; i &lt; overloadCount; i++) &#123;<br>        hook[targetMethod].overloads[i].implementation = <span class="hljs-function"><span class="hljs-title">function</span></span> () &#123;<br>            //初始化输出<br>            var output = <span class="hljs-string">&quot;&quot;</span>;<br>            //画个横线<br>            <span class="hljs-keyword">for</span> (var p = 0; p &lt; 100; p++) &#123;<br>                output = output.concat(<span class="hljs-string">&quot;==&quot;</span>);<br>            &#125;<br>            //域值<br>            <span class="hljs-keyword">if</span> (!isLite) &#123; output = inspectObject(this, output); &#125;<br>            //进入函数<br>            output = output.concat(<span class="hljs-string">&quot;\n*** entered &quot;</span> + targetClassMethod);<br>            output = output.concat(<span class="hljs-string">&quot;\r\n&quot;</span>)<br>            // <span class="hljs-keyword">if</span> (arguments.length) console.Black();<br>            //参数<br>            var retval = this[targetMethod].apply(this, arguments);<br>            <span class="hljs-keyword">if</span> (!isLite) &#123;<br>                <span class="hljs-keyword">for</span> (var j = 0; j &lt; arguments.length; j++) &#123;<br>                    output = output.concat(<span class="hljs-string">&quot;arg[&quot;</span> + j + <span class="hljs-string">&quot;]: &quot;</span> + arguments[j] + <span class="hljs-string">&quot; =&gt; &quot;</span> + JSON.stringify(arguments[j]));<br>                    output = output.concat(<span class="hljs-string">&quot;\r\n&quot;</span>)<br>                &#125;<br>                //调用栈<br>                output = output.concat(Java.use(<span class="hljs-string">&quot;android.util.Log&quot;</span>).getStackTraceString(Java.use(<span class="hljs-string">&quot;java.lang.Throwable&quot;</span>).<span class="hljs-variable">$new</span>()));<br>                //返回值<br>                output = output.concat(<span class="hljs-string">&quot;\nretval: &quot;</span> + retval + <span class="hljs-string">&quot; =&gt; &quot;</span> + JSON.stringify(retval));<br>            &#125;<br>            // inspectObject(this)<br>            //离开函数<br>            output = output.concat(<span class="hljs-string">&quot;\n*** exiting &quot;</span> + targetClassMethod);<br>            //最终输出<br>            // console.Black(output);<br>            var r = parseInt((Math.random() * 7).toFixed(0));<br>            var i = r;<br>            var printOutput = null;<br>            switch (i) &#123;<br>                <span class="hljs-keyword">case</span> 1:<br>                    printOutput = console.Red;<br>                    <span class="hljs-built_in">break</span>;<br>                <span class="hljs-keyword">case</span> 2:<br>                    printOutput = console.Yellow;<br>                    <span class="hljs-built_in">break</span>;<br>                <span class="hljs-keyword">case</span> 3:<br>                    printOutput = console.Green;<br>                    <span class="hljs-built_in">break</span>;<br>                <span class="hljs-keyword">case</span> 4:<br>                    printOutput = console.Cyan;<br>                    <span class="hljs-built_in">break</span>;<br>                <span class="hljs-keyword">case</span> 5:<br>                    printOutput = console.Blue;<br>                    <span class="hljs-built_in">break</span>;<br>                <span class="hljs-keyword">case</span> 6:<br>                    printOutput = console.Gray;<br>                    <span class="hljs-built_in">break</span>;<br>                default:<br>                    printOutput = console.Purple;<br>            &#125;<br>            printOutput(output);<br>            <span class="hljs-built_in">return</span> retval;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">function</span> traceClass(targetClass) &#123;<br>    //Java.use是新建一个对象哈，大家还记得么？<br>    var hook = Java.use(targetClass);<br>    //利用反射的方式，拿到当前类的所有方法<br>    var methods = hook.class.getDeclaredMethods();    <br>    //建完对象之后记得将对象释放掉哈<br>    hook.<span class="hljs-variable">$dispose</span>;<br>    //将方法名保存到数组中<br>    var parsedMethods = [];<br>    var output = <span class="hljs-string">&quot;&quot;</span>;    <br>    output = output.concat(<span class="hljs-string">&quot;\tSpec: =&gt; \r\n&quot;</span>)<br>    methods.forEach(<span class="hljs-keyword">function</span> (method) &#123;<br>        output = output.concat(method.toString())<br>        output = output.concat(<span class="hljs-string">&quot;\r\n&quot;</span>)<br>        parsedMethods.push(method.toString().replace(targetClass + <span class="hljs-string">&quot;.&quot;</span>, <span class="hljs-string">&quot;TOKEN&quot;</span>).match(/\sTOKEN(.*)\(/)[1]);<br>    &#125;);<br>    //去掉一些重复的值<br>    var Targets = uniqBy(parsedMethods, JSON.stringify);<br>    // targets = [];<br>    var constructors = hook.class.getDeclaredConstructors();<br>    <span class="hljs-keyword">if</span> (constructors.length &gt; 0) &#123;<br>        constructors.forEach(<span class="hljs-keyword">function</span> (constructor) &#123;<br>            output = output.concat(<span class="hljs-string">&quot;Tracing &quot;</span>, constructor.toString())<br>            output = output.concat(<span class="hljs-string">&quot;\r\n&quot;</span>)<br>        &#125;)<br>        Targets = Targets.concat(<span class="hljs-string">&quot;<span class="hljs-variable">$init</span>&quot;</span>)<br>    &#125;<br>    //对数组中所有的方法进行hook，<br>    Targets.forEach(<span class="hljs-keyword">function</span> (targetMethod) &#123;<br>        traceMethod(targetClass + <span class="hljs-string">&quot;.&quot;</span> + targetMethod);<br>    &#125;);<br>    //画个横线<br>    <span class="hljs-keyword">for</span> (var p = 0; p &lt; 100; p++) &#123;<br>        output = output.concat(<span class="hljs-string">&quot;+&quot;</span>);<br>    &#125;<br>    console.Green(output);<br>&#125;<br><span class="hljs-keyword">function</span> hook(white, black, target = null) &#123;<br>    console.Red(<span class="hljs-string">&quot;start&quot;</span>)<br>    <span class="hljs-keyword">if</span> (!(target === null)) &#123;<br>        console.LightGreen(<span class="hljs-string">&quot;Begin enumerateClassLoaders ...&quot;</span>)<br>        Java.enumerateClassLoaders(&#123;<br>            onMatch: <span class="hljs-keyword">function</span> (loader) &#123;<br>                try &#123;<br>                    <span class="hljs-keyword">if</span> (loader.findClass(target)) &#123;<br>                        console.Red(<span class="hljs-string">&quot;Successfully found loader&quot;</span>)<br>                        console.Blue(loader);<br>                        Java.classFactory.loader = loader;<br>                        console.Red(<span class="hljs-string">&quot;Switch Classloader Successfully ! &quot;</span>)<br>                    &#125;<br>                &#125;<br>                catch (error) &#123;<br>                    console.Red(<span class="hljs-string">&quot; continuing :&quot;</span> + error)<br>                &#125;<br>            &#125;,<br>            onComplete: <span class="hljs-function"><span class="hljs-title">function</span></span> () &#123;<br>                console.Red(<span class="hljs-string">&quot;EnumerateClassloader END&quot;</span>)<br>            &#125;<br>        &#125;)<br>    &#125;<br>    console.Red(<span class="hljs-string">&quot;Begin Search Class...&quot;</span>)<br>    var targetClasses = new Array();<br>    Java.enumerateLoadedClasses(&#123;<br>        onMatch: <span class="hljs-keyword">function</span> (className) &#123;<br>            <span class="hljs-keyword">if</span> (className.toString().toLowerCase().indexOf(white.toLowerCase()) &gt;= 0 &amp;&amp;<br>               (black == null || black == <span class="hljs-string">&#x27;&#x27;</span> || className.toString().toLowerCase().indexOf(black.toLowerCase()) &lt; 0)) &#123;<br>                console.Black(<span class="hljs-string">&quot;Found Class =&gt; &quot;</span> + className)<br>                targetClasses.push(className);<br>                traceClass(className);<br>            &#125;<br>        &#125;, onComplete: <span class="hljs-function"><span class="hljs-title">function</span></span> () &#123;<br>            console.Black(<span class="hljs-string">&quot;Search Class Completed!&quot;</span>)<br>        &#125;<br>    &#125;)<br>    var output = <span class="hljs-string">&quot;On Total Tracing :&quot;</span>+String(targetClasses.length)+<span class="hljs-string">&quot; classes :\r\n&quot;</span>;<br>    targetClasses.forEach(<span class="hljs-keyword">function</span>(target)&#123;<br>        output = output.concat(target);<br>        output = output.concat(<span class="hljs-string">&quot;\r\n&quot;</span>)        <br>    &#125;)<br>    console.Green(output+<span class="hljs-string">&quot;Start Tracing ...&quot;</span>)<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">main</span></span>() &#123;<br>    Java.perform(<span class="hljs-function"><span class="hljs-title">function</span></span> () &#123;<br>        console.Purple(<span class="hljs-string">&quot;r0tracer begin ... !&quot;</span>)<br>        //0. 增加精简模式，就是以彩虹色只显示进出函数。默认是关闭的，注释此行打开精简模式。<br>        //isLite = <span class="hljs-literal">true</span>;<br>        /*<br>        //以下三种模式，取消注释某一行以开启<br>        */<br>        //A. 简易trace单个函数<br>        traceClass(<span class="hljs-string">&quot;javax.crypto.Cipher&quot;</span>)<br>        //B. 黑白名单trace多个函数，第一个参数是白名单(包含关键字)，第二个参数是黑名单(不包含的关键字)<br>        // hook(<span class="hljs-string">&quot;javax.crypto.Cipher&quot;</span>, <span class="hljs-string">&quot;$&quot;</span>);<br>        //C. 报某个类找不到时，将某个类名填写到第三个参数，比如找不到com.roysue.check类。（前两个参数依旧是黑白名单）<br>        // hook(<span class="hljs-string">&quot;com.roysue.check&quot;</span>,<span class="hljs-string">&quot; &quot;</span>,<span class="hljs-string">&quot;com.roysue.check&quot;</span>);        <br>    &#125;)<br>&#125;<br>/*<br>//setImmediate是立即执行函数，setTimeout是等待毫秒后延迟执行函数<br>//二者在attach模式下没有区别<br>//在spawn模式下，hook系统API时如javax.crypto.Cipher建议使用setImmediate立即执行，不需要延时<br>//在spawn模式下，hook应用自己的函数或含壳时，建议使用setTimeout并给出适当的延时(500~5000)<br>*/<br>setImmediate(main)<br>//<br>// setTimeout(main, 2000);<br><br><br>// 玄之又玄，众妙之门<br>// Frida的崩溃有时候真的是玄学，大项目一崩溃根本不知道是哪里出的问题，这也是小而专的项目也有一丝机会的原因<br>// Frida自身即会经常崩溃，建议多更换Frida(客/服要配套)版本/安卓版本，我自己常用的组合是两部手机，Frida12.8.0全家桶+安卓8.1.0，和Frida14.2.2全家桶+安卓10 <br></code></pre></td></tr></table></figure>

<h3 id="dump证书"><a href="#dump证书" class="headerlink" title="dump证书"></a>dump证书</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">dump</span></span>()&#123;<br>    <span class="hljs-built_in">let</span> path = <span class="hljs-string">&quot;/data/data/com.feigua.yingshi/tuzi.p12&quot;</span><br>    Java.perform(<span class="hljs-function"><span class="hljs-title">function</span></span> () &#123;<br>        var KeyStore = Java.use(<span class="hljs-string">&quot;java.security.KeyStore&quot;</span>);<br>        var str = Java.use(<span class="hljs-string">&quot;java.lang.String&quot;</span>);<br>        KeyStore.load.overload(<span class="hljs-string">&quot;java.io.InputStream&quot;</span>, <span class="hljs-string">&quot;[C&quot;</span>).implementation = <span class="hljs-keyword">function</span> (input, pwdStr) &#123;<br>            <span class="hljs-keyword">if</span> (input) &#123;<br>                console.log(<span class="hljs-string">&quot;pwdStr: &quot;</span>, str.<span class="hljs-variable">$new</span>(pwdStr));<br>                var file = Java.use(<span class="hljs-string">&quot;java.io.File&quot;</span>).<span class="hljs-variable">$new</span>(path);<br>                var output = Java.use(<span class="hljs-string">&quot;java.io.FileOutputStream&quot;</span>).<span class="hljs-variable">$new</span>(file);<br>                var r, myArr = [];<br>                <span class="hljs-keyword">for</span> (var i = 0; i &lt; 1024; i++) &#123;<br>                    myArr[i] = 0;<br>                &#125;<br>                var buffer = Java.array(<span class="hljs-string">&quot;byte&quot;</span>, myArr);<br>                <span class="hljs-keyword">while</span>((r = input.read(buffer)) &gt; 0) &#123;<br>                    output.write(buffer, 0, r);<br>                &#125;<br>                console.log(<span class="hljs-string">&quot;save&quot;</span>);<br>                output.close();<br>            &#125;<br>            <span class="hljs-built_in">return</span> this.load(input, pwdStr);<br>        &#125;<br>    <br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="r0capture"><a href="#r0capture" class="headerlink" title="r0capture"></a>r0capture</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br>(<span class="hljs-function"><span class="hljs-title">function</span></span>()&#123;<br><br><span class="hljs-string">&quot;use strict&quot;</span>;<br>rpc.exports = &#123;<br>  setssllib: <span class="hljs-keyword">function</span> (name) &#123;<br>    console.log(<span class="hljs-string">&quot;setSSLLib =&gt; &quot;</span> + name);<br>    libname = name;<br>    initializeGlobals();<br>    <span class="hljs-built_in">return</span>;<br>  &#125;<br>&#125;;<br><br>var addresses = &#123;&#125;;<br>var SSL_get_fd = null;<br>var SSL_get_session = null;<br>var SSL_SESSION_get_id = null;<br>var getpeername = null;<br>var getsockname = null;<br>var ntohs = null;<br>var ntohl = null;<br>var SSLstackwrite = null;<br>var SSLstackread = null;<br><br>var libname = <span class="hljs-string">&quot;*libssl*&quot;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">initMessage</span></span>()&#123;<br>  var message=&#123;&#125;;<br>  message[<span class="hljs-string">&quot;jsname&quot;</span>]=<span class="hljs-string">&quot;r0capture&quot;</span>;<br>  <span class="hljs-built_in">return</span> message;<br>&#125;<br><br><span class="hljs-keyword">function</span> uuid(len, radix) &#123;<br>  var chars = <span class="hljs-string">&#x27;0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz&#x27;</span>.<span class="hljs-built_in">split</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>  var uuid = [], i;<br>  radix = radix || chars.length;<br><br>  <span class="hljs-keyword">if</span> (len) &#123;<br>    // Compact form<br>    <span class="hljs-keyword">for</span> (i = 0; i &lt; len; i++) uuid[i] = chars[0 | Math.random() * radix];<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    // rfc4122, version 4 form<br>    var r;<br><br>    // rfc4122 requires these characters<br>    uuid[8] = uuid[13] = uuid[18] = uuid[23] = <span class="hljs-string">&#x27;-&#x27;</span>;<br>    uuid[14] = <span class="hljs-string">&#x27;4&#x27;</span>;<br><br>    // Fill <span class="hljs-keyword">in</span> random data. At i==19 <span class="hljs-built_in">set</span> the high bits of clock sequence as<br>    // per rfc4122, sec. 4.1.5<br>    <span class="hljs-keyword">for</span> (i = 0; i &lt; 36; i++) &#123;<br>      <span class="hljs-keyword">if</span> (!uuid[i]) &#123;<br>        r = 0 | Math.random() * 16;<br>        uuid[i] = chars[(i == 19) ? (r &amp; 0x3) | 0x8 : r];<br>      &#125;<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-built_in">return</span> uuid.join(<span class="hljs-string">&#x27;&#x27;</span>);<br>&#125;<br><span class="hljs-keyword">function</span> return_zero(args) &#123;<br>  <span class="hljs-built_in">return</span> 0;<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">initializeGlobals</span></span>() &#123;<br>  var resolver = new ApiResolver(<span class="hljs-string">&quot;module&quot;</span>);<br>  var exps = [<br>    [Process.platform == <span class="hljs-string">&quot;darwin&quot;</span> ? <span class="hljs-string">&quot;*libboringssl*&quot;</span> : <span class="hljs-string">&quot;*libssl*&quot;</span>, [<span class="hljs-string">&quot;SSL_read&quot;</span>, <span class="hljs-string">&quot;SSL_write&quot;</span>, <span class="hljs-string">&quot;SSL_get_fd&quot;</span>, <span class="hljs-string">&quot;SSL_get_session&quot;</span>, <span class="hljs-string">&quot;SSL_SESSION_get_id&quot;</span>]], // <span class="hljs-keyword">for</span> ios and Android<br>    [Process.platform == <span class="hljs-string">&quot;darwin&quot;</span> ? <span class="hljs-string">&quot;*libsystem*&quot;</span> : <span class="hljs-string">&quot;*libc*&quot;</span>, [<span class="hljs-string">&quot;getpeername&quot;</span>, <span class="hljs-string">&quot;getsockname&quot;</span>, <span class="hljs-string">&quot;ntohs&quot;</span>, <span class="hljs-string">&quot;ntohl&quot;</span>]]<br>  ];<br>  // console.logs(exps)<br>  <span class="hljs-keyword">for</span> (var i = 0; i &lt; exps.length; i++) &#123;<br>    var lib = exps[i][0];<br>    var names = exps[i][1];<br>    <span class="hljs-keyword">for</span> (var j = 0; j &lt; names.length; j++) &#123;<br>      var name = names[j];<br>      // console.logs(<span class="hljs-string">&quot;exports:&quot;</span> + lib + <span class="hljs-string">&quot;!&quot;</span> + name)<br>      var matches = resolver.enumerateMatchesSync(<span class="hljs-string">&quot;exports:&quot;</span> + lib + <span class="hljs-string">&quot;!&quot;</span> + name);<br>      <span class="hljs-keyword">if</span> (matches.length == 0) &#123;<br>        <span class="hljs-keyword">if</span> (name == <span class="hljs-string">&quot;SSL_get_fd&quot;</span>) &#123;<br>          addresses[<span class="hljs-string">&quot;SSL_get_fd&quot;</span>] = 0;<br>          <span class="hljs-built_in">continue</span>;<br>        &#125;<br>        throw <span class="hljs-string">&quot;Could not find &quot;</span> + lib + <span class="hljs-string">&quot;!&quot;</span> + name;<br>      &#125;<br>      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (matches.length != 1) &#123;<br>        // Sometimes Frida returns duplicates.<br>        var address = 0;<br>        var s = <span class="hljs-string">&quot;&quot;</span>;<br>        var duplicates_only = <span class="hljs-literal">true</span>;<br>        <span class="hljs-keyword">for</span> (var k = 0; k &lt; matches.length; k++) &#123;<br>          <span class="hljs-keyword">if</span> (s.length != 0) &#123;<br>            s += <span class="hljs-string">&quot;, &quot;</span>;<br>          &#125;<br>          s += matches[k].name + <span class="hljs-string">&quot;@&quot;</span> + matches[k].address;<br>          <span class="hljs-keyword">if</span> (address == 0) &#123;<br>            address = matches[k].address;<br>          &#125;<br>          <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!address.equals(matches[k].address)) &#123;<br>            duplicates_only = <span class="hljs-literal">false</span>;<br>          &#125;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (!duplicates_only) &#123;<br>          throw <span class="hljs-string">&quot;More than one match found for &quot;</span> + lib + <span class="hljs-string">&quot;!&quot;</span> + name + <span class="hljs-string">&quot;: &quot;</span> + s;<br>        &#125;<br>      &#125;<br>      addresses[name] = matches[0].address;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">if</span> (addresses[<span class="hljs-string">&quot;SSL_get_fd&quot;</span>] == 0) &#123;<br>    SSL_get_fd = return_zero;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    SSL_get_fd = new NativeFunction(addresses[<span class="hljs-string">&quot;SSL_get_fd&quot;</span>], <span class="hljs-string">&quot;int&quot;</span>, [<span class="hljs-string">&quot;pointer&quot;</span>]);<br>  &#125;<br>  SSL_get_session = new NativeFunction(addresses[<span class="hljs-string">&quot;SSL_get_session&quot;</span>], <span class="hljs-string">&quot;pointer&quot;</span>, [<span class="hljs-string">&quot;pointer&quot;</span>]);<br>  SSL_SESSION_get_id = new NativeFunction(addresses[<span class="hljs-string">&quot;SSL_SESSION_get_id&quot;</span>], <span class="hljs-string">&quot;pointer&quot;</span>, [<span class="hljs-string">&quot;pointer&quot;</span>, <span class="hljs-string">&quot;pointer&quot;</span>]);<br>  getpeername = new NativeFunction(addresses[<span class="hljs-string">&quot;getpeername&quot;</span>], <span class="hljs-string">&quot;int&quot;</span>, [<span class="hljs-string">&quot;int&quot;</span>, <span class="hljs-string">&quot;pointer&quot;</span>, <span class="hljs-string">&quot;pointer&quot;</span>]);<br>  getsockname = new NativeFunction(addresses[<span class="hljs-string">&quot;getsockname&quot;</span>], <span class="hljs-string">&quot;int&quot;</span>, [<span class="hljs-string">&quot;int&quot;</span>, <span class="hljs-string">&quot;pointer&quot;</span>, <span class="hljs-string">&quot;pointer&quot;</span>]);<br>  ntohs = new NativeFunction(addresses[<span class="hljs-string">&quot;ntohs&quot;</span>], <span class="hljs-string">&quot;uint16&quot;</span>, [<span class="hljs-string">&quot;uint16&quot;</span>]);<br>  ntohl = new NativeFunction(addresses[<span class="hljs-string">&quot;ntohl&quot;</span>], <span class="hljs-string">&quot;uint32&quot;</span>, [<span class="hljs-string">&quot;uint32&quot;</span>]);<br>&#125;<br>initializeGlobals();<br><br><span class="hljs-keyword">function</span> ipToNumber(ip) &#123;<br>  var num = 0;<br>  <span class="hljs-keyword">if</span> (ip == <span class="hljs-string">&quot;&quot;</span>) &#123;<br>    <span class="hljs-built_in">return</span> num;<br>  &#125;<br>  var aNum = ip.split(<span class="hljs-string">&quot;.&quot;</span>);<br>  <span class="hljs-keyword">if</span> (aNum.length != 4) &#123;<br>    <span class="hljs-built_in">return</span> num;<br>  &#125;<br>  num += parseInt(aNum[0]) &lt;&lt; <span class="hljs-string">0;</span><br><span class="hljs-string">  num += parseInt(aNum[1]) &lt;&lt; 8;</span><br><span class="hljs-string">  num += parseInt(aNum[2]) &lt;&lt; 16;</span><br><span class="hljs-string">  num += parseInt(aNum[3]) &lt;&lt; 24;</span><br><span class="hljs-string">  num = num &gt;&gt;&gt; 0</span>;//这个很关键，不然可能会出现负数的情况<br>  <span class="hljs-built_in">return</span> num;<br>&#125;<br><br>/**<br> * Returns a dictionary of a sockfd<span class="hljs-string">&#x27;s &quot;src_addr&quot;, &quot;src_port&quot;, &quot;dst_addr&quot;, and</span><br><span class="hljs-string"> * &quot;dst_port&quot;.</span><br><span class="hljs-string"> * @param &#123;int&#125; sockfd The file descriptor of the socket to inspect.</span><br><span class="hljs-string"> * @param &#123;boolean&#125; isRead If true, the context is an SSL_read call. If</span><br><span class="hljs-string"> *     false, the context is an SSL_write call.</span><br><span class="hljs-string"> * @return &#123;dict&#125; Dictionary of sockfd&#x27;</span>s <span class="hljs-string">&quot;src_addr&quot;</span>, <span class="hljs-string">&quot;src_port&quot;</span>, <span class="hljs-string">&quot;dst_addr&quot;</span>,<br> *     and <span class="hljs-string">&quot;dst_port&quot;</span>.<br> */<br><span class="hljs-keyword">function</span> getPortsAndAddresses(sockfd, isRead) &#123;<br>  var message = initMessage();<br>  var src_dst = [<span class="hljs-string">&quot;src&quot;</span>, <span class="hljs-string">&quot;dst&quot;</span>];<br>  <span class="hljs-keyword">for</span> (var i = 0; i &lt; src_dst.length; i++) &#123;<br>    <span class="hljs-keyword">if</span> ((src_dst[i] == <span class="hljs-string">&quot;src&quot;</span>) ^ isRead) &#123;<br>      var sockAddr = Socket.localAddress(sockfd)<br>    &#125;<br>    <span class="hljs-keyword">else</span> &#123;<br>      var sockAddr = Socket.peerAddress(sockfd)<br>    &#125;<br>    <span class="hljs-keyword">if</span> (sockAddr == null) &#123;<br>      // 网络超时or其他原因可能导致socket被关闭<br>      message[src_dst[i] + <span class="hljs-string">&quot;_port&quot;</span>] = 0<br>      message[src_dst[i] + <span class="hljs-string">&quot;_addr&quot;</span>] = 0<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      message[src_dst[i] + <span class="hljs-string">&quot;_port&quot;</span>] = (sockAddr.port &amp; 0xFFFF)<br>      message[src_dst[i] + <span class="hljs-string">&quot;_addr&quot;</span>] = ntohl(ipToNumber(sockAddr.ip.split(<span class="hljs-string">&quot;:&quot;</span>).pop()))<br>    &#125;<br>  &#125;<br>  <span class="hljs-built_in">return</span> message;<br>&#125;<br>/**<br> * Get the session_id of SSL object and <span class="hljs-built_in">return</span> it as a hex string.<br> * @param &#123;!NativePointer&#125; ssl A pointer to an SSL object.<br> * @<span class="hljs-built_in">return</span> &#123;dict&#125; A string representing the session_id of the SSL object<span class="hljs-string">&#x27;s</span><br><span class="hljs-string"> *     SSL_SESSION. For example,</span><br><span class="hljs-string"> *     &quot;59FD71B7B90202F359D89E66AE4E61247954E28431F6C6AC46625D472FF76336&quot;.</span><br><span class="hljs-string"> */</span><br><span class="hljs-string">function getSslSessionId(ssl) &#123;</span><br><span class="hljs-string">  var session = SSL_get_session(ssl);</span><br><span class="hljs-string">  if (session == 0) &#123;</span><br><span class="hljs-string">    return 0;</span><br><span class="hljs-string">  &#125;</span><br><span class="hljs-string">  var len = Memory.alloc(4);</span><br><span class="hljs-string">  var p = SSL_SESSION_get_id(session, len);</span><br><span class="hljs-string">  len = Memory.readU32(len);</span><br><span class="hljs-string">  var session_id = &quot;&quot;;</span><br><span class="hljs-string">  for (var i = 0; i &lt; len; i++) &#123;</span><br><span class="hljs-string">    // Read a byte, convert it to a hex string (0xAB ==&gt; &quot;AB&quot;), and append</span><br><span class="hljs-string">    // it to session_id.</span><br><span class="hljs-string">    session_id +=</span><br><span class="hljs-string">      (&quot;0&quot; + Memory.readU8(p.add(i)).toString(16).toUpperCase()).substr(-2);</span><br><span class="hljs-string">  &#125;</span><br><span class="hljs-string">  return session_id;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">Interceptor.attach(addresses[&quot;SSL_read&quot;],</span><br><span class="hljs-string">  &#123;</span><br><span class="hljs-string">    onEnter: function (args) &#123;</span><br><span class="hljs-string">      var message = getPortsAndAddresses(SSL_get_fd(args[0]), true);</span><br><span class="hljs-string">      message[&quot;ssl_session_id&quot;] = getSslSessionId(args[0]);</span><br><span class="hljs-string">      message[&quot;function&quot;] = &quot;SSL_read&quot;;</span><br><span class="hljs-string">      message[&quot;stack&quot;] = SSLstackread;</span><br><span class="hljs-string">      this.message = message;</span><br><span class="hljs-string">      this.buf = args[1];</span><br><span class="hljs-string">    &#125;,</span><br><span class="hljs-string">    onLeave: function (retval) &#123;</span><br><span class="hljs-string">      retval |= 0; // Cast retval to 32-bit integer.</span><br><span class="hljs-string">      if (retval &lt;= 0) &#123;</span><br><span class="hljs-string">        return;</span><br><span class="hljs-string">      &#125;</span><br><span class="hljs-string">      send(this.message,Memory.readByteArray(this.buf, retval) );</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">  &#125;);</span><br><span class="hljs-string"></span><br><span class="hljs-string">Interceptor.attach(addresses[&quot;SSL_write&quot;],</span><br><span class="hljs-string">  &#123;</span><br><span class="hljs-string">    onEnter: function (args) &#123;</span><br><span class="hljs-string">      var message = getPortsAndAddresses(SSL_get_fd(args[0]), false);</span><br><span class="hljs-string">      message[&quot;ssl_session_id&quot;] = getSslSessionId(args[0]);</span><br><span class="hljs-string">      message[&quot;function&quot;] = &quot;SSL_write&quot;;</span><br><span class="hljs-string">      message[&quot;stack&quot;] = SSLstackwrite;</span><br><span class="hljs-string">      send(message,Memory.readByteArray(args[1], parseInt(args[2])) );</span><br><span class="hljs-string">    &#125;,</span><br><span class="hljs-string">    onLeave: function (retval) &#123;</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">  &#125;);</span><br><span class="hljs-string"></span><br><span class="hljs-string">if (Java.available) &#123;</span><br><span class="hljs-string">  Java.perform(function () &#123;</span><br><span class="hljs-string">    var msg=initMessage()</span><br><span class="hljs-string">    msg[&quot;init&quot;]=&quot;r0capture.js init hook success&quot;</span><br><span class="hljs-string">    send(msg)</span><br><span class="hljs-string">    function storeP12(pri, p7, p12Path, p12Password) &#123;</span><br><span class="hljs-string">      var X509Certificate = Java.use(&quot;java.security.cert.X509Certificate&quot;)</span><br><span class="hljs-string">      var p7X509 = Java.cast(p7, X509Certificate);</span><br><span class="hljs-string">      var chain = Java.array(&quot;java.security.cert.X509Certificate&quot;, [p7X509])</span><br><span class="hljs-string">      var ks = Java.use(&quot;java.security.KeyStore&quot;).getInstance(&quot;PKCS12&quot;, &quot;BC&quot;);</span><br><span class="hljs-string">      ks.load(null, null);</span><br><span class="hljs-string">      ks.setKeyEntry(&quot;client&quot;, pri, Java.use(&#x27;</span>java.lang.String<span class="hljs-string">&#x27;).$new(p12Password).toCharArray(), chain);</span><br><span class="hljs-string">      try &#123;</span><br><span class="hljs-string">        var out = Java.use(&quot;java.io.FileOutputStream&quot;).$new(p12Path);</span><br><span class="hljs-string">        ks.store(out, Java.use(&#x27;</span>java.lang.String<span class="hljs-string">&#x27;).$new(p12Password).toCharArray())</span><br><span class="hljs-string">      &#125; catch (exp) &#123;</span><br><span class="hljs-string">        console.log(exp)</span><br><span class="hljs-string">      &#125;</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">    //在服务器校验客户端的情形下，帮助dump客户端证书，并保存为p12的格式，证书密码为r0ysue</span><br><span class="hljs-string">    Java.use(&quot;java.security.KeyStore$PrivateKeyEntry&quot;).getPrivateKey.implementation = function () &#123;</span><br><span class="hljs-string">      var result = this.getPrivateKey()</span><br><span class="hljs-string">      var packageName = Java.use(&quot;android.app.ActivityThread&quot;).currentApplication().getApplicationContext().getPackageName();</span><br><span class="hljs-string">      storeP12(this.getPrivateKey(), this.getCertificate(), &#x27;</span>/sdcard/Download/<span class="hljs-string">&#x27; + packageName + uuid(10, 16) + &#x27;</span>.p12<span class="hljs-string">&#x27;, &#x27;</span>r0ysue<span class="hljs-string">&#x27;);</span><br><span class="hljs-string">      var message = initMessage();</span><br><span class="hljs-string">      message[&quot;function&quot;] = &quot;dumpClinetCertificate=&gt;&quot; + &#x27;</span>/sdcard/Download/<span class="hljs-string">&#x27; + packageName + uuid(10, 16) + &#x27;</span>.p12<span class="hljs-string">&#x27; + &#x27;</span>   <span class="hljs-built_in">pwd</span>: r0ysue<span class="hljs-string">&#x27;;</span><br><span class="hljs-string">      message[&quot;stack&quot;] = Java.use(&quot;android.util.Log&quot;).getStackTraceString(Java.use(&quot;java.lang.Throwable&quot;).$new());</span><br><span class="hljs-string">      var data = Memory.alloc(1);</span><br><span class="hljs-string">      send(message, Memory.readByteArray(data, 1))</span><br><span class="hljs-string">      return result;</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">    Java.use(&quot;java.security.KeyStore$PrivateKeyEntry&quot;).getCertificateChain.implementation = function () &#123;</span><br><span class="hljs-string">      var result = this.getCertificateChain()</span><br><span class="hljs-string">      var packageName = Java.use(&quot;android.app.ActivityThread&quot;).currentApplication().getApplicationContext().getPackageName();</span><br><span class="hljs-string">      storeP12(this.getPrivateKey(), this.getCertificate(), &#x27;</span>/sdcard/Download/<span class="hljs-string">&#x27; + packageName + uuid(10, 16) + &#x27;</span>.p12<span class="hljs-string">&#x27;, &#x27;</span>r0ysue<span class="hljs-string">&#x27;);</span><br><span class="hljs-string">      var message = initMessage();</span><br><span class="hljs-string">      message[&quot;function&quot;] = &quot;dumpClinetCertificate=&gt;&quot; + &#x27;</span>/sdcard/Download/<span class="hljs-string">&#x27; + packageName + uuid(10, 16) + &#x27;</span>.p12<span class="hljs-string">&#x27; + &#x27;</span>   <span class="hljs-built_in">pwd</span>: r0ysue<span class="hljs-string">&#x27;;</span><br><span class="hljs-string">      message[&quot;stack&quot;] = Java.use(&quot;android.util.Log&quot;).getStackTraceString(Java.use(&quot;java.lang.Throwable&quot;).$new());</span><br><span class="hljs-string">      var data = Memory.alloc(1);</span><br><span class="hljs-string">      send(message, Memory.readByteArray(data, 1))</span><br><span class="hljs-string">      return result;</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">    //SSLpinning helper 帮助定位证书绑定的关键代码</span><br><span class="hljs-string">    Java.use(&quot;java.io.File&quot;).$init.overload(&#x27;</span>java.io.File<span class="hljs-string">&#x27;, &#x27;</span>java.lang.String<span class="hljs-string">&#x27;).implementation = function (file, cert) &#123;</span><br><span class="hljs-string">      var result = this.$init(file, cert)</span><br><span class="hljs-string">      var stack = Java.use(&quot;android.util.Log&quot;).getStackTraceString(Java.use(&quot;java.lang.Throwable&quot;).$new());</span><br><span class="hljs-string">      if (file.getPath().indexOf(&quot;cacert&quot;) &gt;= 0 &amp;&amp; stack.indexOf(&quot;X509TrustManagerExtensions.checkServerTrusted&quot;) &gt;= 0) &#123;</span><br><span class="hljs-string">        var message = initMessage();</span><br><span class="hljs-string">        message[&quot;function&quot;] = &quot;SSLpinning position locator =&gt; &quot; + file.getPath() + &quot; &quot; + cert;</span><br><span class="hljs-string">        message[&quot;stack&quot;] = stack;</span><br><span class="hljs-string">        var data = Memory.alloc(1);</span><br><span class="hljs-string">        send(message, Memory.readByteArray(data, 1))</span><br><span class="hljs-string">      &#125;</span><br><span class="hljs-string">      return result;</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">    Java.use(&quot;java.net.SocketOutputStream&quot;).socketWrite0.overload(&#x27;</span>java.io.FileDescriptor<span class="hljs-string">&#x27;, &#x27;</span>[B<span class="hljs-string">&#x27;, &#x27;</span>int<span class="hljs-string">&#x27;, &#x27;</span>int<span class="hljs-string">&#x27;).implementation = function (fd, bytearry, offset, byteCount) &#123;</span><br><span class="hljs-string">      var result = this.socketWrite0(fd, bytearry, offset, byteCount);</span><br><span class="hljs-string">      var message = initMessage();</span><br><span class="hljs-string">      message[&quot;function&quot;] = &quot;HTTP_send&quot;;</span><br><span class="hljs-string">      message[&quot;ssl_session_id&quot;] = &quot;&quot;;</span><br><span class="hljs-string">      message[&quot;src_addr&quot;] = ntohl(ipToNumber((this.socket.value.getLocalAddress().toString().split(&quot;:&quot;)[0]).split(&quot;/&quot;).pop()));</span><br><span class="hljs-string">      message[&quot;src_port&quot;] = parseInt(this.socket.value.getLocalPort().toString());</span><br><span class="hljs-string">      message[&quot;dst_addr&quot;] = ntohl(ipToNumber((this.socket.value.getRemoteSocketAddress().toString().split(&quot;:&quot;)[0]).split(&quot;/&quot;).pop()));</span><br><span class="hljs-string">      message[&quot;dst_port&quot;] = parseInt(this.socket.value.getRemoteSocketAddress().toString().split(&quot;:&quot;).pop());</span><br><span class="hljs-string">      message[&quot;stack&quot;] = Java.use(&quot;android.util.Log&quot;).getStackTraceString(Java.use(&quot;java.lang.Throwable&quot;).$new()).toString();</span><br><span class="hljs-string">      var ptr = Memory.alloc(byteCount);</span><br><span class="hljs-string">      for (var i = 0; i &lt; byteCount; ++i)</span><br><span class="hljs-string">        Memory.writeS8(ptr.add(i), bytearry[offset + i]);</span><br><span class="hljs-string"></span><br><span class="hljs-string">      send(message, Memory.readByteArray(ptr, byteCount))</span><br><span class="hljs-string">      return result;</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">    Java.use(&quot;java.net.SocketInputStream&quot;).socketRead0.overload(&#x27;</span>java.io.FileDescriptor<span class="hljs-string">&#x27;, &#x27;</span>[B<span class="hljs-string">&#x27;, &#x27;</span>int<span class="hljs-string">&#x27;, &#x27;</span>int<span class="hljs-string">&#x27;, &#x27;</span>int<span class="hljs-string">&#x27;).implementation = function (fd, bytearry, offset, byteCount, timeout) &#123;</span><br><span class="hljs-string">      var result = this.socketRead0(fd, bytearry, offset, byteCount, timeout);</span><br><span class="hljs-string">      var message = initMessage();</span><br><span class="hljs-string">      message[&quot;function&quot;] = &quot;HTTP_recv&quot;;</span><br><span class="hljs-string">      message[&quot;ssl_session_id&quot;] = &quot;&quot;;</span><br><span class="hljs-string">      message[&quot;src_addr&quot;] = ntohl(ipToNumber((this.socket.value.getRemoteSocketAddress().toString().split(&quot;:&quot;)[0]).split(&quot;/&quot;).pop()));</span><br><span class="hljs-string">      message[&quot;src_port&quot;] = parseInt(this.socket.value.getRemoteSocketAddress().toString().split(&quot;:&quot;).pop());</span><br><span class="hljs-string">      message[&quot;dst_addr&quot;] = ntohl(ipToNumber((this.socket.value.getLocalAddress().toString().split(&quot;:&quot;)[0]).split(&quot;/&quot;).pop()));</span><br><span class="hljs-string">      message[&quot;dst_port&quot;] = parseInt(this.socket.value.getLocalPort());</span><br><span class="hljs-string">      message[&quot;stack&quot;] = Java.use(&quot;android.util.Log&quot;).getStackTraceString(Java.use(&quot;java.lang.Throwable&quot;).$new()).toString();</span><br><span class="hljs-string">      if (result &gt; 0) &#123;</span><br><span class="hljs-string">        var ptr = Memory.alloc(result);</span><br><span class="hljs-string">        for (var i = 0; i &lt; result; ++i)</span><br><span class="hljs-string">          Memory.writeS8(ptr.add(i), bytearry[offset + i]);</span><br><span class="hljs-string">        send(message,Memory.readByteArray(ptr, result))</span><br><span class="hljs-string">      &#125;</span><br><span class="hljs-string">      return result;</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">    if (parseFloat(Java.androidVersion)  &gt; 8) &#123;</span><br><span class="hljs-string">      Java.use(&quot;com.android.org.conscrypt.ConscryptFileDescriptorSocket$SSLOutputStream&quot;).write.overload(&#x27;</span>[B<span class="hljs-string">&#x27;, &#x27;</span>int<span class="hljs-string">&#x27;, &#x27;</span>int<span class="hljs-string">&#x27;).implementation = function (bytearry, int1, int2) &#123;</span><br><span class="hljs-string">        var result = this.write(bytearry, int1, int2);</span><br><span class="hljs-string">        SSLstackwrite = Java.use(&quot;android.util.Log&quot;).getStackTraceString(Java.use(&quot;java.lang.Throwable&quot;).$new()).toString();</span><br><span class="hljs-string">        return result;</span><br><span class="hljs-string">      &#125;</span><br><span class="hljs-string">      Java.use(&quot;com.android.org.conscrypt.ConscryptFileDescriptorSocket$SSLInputStream&quot;).read.overload(&#x27;</span>[B<span class="hljs-string">&#x27;, &#x27;</span>int<span class="hljs-string">&#x27;, &#x27;</span>int<span class="hljs-string">&#x27;).implementation = function (bytearry, int1, int2) &#123;</span><br><span class="hljs-string">        var result = this.read(bytearry, int1, int2);</span><br><span class="hljs-string">        SSLstackread = Java.use(&quot;android.util.Log&quot;).getStackTraceString(Java.use(&quot;java.lang.Throwable&quot;).$new()).toString();</span><br><span class="hljs-string">        return result;</span><br><span class="hljs-string">      &#125;</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">    else &#123;</span><br><span class="hljs-string">      Java.use(&quot;com.android.org.conscrypt.OpenSSLSocketImpl$SSLOutputStream&quot;).write.overload(&#x27;</span>[B<span class="hljs-string">&#x27;, &#x27;</span>int<span class="hljs-string">&#x27;, &#x27;</span>int<span class="hljs-string">&#x27;).implementation = function (bytearry, int1, int2) &#123;</span><br><span class="hljs-string">        var result = this.write(bytearry, int1, int2);</span><br><span class="hljs-string">        SSLstackwrite = Java.use(&quot;android.util.Log&quot;).getStackTraceString(Java.use(&quot;java.lang.Throwable&quot;).$new()).toString();</span><br><span class="hljs-string">        return result;</span><br><span class="hljs-string">      &#125;</span><br><span class="hljs-string">      Java.use(&quot;com.android.org.conscrypt.OpenSSLSocketImpl$SSLInputStream&quot;).read.overload(&#x27;</span>[B<span class="hljs-string">&#x27;, &#x27;</span>int<span class="hljs-string">&#x27;, &#x27;</span>int<span class="hljs-string">&#x27;).implementation = function (bytearry, int1, int2) &#123;</span><br><span class="hljs-string">        var result = this.read(bytearry, int1, int2);</span><br><span class="hljs-string">        SSLstackread = Java.use(&quot;android.util.Log&quot;).getStackTraceString(Java.use(&quot;java.lang.Throwable&quot;).$new()).toString();</span><br><span class="hljs-string">        return result;</span><br><span class="hljs-string">      &#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">  &#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">  )</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">&#125;)();</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure>




<h1 id="SO"><a href="#SO" class="headerlink" title="SO"></a>SO</h1><h2 id="常用代码-1"><a href="#常用代码-1" class="headerlink" title="常用代码"></a>常用代码</h2><h3 id="打印堆栈"><a href="#打印堆栈" class="headerlink" title="打印堆栈"></a>打印堆栈</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">//so层打印栈<br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">so_stack</span></span>()&#123;<br>    //获取到的函数栈不一定准确  一边获取到的要偏移-1<br>    //                                             FUZZY      ACCURATE<br>    console.log(Thread.backtrace(this.context,Backtracer.FUZZY).map(DebugSymbol.fromAddress).<span class="hljs-built_in">join</span>(<span class="hljs-string">&#x27;\n&#x27;</span>) + <span class="hljs-string">&#x27;\n&#x27;</span>);<br>    console.log(<span class="hljs-string">&quot;-------------------------------------------------------------------------------------------------&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="hook某模块某地址-加参数"><a href="#hook某模块某地址-加参数" class="headerlink" title="hook某模块某地址 加参数"></a>hook某模块某地址 加参数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">function</span> print_arg(addr)&#123;<br>    var module = Process.findRangeByAddress(addr);<br>    <span class="hljs-keyword">if</span>(module != null) <span class="hljs-built_in">return</span> hexdump(addr) + <span class="hljs-string">&quot;\n&quot;</span>;<br>    <span class="hljs-built_in">return</span> ptr(addr) + <span class="hljs-string">&quot;\n&quot;</span>;<br>&#125;<br><span class="hljs-keyword">function</span> hook_native_addr(funcPtr, paramsNum)&#123;<br>    var module = Process.findModuleByAddress(funcPtr);<br>    try &#123;<br>    Interceptor.attach(funcPtr, &#123;<br>        onEnter: <span class="hljs-keyword">function</span>(args)&#123;<br>            this.logs = [];<br>            this.params = [];<br>            this.logs.push(<span class="hljs-string">&quot;Soname : &quot;</span> + module.name + <span class="hljs-string">&quot;  Method hex:  &quot;</span> + ptr(funcPtr).sub(module.base) + <span class="hljs-string">&quot;\n&quot;</span>);<br>            <span class="hljs-keyword">for</span>(<span class="hljs-built_in">let</span> i = 0; i &lt; paramsNum; i++)&#123;<br>                this.params.push(args[i]);<br>                this.logs.push(<span class="hljs-string">&quot;this.args&quot;</span> + i + <span class="hljs-string">&quot; onEnter: &quot;</span> + print_arg(args[i]));<br>            &#125;<br>        &#125;, onLeave: <span class="hljs-keyword">function</span>(retval)&#123;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-built_in">let</span> i = 0; i &lt; paramsNum; i++)&#123;<br>                this.logs.push(<span class="hljs-string">&quot;this.args&quot;</span> + i + <span class="hljs-string">&quot; onLeave: &quot;</span> + print_arg(this.params[i]));<br>            &#125;<br>            this.logs.push(<span class="hljs-string">&quot;retval onLeave: &quot;</span> + print_arg(retval) + <span class="hljs-string">&quot;\n&quot;</span>);<br>            console.log(this.logs);<br>        &#125;<br>    &#125;);&#125;catch (e) &#123;<br>        //access violation accessing 0x2d  非法访问地址    hexdump把数值当成 地址访问了 就会报这个错误<br>        console.log(<span class="hljs-string">&quot;报错信息: &quot;</span>+e);<br>    &#125;<br>&#125;<br>hook_native_addr(ptr,num)<br></code></pre></td></tr></table></figure>
<h3 id="修改数值参数的返回值"><a href="#修改数值参数的返回值" class="headerlink" title="修改数值参数的返回值"></a>修改数值参数的返回值</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">setResult</span></span>()&#123;<br>    var soAddr = Module.findBaseAddress(<span class="hljs-string">&quot;libcocos2dlua.so&quot;</span>);<br>    var Addr = soAddr.add(0x229A20);<br>    Interceptor.attach(Addr,&#123;<br>       onEnter:<span class="hljs-keyword">function</span> (args)&#123;<br>           //修改参数数值<br>           args[0] = ptr(100); // new NativePointer<br>       &#125; ,<br>        onLeave :  <span class="hljs-keyword">function</span> (retval)&#123;<br>           retval.replace(100);<br>        &#125;<br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="定位函数"><a href="#定位函数" class="headerlink" title="定位函数"></a>定位函数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs bash">//定位jni静态注册的so<br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">hook_dlsye</span></span>()&#123;<br>    //定位jni静态注册的so<br>    var dsynaddr = Module.findExportByName(<span class="hljs-string">&quot;libdl.so&quot;</span>,<span class="hljs-string">&quot;dlsym&quot;</span>);<br>    console.log(dsynaddr);<br>    Interceptor.attach(dsynaddr,&#123;<br>        onEnter: <span class="hljs-keyword">function</span> (args)&#123;<br>            this.args1 = args[1];<br>        &#125;,<br>        onLeave :<span class="hljs-keyword">function</span> (retval)&#123;<br>            var module = Process.findModuleByAddress(retval);<br>            <span class="hljs-keyword">if</span> (module == null) <span class="hljs-built_in">return</span>;<br>            //module的名字 so的名字  模块的地址 模块的偏移<br>            console.log(this.args1.readCString(),module.name,retval,retval.sub(module.base));<br>        &#125;<br>    &#125;);<br>&#125;<br>//定位jni动态注册的so<br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">hook_RegisterNatives</span></span>() &#123;<br>    //定位jni动态注册的so<br>    var RegisterNatives_addr = null;<br>    var symbols = Process.findModuleByName(<span class="hljs-string">&quot;libart.so&quot;</span>).enumerateSymbols();<br>    <span class="hljs-keyword">for</span> (var i = 0; i &lt; symbols.length; i++) &#123;<br>        var symbol = symbols[i].name;<br>        <span class="hljs-keyword">if</span> ((symbol.indexOf(<span class="hljs-string">&quot;CheckJNI&quot;</span>) == -1) &amp;&amp; (symbol.indexOf(<span class="hljs-string">&quot;JNI&quot;</span>) &gt;= 0)) &#123;<br>            <span class="hljs-keyword">if</span> (symbol.indexOf(<span class="hljs-string">&quot;RegisterNatives&quot;</span>) &gt;= 0) &#123;<br>                RegisterNatives_addr = symbols[i].address;<br>                // console.log(<span class="hljs-string">&quot;RegisterNatives_addr: &quot;</span>, RegisterNatives_addr);<br>            &#125;<br>        &#125;<br>    &#125;<br>    Interceptor.attach(RegisterNatives_addr, &#123;<br>        onEnter: <span class="hljs-keyword">function</span> (args) &#123;<br>            var <span class="hljs-built_in">env</span> = Java.vm.tryGetEnv();<br>            var classname = env.getClassName(args[1]);<br>            var methodcount = args[3].toInt32();<br><br><br>            <span class="hljs-keyword">for</span> (<span class="hljs-built_in">let</span> i = 0; i &lt; methodcount; i++) &#123;<br>                var methodname = args[2].add(Process.pointerSize*3*i).readPointer().readCString();<br>                var signature =  args[2].add(Process.pointerSize*3*i).add(Process.pointerSize).readPointer().readCString();<br>                var fnPtr = args[2].add(Process.pointerSize*3*i).add(Process.pointerSize * 2).readPointer();<br>                var module = Process.findModuleByAddress(fnPtr);<br>                <span class="hljs-keyword">if</span> (module == null) <span class="hljs-built_in">return</span>;<br>                console.log(<span class="hljs-string">&quot;[classname]: &quot;</span>+classname,<span class="hljs-string">&quot;[methodname]: &quot;</span>+methodname,<span class="hljs-string">&quot;[signature]: &quot;</span>+signature,<span class="hljs-string">&quot;[fnPtr]: &quot;</span>+fnPtr,<span class="hljs-string">&quot;[module]: &quot;</span>+module.name,<span class="hljs-string">&quot;[base]: &quot;</span>+fnPtr.sub(module.base));<br>            &#125;<br>        &#125;,<br>        onLeave: <span class="hljs-keyword">function</span> (retval) &#123;&#125;<br>    &#125;);<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h3 id="枚举导入-导出表所有函数"><a href="#枚举导入-导出表所有函数" class="headerlink" title="枚举导入 导出表所有函数"></a>枚举导入 导出表所有函数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">enmuExports</span></span>()&#123;<br>    //导入表<br>    var moduleImportDetails = Module.enumerateImports(<span class="hljs-string">&quot;libencryptlib.so&quot;</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">let</span> i = 0; i &lt; moduleImportDetails.length; i++) &#123;<br>        console.log(<span class="hljs-string">&quot;enumerateImports  : &quot;</span>+moduleImportDetails[i].name + <span class="hljs-string">&quot;   &quot;</span> + moduleImportDetails[i].address);<br>    &#125;<br>    //导出表<br>    var moduleExportDetails = Module.enumerateExports(<span class="hljs-string">&quot;libencryptlib.so&quot;</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">let</span> i = 0; i &lt; moduleExportDetails.length; i++) &#123;<br>        console.log(<span class="hljs-string">&quot;moduleExportDetails  : &quot;</span>+moduleExportDetails[i].name + <span class="hljs-string">&quot;   &quot;</span> + moduleExportDetails[i].address);<br>    &#125;<br>    //符号表<br>    var moduleSymbolDetails = Module.enumerateSymbols(<span class="hljs-string">&quot;libencryptlib.so&quot;</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">let</span> i = 0; i &lt; moduleSymbolDetails.length; i++) &#123;<br>        console.log(<span class="hljs-string">&quot;moduleSymbolDetails  : &quot;</span>+moduleSymbolDetails[i].name + <span class="hljs-string">&quot;   &quot;</span> + moduleSymbolDetails[i].address);<br>    &#125;<br>    //枚举moduls  在不知道某个导入函数的地址时 不知道他是来自哪里 可以去枚举所有已加载的so<br>    var enumerateModuls = Module.enumerateModuls();<br>    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">let</span> i = 0; i &lt; enumerateModuls.length; i++) &#123;<br>        console.log(<span class="hljs-string">&quot;moduleSymbolDetails  : &quot;</span>+enumerateModuls[i].enumerateExports()[i]);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="dumpSo"><a href="#dumpSo" class="headerlink" title="dumpSo"></a>dumpSo</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">function</span> sodump(so_name)&#123;<br>    Java.perform(<span class="hljs-function"><span class="hljs-title">function</span></span> () &#123;<br>        var currentApplication = Java.use(<span class="hljs-string">&quot;android.app.ActivityThread&quot;</span>).currentApplication();<br>        var <span class="hljs-built_in">dir</span> = currentApplication.getApplicationContext().getFilesDir().getPath();<br>        var libso = Process.getModuleByName(so_name);<br>        console.log(<span class="hljs-string">&quot;[name]:&quot;</span>, libso.name);<br>        console.log(<span class="hljs-string">&quot;[base]:&quot;</span>, libso.base);<br>        console.log(<span class="hljs-string">&quot;[size]:&quot;</span>, ptr(libso.size));<br>        console.log(<span class="hljs-string">&quot;[path]:&quot;</span>, libso.path);<br>        var file_path = <span class="hljs-built_in">dir</span> + <span class="hljs-string">&quot;/&quot;</span> + libso.name + <span class="hljs-string">&quot;_&quot;</span> + libso.base + <span class="hljs-string">&quot;_&quot;</span> + ptr(libso.size) + <span class="hljs-string">&quot;.so&quot;</span>;<br>        var file_handle = new File(file_path, <span class="hljs-string">&quot;wb&quot;</span>);<br>        <span class="hljs-keyword">if</span> (file_handle &amp;&amp; file_handle != null) &#123;<br>            Memory.protect(ptr(libso.base), libso.size, <span class="hljs-string">&#x27;rwx&#x27;</span>);<br>            //ptr获取到当前so的基址从 当前基址开始读 读so的大小<br>            var libso_buffer = ptr(libso.base).readByteArray(libso.size);<br>            file_handle.write(libso_buffer);<br>            file_handle.flush();<br>            file_handle.close();<br>            console.log(<span class="hljs-string">&quot;[dump]:&quot;</span>, file_path);<br>        &#125;<br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="替换某地址机器码"><a href="#替换某地址机器码" class="headerlink" title="替换某地址机器码"></a>替换某地址机器码</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">var codeAddr = soAddr.add(0x167C);<br>Memory.patchCode(codeAddr, 8, <span class="hljs-keyword">function</span> (code) &#123;<br>    var Writer = new Arm64Writer(code, &#123;pc: codeAddr&#125;);<br>    Writer.putBytes(hexToBytes(<span class="hljs-string">&quot;0001094B&quot;</span>));<br>    Writer.putBytes(hexToBytes(<span class="hljs-string">&quot;FF830091&quot;</span>));<br>    Writer.putRet();<br>    Writer.flush();<br>&#125;);<br></code></pre></td></tr></table></figure>

<h3 id="主动调用c函数"><a href="#主动调用c函数" class="headerlink" title="主动调用c函数"></a>主动调用c函数</h3><p>function ivokecfunction(){<br>    Java.perform(function(){<br>        &#x2F;** 一般情况在内存中能直接看到的类型都是c的类型 java是不在内存中的 java在虚拟机中运行*&#x2F;<br>            &#x2F;&#x2F;拿到函数地址<br>        var funcAddr &#x3D; Module.findBaseAddress(“libtuzi.so”).add(0x1234);<br>        &#x2F;&#x2F;声明函数指针<br>        var func &#x3D; new NativeFunction(funcAddr, “pointer”, [‘pointer’, ‘pointer’]);<br>        &#x2F;&#x2F;通过函数指针主动调用函数<br>        var env &#x3D; Java.vm.tryGetEnv();<br>        console.log(“env: “, JSON.stringify(env));<br>        if(env !&#x3D; null){<br>            var jstr &#x3D; env.newStringUtf(“tuzi”);<br>            var cstr &#x3D; func(env, jstr);<br>            console.log(cstr.readCString());<br>            &#x2F;&#x2F;得到函数的返回值<br>            console.log(hexdump(cstr));<br>        }<br>    });<br>}</p>
<h3 id="写文件"><a href="#写文件" class="headerlink" title="写文件"></a>写文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">libcWriteTex</span></span>()&#123;<br>    /**<br>     * Java.vm.tryGetEnv();  如果获取不到<span class="hljs-built_in">env</span> 可以放到java.perform里面<br>     * 一般java的函数都要放在java.perform<br>     * */<br>    var addr_fopen = Module.findExportByName(<span class="hljs-string">&quot;libc.so&quot;</span>, <span class="hljs-string">&quot;fopen&quot;</span>);//fopen打开文件<br>    var addr_fputs = Module.findExportByName(<span class="hljs-string">&quot;libc.so&quot;</span>, <span class="hljs-string">&quot;fputs&quot;</span>);//fputs写入数据<br>    var addr_fclose = Module.findExportByName(<span class="hljs-string">&quot;libc.so&quot;</span>, <span class="hljs-string">&quot;fclose&quot;</span>);//fclose关闭文件<br><br>    console.log(<span class="hljs-string">&quot;addr_fopen:&quot;</span>, addr_fopen, <span class="hljs-string">&quot;addr_fputs:&quot;</span>, addr_fputs, <span class="hljs-string">&quot;addr_fclose:&quot;</span>, addr_fclose);<br>    //获取函数指针   NativeFunction获取函数指针<br>    var fopen = new NativeFunction(addr_fopen, <span class="hljs-string">&quot;pointer&quot;</span>, [<span class="hljs-string">&quot;pointer&quot;</span>, <span class="hljs-string">&quot;pointer&quot;</span>]);<br>    var fputs = new NativeFunction(addr_fputs, <span class="hljs-string">&quot;int&quot;</span>, [<span class="hljs-string">&quot;pointer&quot;</span>, <span class="hljs-string">&quot;pointer&quot;</span>]);<br>    var fclose = new NativeFunction(addr_fclose, <span class="hljs-string">&quot;int&quot;</span>, [<span class="hljs-string">&quot;pointer&quot;</span>]);<br><br>    //c语言的字符串直接写的话是js的string  用perform  frida会转换成java的string<br>    // 使用allocUtf8String 可以将 java的string 转换成 nativePintre 开辟一块内存生成一个char*<br>    var filename = Memory.allocUtf8String(<span class="hljs-string">&quot;/sdcard/tuzi.txt&quot;</span>);<br>    var open_mode = Memory.allocUtf8String(<span class="hljs-string">&quot;w&quot;</span>);<br>    var file = fopen(filename, open_mode);<br>    console.log(<span class="hljs-string">&quot;fopen:&quot;</span>, file);<br><br>    var buffer = Memory.allocUtf8String(<span class="hljs-string">&quot;tuzi\n&quot;</span>);<br>    var retval = fputs(buffer, file);<br>    console.log(<span class="hljs-string">&quot;fputs:&quot;</span>, retval);<br><br>    fclose(file);<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="使用frida封装的函数来调用jni"><a href="#使用frida封装的函数来调用jni" class="headerlink" title="使用frida封装的函数来调用jni"></a>使用frida封装的函数来调用jni</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">fridainvokejni</span></span>() &#123;<br>    var funcAddr = Module.findExportByName(<span class="hljs-string">&quot;libtuzi.so&quot;</span>, <span class="hljs-string">&quot;encrypt&quot;</span>);<br>    console.log(funcAddr);<br>    <span class="hljs-keyword">if</span>(funcAddr != null)&#123;<br>        Interceptor.attach(funcAddr,&#123;<br>            onEnter: <span class="hljs-keyword">function</span>(args)&#123;<br>            &#125;,<br>            onLeave: <span class="hljs-keyword">function</span>(retval)&#123;<br>                var <span class="hljs-built_in">env</span> = Java.vm.tryGetEnv();<br>                var jstr = env.newStringUtf(<span class="hljs-string">&quot;bbs.125.la&quot;</span>);  //主动调用jni函数 cstr转jstr<br>                retval.replace(jstr);<br><br>                var cstr = env.getStringUtfChars(jstr); //主动调用 jstr转cstr<br>                console.log(cstr.readCString());<br>                console.log(hexdump(cstr));<br>            &#125;<br>        &#125;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="NativeFunction方式主动调用"><a href="#NativeFunction方式主动调用" class="headerlink" title="NativeFunction方式主动调用"></a>NativeFunction方式主动调用</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">NativeFunctionJni</span></span>()&#123;<br>    var symbols = Process.getModuleByName(<span class="hljs-string">&quot;libart.so&quot;</span>).enumerateSymbols();<br>    var newStringUtf = null;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">let</span> i = 0; i &lt; symbols.length; i++) &#123;<br>        var symbol = symbols[i];<br>        <span class="hljs-keyword">if</span>(symbol.name.indexOf(<span class="hljs-string">&quot;CheckJNI&quot;</span>) == -1 &amp;&amp; symbol.name.indexOf(<span class="hljs-string">&quot;NewStringUTF&quot;</span>) != -1)&#123;<br>            console.log(symbol.name, symbol.address);<br>            newStringUtf = symbol.address;<br>        &#125;<br>    &#125;<br>    var newStringUtf_func = new NativeFunction(newStringUtf, <span class="hljs-string">&#x27;pointer&#x27;</span>, [<span class="hljs-string">&#x27;pointer&#x27;</span>, <span class="hljs-string">&#x27;pointer&#x27;</span>]);<br>    var jstring = newStringUtf_func(Java.vm.tryGetEnv().handle, Memory.allocUtf8String(<span class="hljs-string">&quot;tuzi&quot;</span>));<br>    console.log(jstring);<br><br>    var envAddr = Java.vm.tryGetEnv().handle.readPointer();<br>    var GetStringUTFChars = envAddr.add(0x548).readPointer();<br>    var GetStringUTFChars_func = new NativeFunction(GetStringUTFChars, <span class="hljs-string">&#x27;pointer&#x27;</span>, [<span class="hljs-string">&#x27;pointer&#x27;</span>, <span class="hljs-string">&#x27;pointer&#x27;</span>, <span class="hljs-string">&#x27;pointer&#x27;</span>]);<br>    var cstr = GetStringUTFChars_func(Java.vm.tryGetEnv().handle, jstring, ptr(0));<br>    console.log(cstr.readCString());<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="二级指针的hook"><a href="#二级指针的hook" class="headerlink" title="二级指针的hook"></a>二级指针的hook</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">call_func</span></span>() &#123;<br>    var soAddr = Module.findBaseAddress(<span class="hljs-string">&quot;libtuzi.so&quot;</span>);<br>    var xiugaiStr = soAddr.add(0x17D0);<br>    var xiugaiStr_func = new NativeFunction(xiugaiStr, <span class="hljs-string">&#x27;int64&#x27;</span>, [<span class="hljs-string">&#x27;pointer&#x27;</span>]);<br>    var strAddr = Memory.allocUtf8String(<span class="hljs-string">&quot;tuzi&quot;</span>);<br>    console.log(hexdump(strAddr));<br>    //生成二级指针<br>    var finalAddr = Memory.alloc(8).writePointer(strAddr);<br>    xiugaiStr_func(finalAddr);<br>    console.log(hexdump(strAddr));<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="hook-init-array"><a href="#hook-init-array" class="headerlink" title="hook init_array"></a>hook init_array</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">hoookInit_array</span></span>() &#123;<br>    <span class="hljs-keyword">function</span> hook_dlopen(addr, soName, callback) &#123;<br>        Interceptor.attach(addr, &#123;<br>            onEnter: <span class="hljs-keyword">function</span> (args) &#123;<br>                var soPath = args[0].readCString();<br>                <span class="hljs-keyword">if</span>(soPath.indexOf(soName) != -1) hook_call_constructors();<br>            &#125;, onLeave: <span class="hljs-keyword">function</span> (retval) &#123;<br>            &#125;<br>        &#125;);<br>    &#125;<br>    var dlopen = Module.findExportByName(<span class="hljs-string">&quot;libdl.so&quot;</span>, <span class="hljs-string">&quot;dlopen&quot;</span>);<br>    var android_dlopen_ext = Module.findExportByName(<span class="hljs-string">&quot;libdl.so&quot;</span>, <span class="hljs-string">&quot;android_dlopen_ext&quot;</span>);<br>    hook_dlopen(dlopen, <span class="hljs-string">&quot;libtuzi.so&quot;</span>, inlineHook);<br>    hook_dlopen(android_dlopen_ext, <span class="hljs-string">&quot;libtuzi.so&quot;</span>, inlineHook);<br><br>    var isHooked = <span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">hook_call_constructors</span></span>() &#123;<br>        var symbols = Process.getModuleByName(<span class="hljs-string">&quot;linker64&quot;</span>).enumerateSymbols();<br>        var call_constructors_addr = null;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">let</span> i = 0; i &lt; symbols.length; i++) &#123;<br>            var symbol = symbols[i];<br>            <span class="hljs-keyword">if</span>(symbol.name.indexOf(<span class="hljs-string">&quot;__dl__ZN6soinfo17call_constructorsEv&quot;</span>) != -1)&#123;<br>                call_constructors_addr = symbol.address;<br>            &#125;<br>        &#125;<br>        console.log(<span class="hljs-string">&quot;call_constructors_addr: &quot;</span>, call_constructors_addr);<br>        Interceptor.attach(call_constructors_addr, &#123;<br>            onEnter: <span class="hljs-keyword">function</span> (args) &#123;<br>                <span class="hljs-keyword">if</span>(!isHooked) &#123;<br>                    hook_initarray();<br>                    isHooked = <span class="hljs-literal">true</span>;<br>                &#125;<br>            &#125;, onLeave: <span class="hljs-keyword">function</span> (retval) &#123;<br>            &#125;<br>        &#125;);<br>    &#125;<br><br>    <span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">hook_initarray</span></span>()&#123;<br>        var tuziAddr = Module.findBaseAddress(<span class="hljs-string">&quot;libtuzi.so&quot;</span>);<br>        var func1_addr = tuziAddr.add(0x1C54);<br>        var func2_addr = tuziAddr.add(0x1C7C);<br>        var func3_addr = tuziAddr.add(0x1C2C);<br>        Interceptor.replace(func1_addr, new NativeCallback(<span class="hljs-function"><span class="hljs-title">function</span></span> () &#123;<br>            console.log(<span class="hljs-string">&quot;func1 is replaced!!!&quot;</span>);<br>        &#125;, <span class="hljs-string">&#x27;void&#x27;</span>, []));<br><br>        Interceptor.replace(func2_addr, new NativeCallback(<span class="hljs-function"><span class="hljs-title">function</span></span> () &#123;<br>            console.log(<span class="hljs-string">&quot;func2 is replaced!!!&quot;</span>);<br>        &#125;, <span class="hljs-string">&#x27;void&#x27;</span>, []));<br><br>        Interceptor.replace(func3_addr, new NativeCallback(<span class="hljs-function"><span class="hljs-title">function</span></span> () &#123;<br>            console.log(<span class="hljs-string">&quot;func3 is replaced!!!&quot;</span>);<br>        &#125;, <span class="hljs-string">&#x27;void&#x27;</span>, []));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="hook-jnionLoad"><a href="#hook-jnionLoad" class="headerlink" title="hook jnionLoad"></a>hook jnionLoad</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">//hook_JNIOnload  HOOK到dlopen 检测到so加载就可以hook jnionload 别的函数也一样  hook init_array 要__dl__ZN6soinfo17call_constructorsEv 执行钱hook 要不然so已经加载完成 init已经结束了 或者太早还没加载<br>var dlopen = Module.findExportByName(<span class="hljs-string">&quot;libdl.so&quot;</span>, <span class="hljs-string">&quot;dlopen&quot;</span>);<br>var android_dlopen_ext = Module.findExportByName(<span class="hljs-string">&quot;libdl.so&quot;</span>, <span class="hljs-string">&quot;android_dlopen_ext&quot;</span>);<br>//console.log(JSON.stringify(Process.getModuleByAddress(dlopen)));<br>hook_dlopen(dlopen, <span class="hljs-string">&quot;tuzi.so&quot;</span>, hook_JNIOnload);<br>hook_dlopen(android_dlopen_ext, <span class="hljs-string">&quot;tuzi.so&quot;</span>, hook_JNIOnload);<br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">hook_JNIOnload</span></span>() &#123;<br>    var tuziAddr = Module.findBaseAddress(<span class="hljs-string">&quot;tuzi.so&quot;</span>);<br>    var funcAddr = tuziAddr.add(0x1CCC);//jnionload<br>    Interceptor.replace(funcAddr, new NativeCallback(<span class="hljs-function"><span class="hljs-title">function</span></span> () &#123;<br>        console.log(<span class="hljs-string">&quot;this func is replaced !&quot;</span>);<br>    &#125;, <span class="hljs-string">&#x27;void&#x27;</span>, []));<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="Frida-实现的内存读写监控"><a href="#Frida-实现的内存读写监控" class="headerlink" title="Frida 实现的内存读写监控"></a>Frida 实现的内存读写监控</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">read_write_break</span></span>()&#123;<br>    <span class="hljs-keyword">function</span> hook_dlopen(addr, soName, callback) &#123;<br>        Interceptor.attach(addr, &#123;<br>            onEnter: <span class="hljs-keyword">function</span> (args) &#123;<br>                var soPath = args[0].readCString();<br>                <span class="hljs-keyword">if</span>(soPath.indexOf(soName) != -1) hook_call_constructors();<br>            &#125;, onLeave: <span class="hljs-keyword">function</span> (retval) &#123;<br>            &#125;<br>        &#125;);<br>    &#125;<br>    var dlopen = Module.findExportByName(<span class="hljs-string">&quot;libdl.so&quot;</span>, <span class="hljs-string">&quot;dlopen&quot;</span>);<br>    var android_dlopen_ext = Module.findExportByName(<span class="hljs-string">&quot;libdl.so&quot;</span>, <span class="hljs-string">&quot;android_dlopen_ext&quot;</span>);<br>    hook_dlopen(dlopen, <span class="hljs-string">&quot;libaes.so&quot;</span>, set_read_write_break);<br>    hook_dlopen(android_dlopen_ext, <span class="hljs-string">&quot;libaes.so&quot;</span>, set_read_write_break);<br><br>    <span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">set_read_write_break</span></span>()&#123;<br>        //实现一个异常回调   处理好这个异常就可以正常返回<br>        Process.setExceptionHandler(<span class="hljs-keyword">function</span>(details) &#123;<br>            console.log(JSON.stringify(details, null, 2));<br>            console.log(<span class="hljs-string">&quot;lr&quot;</span>, DebugSymbol.fromAddress(details.context.lr));<br>            console.log(<span class="hljs-string">&quot;pc&quot;</span>, DebugSymbol.fromAddress(details.context.pc));<br>            Memory.protect(details.memory.address, Process.pointerSize, <span class="hljs-string">&#x27;rwx&#x27;</span>);<br>            console.log(Thread.backtrace(details.context, Backtracer.ACCURATE).map(DebugSymbol.fromAddress).<span class="hljs-built_in">join</span>(<span class="hljs-string">&#x27;\n&#x27;</span>) + <span class="hljs-string">&#x27;\n&#x27;</span>);<br>            <span class="hljs-built_in">return</span> <span class="hljs-literal">true</span>;<br>        &#125;);<br>        var addr = Module.findBaseAddress(<span class="hljs-string">&quot;libaes.so&quot;</span>).add(0x6666);<br>        Memory.protect(addr, 8, <span class="hljs-string">&#x27;---&#x27;</span>); //修改内存页的权限<br>        /**<br>         * 比如有一个地址是0x12345678  我想看一下是那个代码去访问了这个地址<br>         * 我只需要把这个内存地址置空 有函数去访问这个地址时 就会触发非法访问异常<br>         * 比较鸡肋这种方法 这种方法会一次修改一个内存页  并且触发一次就无效了<br>         */<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="frida-内存检索"><a href="#frida-内存检索" class="headerlink" title="frida 内存检索"></a>frida 内存检索</h3><p>&#x2F;&#x2F;这个非常好用可以用在在内存中搜索字符串特征来定位算法位置<br>&#x2F;&#x2F;也可以用来搜索svc指令 来做反调试</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">scan_salt</span></span>() &#123;<br>    <span class="hljs-built_in">let</span> ranges = Process.enumerateRanges(<span class="hljs-string">&quot;r--&quot;</span>)<br>    ranges.map(r =&gt; &#123;<br>        Memory.scan(r.base, r.size, <span class="hljs-string">&quot;41 50 50 4B 45 59 47 4C 5F 52 4E 5F&quot;</span>, &#123;<br>            onMatch(address, size) &#123;<br>                console.log(address, size, hexdump(address.sub(0x30)));<br>            &#125;<br>        &#125;)<br>    &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="获取当前线程id"><a href="#获取当前线程id" class="headerlink" title="获取当前线程id"></a>获取当前线程id</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">function</span> LogPrint(<span class="hljs-built_in">log</span>) &#123;<br>    var theDate = new Date();<br>    var hour = theDate.getHours();<br>    var minute = theDate.getMinutes();<br>    var second = theDate.getSeconds();<br>    var mSecond = theDate.getMilliseconds();<br><br>    hour &lt; 10 ? hour = <span class="hljs-string">&quot;0&quot;</span> + hour : hour;<br>    minute &lt; 10 ? minute = <span class="hljs-string">&quot;0&quot;</span> + minute : minute;<br>    second &lt; 10 ? second = <span class="hljs-string">&quot;0&quot;</span> + second : second;<br>    mSecond &lt; 10 ? mSecond = <span class="hljs-string">&quot;00&quot;</span> + mSecond : mSecond &lt; 100 ? mSecond = <span class="hljs-string">&quot;0&quot;</span> + mSecond : mSecond;<br>    var time = hour + <span class="hljs-string">&quot;:&quot;</span> + minute + <span class="hljs-string">&quot;:&quot;</span> + second + <span class="hljs-string">&quot;:&quot;</span> + mSecond;<br>    var threadid = Process.getCurrentThreadId();<br>    console.log(<span class="hljs-string">&quot;[&quot;</span> + time + <span class="hljs-string">&quot;]&quot;</span> + <span class="hljs-string">&quot;-&gt;threadid:&quot;</span> + threadid + <span class="hljs-string">&quot;--&quot;</span> + <span class="hljs-built_in">log</span>);<br><br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="so层的好用工具"><a href="#so层的好用工具" class="headerlink" title="so层的好用工具"></a>so层的好用工具</h2><h3 id="hook-art-imyang"><a href="#hook-art-imyang" class="headerlink" title="hook_art         @imyang"></a>hook_art         @imyang</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br>(<span class="hljs-function"><span class="hljs-title">function</span></span>()&#123;<br><br>    <span class="hljs-keyword">function</span> klog(data)&#123;<br>        var message=&#123;&#125;;<br>        message[<span class="hljs-string">&quot;jsname&quot;</span>]=<span class="hljs-string">&quot;hook_art&quot;</span>;<br>        message[<span class="hljs-string">&quot;data&quot;</span>]=data;<br>        send(message);<br>    &#125;<br><br>    <span class="hljs-keyword">function</span> klogData(data,key,value)&#123;<br>        var message=&#123;&#125;;<br>        message[<span class="hljs-string">&quot;jsname&quot;</span>]=<span class="hljs-string">&quot;hook_art&quot;</span>;<br>        message[<span class="hljs-string">&quot;data&quot;</span>]=data;<br>        message[key]=value;<br>        send(message);<br>    &#125;<br><br>   <br>    const STD_STRING_SIZE = 3 * Process.pointerSize;<br>    class StdString &#123;<br>        <span class="hljs-function"><span class="hljs-title">constructor</span></span>() &#123;<br>            this.handle = Memory.alloc(STD_STRING_SIZE);<br>        &#125;<br><br>        <span class="hljs-function"><span class="hljs-title">dispose</span></span>() &#123;<br>            const [data, isTiny] = this._getData();<br>            <span class="hljs-keyword">if</span> (!isTiny) &#123;<br>                Java.api.<span class="hljs-variable">$delete</span>(data);<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-function"><span class="hljs-title">disposeToString</span></span>() &#123;<br>            const result = this.toString();<br>            this.dispose();<br>            <span class="hljs-built_in">return</span> result;<br>        &#125;<br><br>        <span class="hljs-function"><span class="hljs-title">toString</span></span>() &#123;<br>            const [data] = this._getData();<br>            <span class="hljs-built_in">return</span> data.readUtf8String();<br>        &#125;<br><br>        <span class="hljs-function"><span class="hljs-title">_getData</span></span>() &#123;<br>            const str = this.handle;<br>            const isTiny = (str.readU8() &amp; 1) === 0;<br>            const data = isTiny ? str.add(1) : str.add(2 * Process.pointerSize).readPointer();<br>            <span class="hljs-built_in">return</span> [data, isTiny];<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">function</span> prettyMethod(method_id, withSignature) &#123;<br>        const result = new StdString();<br>        Java.api[<span class="hljs-string">&#x27;art::ArtMethod::PrettyMethod&#x27;</span>](result, method_id, withSignature ? 1 : 0);<br>        <span class="hljs-built_in">return</span> result.disposeToString();<br>    &#125;<br><br><br>    <span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">hook_libart</span></span>() &#123;<br>        klogData(<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;init&quot;</span>,<span class="hljs-string">&quot;hook_art.js init hook success&quot;</span>)<br><br>        var symbols = Module.enumerateSymbolsSync(<span class="hljs-string">&quot;libart.so&quot;</span>);<br>        var addrGetStringUTFChars = null;<br>        var addrNewStringUTF = null;<br>        var addrFindClass = null;<br>        var addrGetMethodID = null;<br>        var addrGetStaticMethodID = null;<br>        var addrGetFieldID = null;<br>        var addrGetStaticFieldID = null;<br>        var addrRegisterNatives = null;<br>        var so_name = <span class="hljs-string">&quot;lib&quot;</span>;      //TODO 这里写需要过滤的so<br><br>        <span class="hljs-keyword">for</span> (var i = 0; i &lt; symbols.length; i++) &#123;<br>            var symbol = symbols[i];<br>            <span class="hljs-keyword">if</span> (symbol.name.indexOf(<span class="hljs-string">&quot;art&quot;</span>) &gt;= 0 &amp;&amp;<br>                symbol.name.indexOf(<span class="hljs-string">&quot;JNI&quot;</span>) &gt;= 0 &amp;&amp;<br>                symbol.name.indexOf(<span class="hljs-string">&quot;CheckJNI&quot;</span>) &lt; 0 &amp;&amp;<br>                symbol.name.indexOf(<span class="hljs-string">&quot;_ZN3art3JNI&quot;</span>) &gt;= 0<br>            ) &#123;<br>                <span class="hljs-keyword">if</span> (symbol.name.indexOf(<span class="hljs-string">&quot;GetStringUTFChars&quot;</span>) &gt;= 0) &#123;<br>                    addrGetStringUTFChars = symbol.address;<br>                    console.log(<span class="hljs-string">&quot;GetStringUTFChars is at &quot;</span>, symbol.address, symbol.name);<br>                &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (symbol.name.indexOf(<span class="hljs-string">&quot;NewStringUTF&quot;</span>) &gt;= 0) &#123;<br>                    addrNewStringUTF = symbol.address;<br>                    console.log(<span class="hljs-string">&quot;NewStringUTF is at &quot;</span>, symbol.address, symbol.name);<br>                &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (symbol.name.indexOf(<span class="hljs-string">&quot;FindClass&quot;</span>) &gt;= 0) &#123;<br>                    addrFindClass = symbol.address;<br>                    console.log(<span class="hljs-string">&quot;FindClass is at &quot;</span>, symbol.address, symbol.name);<br>                &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (symbol.name.indexOf(<span class="hljs-string">&quot;GetMethodID&quot;</span>) &gt;= 0) &#123;<br>                    addrGetMethodID = symbol.address;<br>                    console.log(<span class="hljs-string">&quot;GetMethodID is at &quot;</span>, symbol.address, symbol.name);<br>                &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (symbol.name.indexOf(<span class="hljs-string">&quot;GetStaticMethodID&quot;</span>) &gt;= 0) &#123;<br>                    addrGetStaticMethodID = symbol.address;<br>                    console.log(<span class="hljs-string">&quot;GetStaticMethodID is at &quot;</span>, symbol.address, symbol.name);<br>                &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (symbol.name.indexOf(<span class="hljs-string">&quot;GetFieldID&quot;</span>) &gt;= 0) &#123;<br>                    addrGetFieldID = symbol.address;<br>                    console.log(<span class="hljs-string">&quot;GetFieldID is at &quot;</span>, symbol.address, symbol.name);<br>                &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (symbol.name.indexOf(<span class="hljs-string">&quot;GetStaticFieldID&quot;</span>) &gt;= 0) &#123;<br>                    addrGetStaticFieldID = symbol.address;<br>                    console.log(<span class="hljs-string">&quot;GetStaticFieldID is at &quot;</span>, symbol.address, symbol.name);<br>                &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (symbol.name.indexOf(<span class="hljs-string">&quot;RegisterNatives&quot;</span>) &gt;= 0) &#123;<br>                    addrRegisterNatives = symbol.address;<br>                    console.log(<span class="hljs-string">&quot;RegisterNatives is at &quot;</span>, symbol.address, symbol.name);<br>                &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (symbol.name.indexOf(<span class="hljs-string">&quot;CallStatic&quot;</span>) &gt;= 0) &#123;<br>                    console.log(<span class="hljs-string">&quot;CallStatic is at &quot;</span>, symbol.address, symbol.name);<br>                    Interceptor.attach(symbol.address, &#123;<br>                        onEnter: <span class="hljs-keyword">function</span> (args) &#123;<br>                            var module = Process.findModuleByAddress(this.returnAddress);<br>                            <span class="hljs-keyword">if</span> (module != null &amp;&amp; module.name.indexOf(so_name) == 0) &#123;<br>                                var java_class = args[1];<br>                                var mid = args[2];<br>                                var class_name = Java.vm.tryGetEnv().getClassName(java_class);<br>                                <span class="hljs-keyword">if</span> (class_name.indexOf(<span class="hljs-string">&quot;java.&quot;</span>) == -1 &amp;&amp; class_name.indexOf(<span class="hljs-string">&quot;android.&quot;</span>) == -1) &#123;<br>                                    var method_name = prettyMethod(mid, 1);<br>                                    console.log(<span class="hljs-string">&quot;&lt;&gt;CallStatic:&quot;</span>, DebugSymbol.fromAddress(this.returnAddress), class_name, method_name);<br>                                &#125;<br>                            &#125;<br>                        &#125;,<br>                        onLeave: <span class="hljs-keyword">function</span> (retval) &#123; &#125;<br>                    &#125;);<br>                &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (symbol.name.indexOf(<span class="hljs-string">&quot;CallNonvirtual&quot;</span>) &gt;= 0) &#123;<br>                    console.log(<span class="hljs-string">&quot;CallNonvirtual is at &quot;</span>, symbol.address, symbol.name);<br>                    Interceptor.attach(symbol.address, &#123;<br>                        onEnter: <span class="hljs-keyword">function</span> (args) &#123;<br>                            var module = Process.findModuleByAddress(this.returnAddress);<br>                            <span class="hljs-keyword">if</span> (module != null &amp;&amp; module.name.indexOf(so_name) == 0) &#123;<br>                                var jobject = args[1];<br>                                var jclass = args[2];<br>                                var jmethodID = args[3];<br>                                var obj_class_name = Java.vm.tryGetEnv().getObjectClassName(jobject);<br>                                var class_name = Java.vm.tryGetEnv().getClassName(jclass);<br>                                <span class="hljs-keyword">if</span> (class_name.indexOf(<span class="hljs-string">&quot;java.&quot;</span>) == -1 &amp;&amp; class_name.indexOf(<span class="hljs-string">&quot;android.&quot;</span>) == -1) &#123;<br>                                    var method_name = prettyMethod(jmethodID, 1);<br>                                    console.log(<span class="hljs-string">&quot;&lt;&gt;CallNonvirtual:&quot;</span>, DebugSymbol.fromAddress(this.returnAddress), class_name, obj_class_name, method_name);<br>                                &#125;<br>                            &#125;<br>                        &#125;,<br>                        onLeave: <span class="hljs-keyword">function</span> (retval) &#123; &#125;<br>                    &#125;);<br>                &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (symbol.name.indexOf(<span class="hljs-string">&quot;Call&quot;</span>) &gt;= 0 &amp;&amp; symbol.name.indexOf(<span class="hljs-string">&quot;Method&quot;</span>) &gt;= 0) &#123;<br>                    console.log(<span class="hljs-string">&quot;Call&lt;&gt;Method is at &quot;</span>, symbol.address, symbol.name);<br>                    Interceptor.attach(symbol.address, &#123;<br>                        onEnter: <span class="hljs-keyword">function</span> (args) &#123;<br>                            var module = Process.findModuleByAddress(this.returnAddress);<br>                            <span class="hljs-keyword">if</span> (module != null &amp;&amp; module.name.indexOf(so_name) == 0) &#123;<br>                                var java_class = args[1];<br>                                var mid = args[2];<br>                                var class_name = Java.vm.tryGetEnv().getObjectClassName(java_class);<br>                                <span class="hljs-keyword">if</span> (class_name.indexOf(<span class="hljs-string">&quot;java.&quot;</span>) == -1 &amp;&amp; class_name.indexOf(<span class="hljs-string">&quot;android.&quot;</span>) == -1) &#123;<br>                                    var method_name = prettyMethod(mid, 1);<br>                                    console.log(<span class="hljs-string">&quot;&lt;&gt;Call&lt;&gt;Method:&quot;</span>, DebugSymbol.fromAddress(this.returnAddress), class_name, method_name);<br>                                &#125;<br>                            &#125;<br>                        &#125;,<br>                        onLeave: <span class="hljs-keyword">function</span> (retval) &#123; &#125;<br>                    &#125;);<br>                &#125;<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (addrGetStringUTFChars != null) &#123;<br>            Interceptor.attach(addrGetStringUTFChars, &#123;<br>                onEnter: <span class="hljs-keyword">function</span> (args) &#123;<br>                &#125;,<br>                onLeave: <span class="hljs-keyword">function</span> (retval) &#123;<br>                    <span class="hljs-keyword">if</span> (retval != null) &#123;<br>                        var module = Process.findModuleByAddress(this.returnAddress);<br>                        <span class="hljs-keyword">if</span> (module != null &amp;&amp; module.name.indexOf(so_name) == 0) &#123;<br>                            var bytes = Memory.readCString(retval);<br>                            console.log(<span class="hljs-string">&quot;[GetStringUTFChars] result:&quot;</span> + bytes, DebugSymbol.fromAddress(this.returnAddress));<br><br>                            /** <span class="hljs-keyword">if</span>(bytes.indexOf(<span class="hljs-string">&quot;code&quot;</span>) != -1)&#123;<br>                            console.log(<span class="hljs-string">&quot;[GetStringUTFChars] result:&quot;</span> + bytes, DebugSymbol.fromAddress(this.returnAddress));<br>                        &#125;<br>                             */<br><br><br>                        &#125;<br>                    &#125;<br>                &#125;<br>            &#125;);<br>        &#125;<br>        <span class="hljs-keyword">if</span> (addrNewStringUTF != null) &#123;<br>            Interceptor.attach(addrNewStringUTF, &#123;<br>                onEnter: <span class="hljs-keyword">function</span> (args) &#123;<br>                    <span class="hljs-keyword">if</span> (args[1] != null) &#123;<br>                        var module = Process.findModuleByAddress(this.returnAddress);<br>                        <span class="hljs-keyword">if</span> (module != null &amp;&amp; module.name.indexOf(so_name) == 0) &#123;<br>                            var string = Memory.readCString(args[1]);<br>                            <span class="hljs-keyword">if</span> (string.indexOf(<span class="hljs-string">&quot;zh-Hans&quot;</span>) == -1) &#123;<br>                                <span class="hljs-keyword">if</span> (string.indexOf(<span class="hljs-string">&quot;RDcsQixFRSxGRCxGMSx&quot;</span>) !== -1)&#123;<br>                                    console.log(<span class="hljs-string">&quot;[NewStringUTF] bytes:&quot;</span> + string, DebugSymbol.fromAddress(this.returnAddress));<br>                                    console.log(Thread.backtrace(this.context,Backtracer.ACCURATE).map(DebugSymbol.fromAddress).<span class="hljs-built_in">join</span>(<span class="hljs-string">&#x27;\n&#x27;</span>) + <span class="hljs-string">&#x27;\n&#x27;</span>);<br>                                    console.log(<span class="hljs-string">&quot;-------------------------------------------------------------------------------------------------&quot;</span>);<br>                                &#125;<br><br>                            &#125;<br>                        &#125;<br><br>                    &#125;<br>                &#125;,<br>                onLeave: <span class="hljs-keyword">function</span> (retval) &#123; &#125;<br>            &#125;);<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (addrFindClass != null) &#123;<br>            Interceptor.attach(addrFindClass, &#123;<br>                onEnter: <span class="hljs-keyword">function</span> (args) &#123;<br>                    <span class="hljs-keyword">if</span> (args[1] != null) &#123;<br>                        var module = Process.findModuleByAddress(this.returnAddress);<br>                        <span class="hljs-keyword">if</span> (module != null &amp;&amp; module.name.indexOf(so_name) == 0) &#123;<br>                            var name = Memory.readCString(args[1]);<br>                            console.log(<span class="hljs-string">&quot;[FindClass] name:&quot;</span> + name, DebugSymbol.fromAddress(this.returnAddress));<br>                        &#125;<br>                    &#125;<br>                &#125;,<br>                onLeave: <span class="hljs-keyword">function</span> (retval) &#123; &#125;<br>            &#125;);<br>        &#125;<br>        <span class="hljs-keyword">if</span> (addrGetMethodID != null) &#123;<br>            Interceptor.attach(addrGetMethodID, &#123;<br>                onEnter: <span class="hljs-keyword">function</span> (args) &#123;<br>                    <span class="hljs-keyword">if</span> (args[2] != null) &#123;<br>                        var clazz = args[1];<br>                        var class_name = Java.vm.tryGetEnv().getClassName(clazz);<br>                        var module = Process.findModuleByAddress(this.returnAddress);<br>                        <span class="hljs-keyword">if</span> (module != null &amp;&amp; module.name.indexOf(so_name) == 0) &#123;<br>                            var name = Memory.readCString(args[2]);<br>                            <span class="hljs-keyword">if</span> (args[3] != null) &#123;<br>                                var sig = Memory.readCString(args[3]);<br>                                <span class="hljs-keyword">if</span>(class_name.indexOf(<span class="hljs-string">&quot;java.lang&quot;</span>) == -1 &amp;&amp; class_name.indexOf(<span class="hljs-string">&quot;org.keplerproject.luajava.LuaState&quot;</span>) == -1 &amp;&amp;class_name.indexOf(<span class="hljs-string">&quot;class_name:org.keplerproject.luajava.LuaState&quot;</span>) == -1 )&#123;<br>                                    console.log(<span class="hljs-string">&quot;[GetMethodID] class_name:&quot;</span> + class_name + <span class="hljs-string">&quot; name:&quot;</span> + name + <span class="hljs-string">&quot;, sig:&quot;</span> + sig, DebugSymbol.fromAddress(this.returnAddress));<br>                                &#125;<br><br>                            &#125; <span class="hljs-keyword">else</span> &#123;<br>                                <span class="hljs-keyword">if</span>(class_name.indexOf(<span class="hljs-string">&quot;java.lang&quot;</span>) == -1 &amp;&amp; class_name.indexOf(<span class="hljs-string">&quot;org.keplerproject.luajava.LuaState&quot;</span>) == -1 &amp;&amp;class_name.indexOf(<span class="hljs-string">&quot;class_name:org.keplerproject.luajava.LuaState&quot;</span>) == -1 )&#123;<br>                                    console.log(<span class="hljs-string">&quot;[GetMethodID] class_name:&quot;</span> + class_name + <span class="hljs-string">&quot; name:&quot;</span> + name, DebugSymbol.fromAddress(this.returnAddress));<br>                                &#125;<br>                            &#125;<br>                        &#125;<br>                    &#125;<br>                &#125;,<br>                onLeave: <span class="hljs-keyword">function</span> (retval) &#123; &#125;<br>            &#125;);<br>        &#125;<br>        <span class="hljs-keyword">if</span> (addrGetStaticMethodID != null) &#123;<br>            Interceptor.attach(addrGetStaticMethodID, &#123;<br>                onEnter: <span class="hljs-keyword">function</span> (args) &#123;<br>                    <span class="hljs-keyword">if</span> (args[2] != null) &#123;<br>                        var clazz = args[1];<br>                        var class_name = Java.vm.tryGetEnv().getClassName(clazz);<br>                        var module = Process.findModuleByAddress(this.returnAddress);<br>                        <span class="hljs-keyword">if</span> (module != null &amp;&amp; module.name.indexOf(so_name) == 0) &#123;<br>                            var name = Memory.readCString(args[2]);<br>                            <span class="hljs-keyword">if</span> (args[3] != null) &#123;<br>                                var sig = Memory.readCString(args[3]);<br>                                console.log(<span class="hljs-string">&quot;[GetStaticMethodID] class_name:&quot;</span> + class_name + <span class="hljs-string">&quot; name:&quot;</span> + name + <span class="hljs-string">&quot;, sig:&quot;</span> + sig, DebugSymbol.fromAddress(this.returnAddress));<br>                            &#125; <span class="hljs-keyword">else</span> &#123;<br>                                console.log(<span class="hljs-string">&quot;[GetStaticMethodID] class_name:&quot;</span> + class_name + <span class="hljs-string">&quot; name:&quot;</span> + name, DebugSymbol.fromAddress(this.returnAddress));<br>                            &#125;<br>                        &#125;<br>                    &#125;<br>                &#125;,<br>                onLeave: <span class="hljs-keyword">function</span> (retval) &#123; &#125;<br>            &#125;);<br>        &#125;<br>        <span class="hljs-keyword">if</span> (addrGetFieldID != null) &#123;<br>            Interceptor.attach(addrGetFieldID, &#123;<br>                onEnter: <span class="hljs-keyword">function</span> (args) &#123;<br>                    <span class="hljs-keyword">if</span> (args[2] != null) &#123;<br>                        var module = Process.findModuleByAddress(this.returnAddress);<br>                        <span class="hljs-keyword">if</span> (module != null &amp;&amp; module.name.indexOf(so_name) == 0) &#123;<br>                            var name = Memory.readCString(args[2]);<br>                            <span class="hljs-keyword">if</span> (args[3] != null) &#123;<br>                                var sig = Memory.readCString(args[3]);<br>                                console.log(<span class="hljs-string">&quot;[GetFieldID] name:&quot;</span> + name + <span class="hljs-string">&quot;, sig:&quot;</span> + sig, DebugSymbol.fromAddress(this.returnAddress));<br>                            &#125; <span class="hljs-keyword">else</span> &#123;<br>                                console.log(<span class="hljs-string">&quot;[GetFieldID] name:&quot;</span> + name, DebugSymbol.fromAddress(this.returnAddress));<br>                            &#125;<br>                        &#125;<br>                    &#125;<br>                &#125;,<br>                onLeave: <span class="hljs-keyword">function</span> (retval) &#123; &#125;<br>            &#125;);<br>        &#125;<br>        <span class="hljs-keyword">if</span> (addrGetStaticFieldID != null) &#123;<br>            Interceptor.attach(addrGetStaticFieldID, &#123;<br>                onEnter: <span class="hljs-keyword">function</span> (args) &#123;<br>                    <span class="hljs-keyword">if</span> (args[2] != null) &#123;<br>                        var module = Process.findModuleByAddress(this.returnAddress);<br>                        <span class="hljs-keyword">if</span> (module != null &amp;&amp; module.name.indexOf(so_name) == 0) &#123;<br>                            var name = Memory.readCString(args[2]);<br>                            <span class="hljs-keyword">if</span> (args[3] != null) &#123;<br>                                var sig = Memory.readCString(args[3]);<br>                                console.log(<span class="hljs-string">&quot;[GetStaticFieldID] name:&quot;</span> + name + <span class="hljs-string">&quot;, sig:&quot;</span> + sig, DebugSymbol.fromAddress(this.returnAddress));<br>                            &#125; <span class="hljs-keyword">else</span> &#123;<br>                                console.log(<span class="hljs-string">&quot;[GetStaticFieldID] name:&quot;</span> + name, DebugSymbol.fromAddress(this.returnAddress));<br>                            &#125;<br>                        &#125;<br>                    &#125;<br>                &#125;,<br>                onLeave: <span class="hljs-keyword">function</span> (retval) &#123; &#125;<br>            &#125;);<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (addrRegisterNatives != null) &#123;<br>            Interceptor.attach(addrRegisterNatives, &#123;<br>                onEnter: <span class="hljs-keyword">function</span> (args) &#123;<br>                    console.log(<span class="hljs-string">&quot;[RegisterNatives] method_count:&quot;</span>, args[3], DebugSymbol.fromAddress(this.returnAddress));<br>                    var <span class="hljs-built_in">env</span> = args[0];<br>                    var java_class = args[1];<br>                    var class_name = Java.vm.tryGetEnv().getClassName(java_class);<br><br>                    var methods_ptr = ptr(args[2]);<br><br>                    var method_count = parseInt(args[3]);<br>                    <span class="hljs-keyword">for</span> (var i = 0; i &lt; method_count; i++) &#123;<br>                        var name_ptr = Memory.readPointer(methods_ptr.add(i * Process.pointerSize * 3));<br>                        var sig_ptr = Memory.readPointer(methods_ptr.add(i * Process.pointerSize * 3 + Process.pointerSize));<br>                        var fnPtr_ptr = Memory.readPointer(methods_ptr.add(i * Process.pointerSize * 3 + Process.pointerSize * 2));<br><br>                        try &#123;<br>                            var name = Memory.readCString(name_ptr);<br>                        &#125;catch (e) &#123;<br>                            console.log(e)<br>                        &#125;<br><br>                        var sig = Memory.readCString(sig_ptr);<br>                        var find_module = Process.findModuleByAddress(fnPtr_ptr);<br>                        console.log(<span class="hljs-string">&quot;[RegisterNatives] java_class:&quot;</span>, class_name, <span class="hljs-string">&quot;name:&quot;</span>, name, <span class="hljs-string">&quot;sig:&quot;</span>, sig, <span class="hljs-string">&quot;fnPtr:&quot;</span>, fnPtr_ptr, <span class="hljs-string">&quot;module_name:&quot;</span>, find_module.name, <span class="hljs-string">&quot;module_base:&quot;</span>, find_module.base, <span class="hljs-string">&quot;offset:&quot;</span>, ptr(fnPtr_ptr).sub(find_module.base));<br><br>                    &#125;<br>                &#125;,<br>                onLeave: <span class="hljs-keyword">function</span> (retval) &#123; &#125;<br>            &#125;);<br>        &#125;<br>    &#125;<br><br>    setImmediate(hook_libart);<br><br>&#125;)();<br><br></code></pre></td></tr></table></figure>

<h3 id="从内存中搜索svc指令提前进行-patch"><a href="#从内存中搜索svc指令提前进行-patch" class="headerlink" title="从内存中搜索svc指令提前进行 patch"></a>从内存中搜索svc指令提前进行 patch</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">let</span> target_code_hex;<br><span class="hljs-built_in">let</span> call_number_openat;<br><span class="hljs-built_in">let</span> call_number_faccessat;<br><span class="hljs-built_in">let</span> <span class="hljs-built_in">arch</span> = Process.<span class="hljs-built_in">arch</span>;<br><br>/**<br> * 什么是 SVC syscall<br> * 系统调用 的命令<br> * 安卓分为四层<br> * 应用层 java层 c层 linux层<br> * svc就是arm汇编下 和内核交互的一个指令<br> * svc可以和内核交互<br> * 分为两部分 应该是用户态 一个是内核态<br> * 一些libc的函数 底层调用的其实就是 使用内核态去实现<br> *<br> *<br> * 怎么hook 内核态下的函数<br> * ptrcae    ptrace权限是非常高的可以直接调试内核态的东西<br> * inilenhook 遍历所有 svc的指令  去在执行svc指令之前把系统调用号改了改成自己需要的<br> *<br> * SElinux是什么<br> * selinux是liunx的一个子系统 他比linux更安全<br> * 他的主要作用就是最大程度的减小系统中服务进程的可访问的资源<br> * linux是以一个用户为标识 判断当前文件的权限是否可读写写可执行<br> * selinux更细节 他是以进程的方式判断是否可读写写可执行<br> * 他以进程为单位<br> *<br> * DAC 模式<br><br> 在没有使用 SELinux 的操作系统中，决定一个资源是否能被访问的因素是：某个资源是否拥有对应用户的权限（r、x、w）。<br><br> 只要访问这个资源的进程符合以上的条件就可以被访问。<br><br> 有问题的地方是root 用户不受任何管制，系统上任何资源都可以无限制地访问。<br><br> 这种权限管理机制的主体是用户，也称为自主访问控制（DAC）。<br><br><br> 2.3 MAC<br><br> 在使用了 SELinux 的操作系统中，决定一个资源是否能被访问的因素除了上述因素之外，还需要判断每一类进程是否拥有对某一类资源的访问权限。<br><br> 这样一来，即使进程是以 root 身份运行的，也需要判断这个进程的类型以及允许访问的资源类型才能决定是否允许访问某个资源。进程的活动空间也可以被压缩到最小。<br><br> 即使是以 root 身份运行的服务进程，一般也只能访问到它所需要的资源。即使程序出了漏洞，影响范围也只有在其允许访问的资源范围内。安全性大大增加。<br><br> 这种权限管理机制的主体是进程，也称为强制访问控制（MAC）。<br><br> 而 MAC 又细分为了两种方式，一种叫类别安全（MCS）模式，另一种叫多级安全（MLS）模式。<br><br> 下文中的操作均为 MCS 模式<br><br> 对用户判断后在对进程进行一次判断 就比如说 root用户 登录了qq 登录了一个qq所有人的qq信息以及一系列乱七八糟的的东西都能看<br> 但是在selinux下 用户 首先要获取读取权限然后 只能在自己的进程或者限定的进程中访问<br><br> *<br> * 3.5 SELinux 的工作模式<br><br> SELinux 有三种工作模式，分别是：<br><br> 1. enforcing：强制模式。违反 SELinux 规则的行为将被阻止并记录到日志中。<br><br> 2. permissive：宽容模式。违反 SELinux 规则的行为只会记录到日志中。一般为调试用。<br><br> 3. disabled：关闭 SELinux。<br><br> SELinux 工作模式可以在 /etc/selinux/config 中设定。<br><br> 如果想从 disabled 切换到 enforcing 或者 permissive 的话，需要重启系统。反过来也一样。<br><br> enforcing 和 permissive 模式可以通过 setenforce 1|0 命令快速切换。<br><br> 需要注意的是，如果系统已经在关闭 SELinux 的状态下运行了一段时间，在打开 SELinux 之后的第一次重启速度可能会比较慢。因为系统必须为磁盘中的文件创建安全上下文（我表示我重启了大约 10 分钟，还以为是死机了……）。<br><br> SELinux 日志的记录需要借助 auditd.service 这个服务，请不要禁用它。<br> *<br> * 安卓使用的安全机制是 selinux<br> * setenforce 1 开启    关闭强制模式<br> * setenforce 0 开启<br> * 每家手机厂商都不相同 有的 selinux 是开启的有的是关闭的 关闭时使用syscall就会不可读<br> */<br><br><span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;arm&quot;</span> === <span class="hljs-built_in">arch</span>)&#123;<br>    target_code_hex = <span class="hljs-string">&quot;00 00 00 EF&quot;</span>;<br>    call_number_openat = 322;<br>    call_number_faccessat = 334;<br>&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;arm64&quot;</span> === <span class="hljs-built_in">arch</span>)&#123;<br>    target_code_hex = <span class="hljs-string">&quot;01 00 00 D4&quot;</span>;<br>    call_number_openat = 56;<br>    call_number_faccessat = 48;<br>&#125;<span class="hljs-keyword">else</span> &#123;<br>    console.log(<span class="hljs-string">&quot;arch not support!&quot;</span>)<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">arch</span>)&#123;<br>    console.log(<span class="hljs-string">&quot;\nthe_arch = &quot;</span> + <span class="hljs-built_in">arch</span>);<br>    // 直接Process.enumerateModules()，可能会因为某些地址不可读造成非法访问<br>    Process.enumerateRanges(<span class="hljs-string">&#x27;r--&#x27;</span>).forEach(<span class="hljs-keyword">function</span> (range) &#123;<br>        <span class="hljs-keyword">if</span>(!range.file || !range.file.path)&#123;<br>            <span class="hljs-built_in">return</span>;<br>        &#125;<br>        <span class="hljs-built_in">let</span> path = range.file.path;<br>        <span class="hljs-keyword">if</span> ((!path.startsWith(<span class="hljs-string">&quot;/data/app/&quot;</span>)) || (!path.endsWith(<span class="hljs-string">&quot;.so&quot;</span>)))&#123;<br>            <span class="hljs-built_in">return</span>;<br>        &#125;<br>        <span class="hljs-built_in">let</span> baseAddress = Module.getBaseAddress(path);<br>        <span class="hljs-built_in">let</span> soNameList = path.split(<span class="hljs-string">&quot;/&quot;</span>);<br>        <span class="hljs-built_in">let</span> soName = soNameList[soNameList.length - 1];<br>        console.log(<span class="hljs-string">&quot;\npath = &quot;</span> + path + <span class="hljs-string">&quot; , baseAddress = &quot;</span> + baseAddress + <span class="hljs-string">&quot; , rangeAddress = &quot;</span> + range.base + <span class="hljs-string">&quot; , size = &quot;</span> + range.size);<br><br>        Memory.scan(range.base, range.size, target_code_hex, &#123;<br>            onMatch: <span class="hljs-keyword">function</span> (match)&#123;<br>                <span class="hljs-built_in">let</span> code_address = match;<br>                <span class="hljs-built_in">let</span> code_address_str = code_address.toString();<br>                <span class="hljs-keyword">if</span> (code_address_str.endsWith(<span class="hljs-string">&quot;0&quot;</span>) || code_address_str.endsWith(<span class="hljs-string">&quot;4&quot;</span>) || code_address_str.endsWith(<span class="hljs-string">&quot;8&quot;</span>) || code_address_str.endsWith(<span class="hljs-string">&quot;c&quot;</span>))&#123;<br>                    console.log(<span class="hljs-string">&quot;--------------------------&quot;</span>);<br>                    <span class="hljs-built_in">let</span> call_number = 0;<br>                    <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;arm&quot;</span> === <span class="hljs-built_in">arch</span>)&#123;<br>                        // call_number = (code_address.sub(0x4).readS16() - 28672);  // 0x7000<br>                        call_number = (code_address.sub(0x4).readS32()) &amp; 0xFFF;<br>                    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;arm64&quot;</span> === <span class="hljs-built_in">arch</span>)&#123;<br>                        call_number = (code_address.sub(0x4).readS32() &gt;&gt; 5) &amp; 0xFFFF;<br>                    &#125;<span class="hljs-keyword">else</span> &#123;<br>                        console.log(<span class="hljs-string">&quot;the arch get call_number not support!&quot;</span>)<br>                    &#125;<br>                    console.log(<span class="hljs-string">&quot;find svc : so_name = &quot;</span> + soName + <span class="hljs-string">&quot; , address = &quot;</span> + code_address + <span class="hljs-string">&quot; , call_number = &quot;</span> + call_number + <span class="hljs-string">&quot; , offset = &quot;</span> + code_address.sub(baseAddress));<br><br>                    // hook svc __NR_openat<br>                    <span class="hljs-keyword">if</span> (call_number_openat === call_number)&#123;<br>                        <span class="hljs-built_in">let</span> target_hook_addr = code_address;<br>                        <span class="hljs-built_in">let</span> target_hook_addr_offset = target_hook_addr.sub(baseAddress);<br>                        console.log(<span class="hljs-string">&quot;find svc openat , start inlinehook by frida!&quot;</span>)<br>                        Interceptor.attach(target_hook_addr, &#123;<br>                            onEnter: <span class="hljs-keyword">function</span> (args)&#123;<br>                                console.log(<span class="hljs-string">&quot;\nonEnter_&quot;</span> + target_hook_addr_offset + <span class="hljs-string">&quot; , __NR_openat , args[1] = &quot;</span> + args[1].readCString());<br>                                this.new_addr = Memory.allocUtf8String(<span class="hljs-string">&quot;/proc/self/status11&quot;</span>);<br>                                args[1] = this.new_addr;<br>                                console.log(<span class="hljs-string">&quot;onEnter_&quot;</span> + target_hook_addr_offset + <span class="hljs-string">&quot; , __NR_openat , args[1] = &quot;</span> + args[1].readCString());<br>                            &#125;, onLeave: <span class="hljs-keyword">function</span> (retval)&#123;<br>                                console.log(<span class="hljs-string">&quot;onLeave_&quot;</span> + target_hook_addr_offset + <span class="hljs-string">&quot; , __NR_openat , retval = &quot;</span> + retval)<br>                            &#125;<br>                        &#125;);<br><br>                    &#125;<br>                    // hook svc __NR_faccessat<br>                    <span class="hljs-keyword">if</span> (call_number_faccessat === call_number)&#123;<br>                        <span class="hljs-built_in">let</span> target_hook_addr = code_address;<br>                        <span class="hljs-built_in">let</span> target_hook_addr_offset = target_hook_addr.sub(baseAddress);<br>                        console.log(<span class="hljs-string">&quot;find svc faccessat , start inlinehook by frida!&quot;</span>)<br>                        Interceptor.attach(target_hook_addr, &#123;<br>                            onEnter: <span class="hljs-keyword">function</span> (args)&#123;<br>                                console.log(<span class="hljs-string">&quot;\nonEnter_&quot;</span> + target_hook_addr_offset + <span class="hljs-string">&quot; , __NR_faccessat , args[1] = &quot;</span> + args[1].readCString());<br>                                // this.new_addr = Memory.allocUtf8String(<span class="hljs-string">&quot;/proc/self/status11&quot;</span>);<br>                                // args[1] = this.new_addr;<br>                                console.log(<span class="hljs-string">&quot;onEnter_&quot;</span> + target_hook_addr_offset + <span class="hljs-string">&quot; , __NR_faccessat , args[1] = &quot;</span> + args[1].readCString());<br>                            &#125;, onLeave: <span class="hljs-keyword">function</span> (retval)&#123;<br>                                console.log(<span class="hljs-string">&quot;onLeave_&quot;</span> + target_hook_addr_offset + <span class="hljs-string">&quot; , __NR_faccessat , retval = &quot;</span> + retval)<br>                            &#125;<br>                        &#125;);<br><br>                    &#125;<br>                &#125;<br>            &#125;, onComplete: <span class="hljs-function"><span class="hljs-title">function</span></span> () &#123;&#125;<br>        &#125;);<br><br>    &#125;);<br>&#125;<br><br></code></pre></td></tr></table></figure>
<h3 id="通过-linke对so加载进行监控"><a href="#通过-linke对so加载进行监控" class="headerlink" title="通过 linke对so加载进行监控"></a>通过 linke对so加载进行监控</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">hook_constructor</span></span>() &#123;<br>    <span class="hljs-keyword">if</span> (Process.pointerSize == 4) &#123;<br>        var linker = Process.findModuleByName(<span class="hljs-string">&quot;linker&quot;</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        var linker = Process.findModuleByName(<span class="hljs-string">&quot;linker64&quot;</span>);<br>    &#125;<br><br>    var addr_call_function =null;<br>    var addr_g_ld_debug_verbosity = null;<br>    var addr_async_safe_format_log = null;<br>    <span class="hljs-keyword">if</span> (linker) &#123;<br>        var symbols = linker.enumerateSymbols();<br>        <span class="hljs-keyword">for</span> (var i = 0; i &lt; symbols.length; i++) &#123;<br>            var name = symbols[i].name;<br>            <span class="hljs-keyword">if</span> (name.indexOf(<span class="hljs-string">&quot;call_function&quot;</span>) &gt;= 0)&#123;<br>                addr_call_function = symbols[i].address;<br>            &#125;<br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(name.indexOf(<span class="hljs-string">&quot;g_ld_debug_verbosity&quot;</span>) &gt;=0)&#123;<br>                addr_g_ld_debug_verbosity = symbols[i].address;<br>              <br>                ptr(addr_g_ld_debug_verbosity).writeInt(2);<br><br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(name.indexOf(<span class="hljs-string">&quot;async_safe_format_log&quot;</span>) &gt;=0 &amp;&amp; name.indexOf(<span class="hljs-string">&#x27;va_list&#x27;</span>) &lt; 0)&#123;<br>            <br>                addr_async_safe_format_log = symbols[i].address;<br><br>            &#125; <br><br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span>(addr_async_safe_format_log)&#123;<br>        Interceptor.attach(addr_async_safe_format_log,&#123;<br>            onEnter: <span class="hljs-keyword">function</span>(args)&#123;<br>                this.log_level  = args[0];<br>                this.tag = ptr(args[1]).readCString()<br>                this.fmt = ptr(args[2]).readCString()<br>                <span class="hljs-keyword">if</span>(this.fmt.indexOf(<span class="hljs-string">&quot;c-tor&quot;</span>) &gt;= 0 &amp;&amp; this.fmt.indexOf(<span class="hljs-string">&#x27;Done&#x27;</span>) &lt; 0)&#123;<br>                    this.function_type = ptr(args[3]).readCString(), // func_type<br>                    this.so_path = ptr(args[5]).readCString();<br>                    var strs = new Array(); //定义一数组 <br>                    strs = this.so_path.split(<span class="hljs-string">&quot;/&quot;</span>); //字符分割<br>                    this.so_name = strs.pop();<br>                    this.func_offset  = ptr(args[4]).sub(Module.findBaseAddress(this.so_name)) <br>                     console.log(<span class="hljs-string">&quot;func_type:&quot;</span>, this.function_type,<br>                        <span class="hljs-string">&#x27;\nso_name:&#x27;</span>,this.so_name,<br>                        <span class="hljs-string">&#x27;\nso_path:&#x27;</span>,this.so_path,<br>                        <span class="hljs-string">&#x27;\nfunc_offset:&#x27;</span>,this.func_offset <br>                     );<br>                &#125;<br>            &#125;,<br>            onLeave: <span class="hljs-keyword">function</span>(retval)&#123;<br><br>            &#125;<br>        &#125;)<br>    &#125;<br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">main</span></span>() &#123;<br>    hook_constructor();<br>&#125;<br>setImmediate(main);<br></code></pre></td></tr></table></figure>
<h3 id="Stalker-Trace-对着学stalker时写的一个小脚本可以和ida-trace一样输出"><a href="#Stalker-Trace-对着学stalker时写的一个小脚本可以和ida-trace一样输出" class="headerlink" title="Stalker Trace    对着学stalker时写的一个小脚本可以和ida trace一样输出"></a>Stalker Trace    对着学stalker时写的一个小脚本可以和ida trace一样输出</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">StalkerTrace</span></span>() &#123;<br>    var soNmae = <span class="hljs-string">&quot;libtuzi.so&quot;</span>;<br>    var base_hello_jni = Module.findBaseAddress(soNmae);<br>    var ptr = base_hello_jni.add(0x14432);<br>    var module_hello_jni = Process.findModuleByName(soNmae);<br>    var module_Start = module_hello_jni.base;<br>    var module_End = module_Start + module_hello_jni.size;<br>    var pre_regs = &#123;&#125;;<br>    var isTrace = <span class="hljs-literal">false</span>;   //打印全部寄存器<br>    Interceptor.attach(ptr, &#123;<br>        onEnter: <span class="hljs-keyword">function</span> (args) &#123;<br>            this.arg0 = args[0];<br>            this.arg1 = args[1];<br>            this.arg2 = args[2];<br>            this.tid = Process.getCurrentThreadId();<br>            //为什么在Interceptor内使用呢因为可以减少指令的输出只输出函数内的更加准确好用<br>            Stalker.follow(this.tid, &#123;<br>                events: &#123;<br>                    call: <span class="hljs-literal">true</span>, // CALL instructions: <span class="hljs-built_in">yes</span> please<br>                    // Other events:<br>                    ret: <span class="hljs-literal">false</span>, // RET instructions<br>                    <span class="hljs-built_in">exec</span>: <span class="hljs-literal">true</span>, // all instructions: not recommended as it<span class="hljs-string">&#x27;s</span><br><span class="hljs-string">                    //                   a lot of data</span><br><span class="hljs-string">                    block: false, // block executed: coarse execution trace</span><br><span class="hljs-string">                    compile: false // block compiled: useful for coverage</span><br><span class="hljs-string">                &#125;,</span><br><span class="hljs-string">                transform: function (iterator) &#123;</span><br><span class="hljs-string">                    let instruction = iterator.next();</span><br><span class="hljs-string">                    do &#123;</span><br><span class="hljs-string">                        const startAddress = instruction.address;</span><br><span class="hljs-string">                        const is_module_code = startAddress.compare(module_Start) &gt;= 0 &amp;&amp;</span><br><span class="hljs-string">                            startAddress.compare(module_End) === -1;</span><br><span class="hljs-string"></span><br><span class="hljs-string">                        if (is_module_code) &#123;</span><br><span class="hljs-string">                            iterator.putCallout(function (context) &#123;</span><br><span class="hljs-string">                                var pc = context.pc;</span><br><span class="hljs-string">                                pc = pc -0x4;  // 不减一下 寄存器变化会和 内容不一致</span><br><span class="hljs-string">                                var module = Process.findModuleByAddress(pc);</span><br><span class="hljs-string">                                if (module)&#123;</span><br><span class="hljs-string">                                    if (!isTrace)&#123;</span><br><span class="hljs-string">                                        if (module.name == soNmae) &#123;</span><br><span class="hljs-string">                                            var diff_regs = get_diff_regs(context, pre_regs);</span><br><span class="hljs-string">                                            if(diff_regs == null)&#123;</span><br><span class="hljs-string">                                                console.log(ptr(pc).sub(module.base), Instruction.parse(ptr(pc)));</span><br><span class="hljs-string">                                            &#125;else&#123;</span><br><span class="hljs-string">                                                console.log(ptr(pc).sub(module.base), Instruction.parse(ptr(pc)),</span><br><span class="hljs-string">                                                 diff_regs);</span><br><span class="hljs-string">                                            &#125;</span><br><span class="hljs-string">                                        &#125;</span><br><span class="hljs-string">                                    &#125;else &#123;</span><br><span class="hljs-string">                                        console.log(module.name + &quot;!&quot; + ptr(pc).sub(module.base),Instruction.parse(ptr(pc)));</span><br><span class="hljs-string">                                        console.log(JSON.stringify(context));</span><br><span class="hljs-string">                                    &#125;</span><br><span class="hljs-string">                                &#125;</span><br><span class="hljs-string">                            &#125;);</span><br><span class="hljs-string">                        &#125;</span><br><span class="hljs-string">                        iterator.keep();</span><br><span class="hljs-string">                    &#125; while ((instruction = iterator.next()) !== null);</span><br><span class="hljs-string">                &#125;</span><br><span class="hljs-string">            &#125;);</span><br><span class="hljs-string">        &#125;, onLeave: function (retval) &#123;</span><br><span class="hljs-string">            Stalker.unfollow(this.tid);</span><br><span class="hljs-string">        &#125;</span><br><span class="hljs-string">    &#125;)</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">function get_diff_regs(context,pre_regs)&#123;</span><br><span class="hljs-string">    var diff_regs = &#123;&#125;</span><br><span class="hljs-string">    for (const [reg_name,reg_value] of Object.entries(JSON.parse(JSON.stringify(context))))&#123;</span><br><span class="hljs-string">        if (reg_name !== &quot;pc&quot; &amp;&amp; pre_regs[reg_name] !== reg_value)&#123;</span><br><span class="hljs-string">            var ret = &quot;   ;   &quot;+reg_name +&quot; = &quot;+ pre_regs[reg_name] +&quot; -&gt; &quot;+ reg_value</span><br><span class="hljs-string">            pre_regs[reg_name] = reg_value;</span><br><span class="hljs-string">            diff_regs[reg_name] = reg_value;</span><br><span class="hljs-string">            return ret;</span><br><span class="hljs-string">        &#125;</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">    return null;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure>
<h3 id="frida-seccomp-拦截svc"><a href="#frida-seccomp-拦截svc" class="headerlink" title="frida + seccomp     拦截svc"></a>frida + seccomp     拦截svc</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">let</span> install_filter = null, syscall_thread_ptr, call_task, lock, unlock, findSoinfoByAddr, solist_get_head_ptr, get_soname, get_base, get_size, maps = [];<br>const MAX_STACK_TRACE_DEPTH = 10;<br>const Target_NR = 56; //hook的系统调用号<br>const prctl_ptr = Module.findExportByName(null, <span class="hljs-string">&#x27;prctl&#x27;</span>)<br>const strcpy_ptr = Module.findExportByName(null, <span class="hljs-string">&#x27;strcpy&#x27;</span>)<br>const fopen_ptr = Module.findExportByName(null, <span class="hljs-string">&#x27;fopen&#x27;</span>)<br>const fclose_ptr = Module.findExportByName(null, <span class="hljs-string">&#x27;fclose&#x27;</span>)<br>const fgets_ptr = Module.findExportByName(null, <span class="hljs-string">&#x27;fgets&#x27;</span>)<br>const strtoul_ptr = Module.findExportByName(null, <span class="hljs-string">&#x27;strtoul&#x27;</span>)<br>const strtok_ptr = Module.findExportByName(null, <span class="hljs-string">&#x27;strtok&#x27;</span>)<br>const malloc_ptr = Module.findExportByName(null, <span class="hljs-string">&#x27;malloc&#x27;</span>)<br>const __android_log_print_ptr = Module.findExportByName(null, <span class="hljs-string">&#x27;__android_log_print&#x27;</span>)<br>const pthread_create_ptr = Module.findExportByName(null, <span class="hljs-string">&#x27;pthread_create&#x27;</span>)<br>const pthread_mutex_init_ptr = Module.findExportByName(null, <span class="hljs-string">&#x27;pthread_mutex_init&#x27;</span>)<br>const pthread_mutex_lock_ptr = Module.findExportByName(null, <span class="hljs-string">&#x27;pthread_mutex_lock&#x27;</span>)<br>const pthread_mutex_unlock_ptr = Module.findExportByName(null, <span class="hljs-string">&#x27;pthread_mutex_unlock&#x27;</span>)<br>const pthread_join_ptr = Module.findExportByName(null, <span class="hljs-string">&#x27;pthread_join&#x27;</span>)<br>const syscall_ptr = Module.findExportByName(null, <span class="hljs-string">&#x27;syscall&#x27;</span>)<br>const linker = Process.findModuleByName(<span class="hljs-string">&quot;linker64&quot;</span>);<br>const linker_symbols = linker.enumerateSymbols()<br><span class="hljs-keyword">for</span> (<span class="hljs-built_in">let</span> index = 0; index &lt; linker_symbols.length; index++) &#123;<br>    const element = linker_symbols[index];<br>    <span class="hljs-keyword">if</span> (element.name == <span class="hljs-string">&#x27;__dl__Z15solist_get_headv&#x27;</span>) &#123;<br>        solist_get_head_ptr = element.address<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (element.name == <span class="hljs-string">&#x27;__dl__ZNK6soinfo10get_sonameEv&#x27;</span>) &#123;<br>        get_soname = new NativeFunction(element.address, <span class="hljs-string">&quot;pointer&quot;</span>, [<span class="hljs-string">&quot;pointer&quot;</span>])<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">init</span></span>() &#123;<br>    //初始化，需要在主线程初始化且需要一个比较早的时机，frida脚本运行在它自己创建的一个线程，所以需要通过hook安装seccomp规则<br>    syscall_thread_ptr = new NativeFunction(cm.pthread_syscall_create, <span class="hljs-string">&quot;pointer&quot;</span>, [])()<br>    findSoinfoByAddr = new NativeFunction(cm.findSoinfoByAddr, <span class="hljs-string">&quot;pointer&quot;</span>, [<span class="hljs-string">&quot;pointer&quot;</span>])<br>    get_base = new NativeFunction(cm.get_base, <span class="hljs-string">&quot;uint64&quot;</span>, [<span class="hljs-string">&quot;pointer&quot;</span>])<br>    get_size = new NativeFunction(cm.get_size, <span class="hljs-string">&quot;size_t&quot;</span>, [<span class="hljs-string">&quot;pointer&quot;</span>])<br>    call_task = new NativeFunction(cm.call_task, <span class="hljs-string">&quot;pointer&quot;</span>, [<span class="hljs-string">&quot;pointer&quot;</span>, <span class="hljs-string">&quot;pointer&quot;</span>, <span class="hljs-string">&quot;int&quot;</span>])<br>    install_filter = new NativeFunction(cm.install_filter, <span class="hljs-string">&quot;int&quot;</span>, [<span class="hljs-string">&#x27;uint32&#x27;</span>])<br>    lock = new NativeFunction(cm.lock, <span class="hljs-string">&quot;int&quot;</span>, [<span class="hljs-string">&quot;pointer&quot;</span>])<br>    unlock = new NativeFunction(cm.unlock, <span class="hljs-string">&quot;int&quot;</span>, [<span class="hljs-string">&quot;pointer&quot;</span>])<br>    // 异常处理<br>    Process.setExceptionHandler(<span class="hljs-keyword">function</span> (details) &#123;<br>        const current_off = details.context.pc - 4;<br>        // 判断是否是seccomp导致的异常 读取opcode 010000d4 == svc 0<br>        <span class="hljs-keyword">if</span> (details.message == <span class="hljs-string">&quot;system error&quot;</span> &amp;&amp; details.type == <span class="hljs-string">&quot;system&quot;</span> &amp;&amp; hex(ptr(current_off).readByteArray(4)) == <span class="hljs-string">&quot;010000d4&quot;</span>) &#123;<br>            // 上锁避免多线程问题<br>            lock(syscall_thread_ptr)<br>            // 获取x8寄存器中的调用号<br>            const nr = details.context.x8.toString(10);<br>            <span class="hljs-built_in">let</span> loginfo = <span class="hljs-string">&quot;\n==================&quot;</span><br>            loginfo += `\nSVC[<span class="hljs-variable">$&#123;syscalls[nr][1]&#125;</span>|<span class="hljs-variable">$&#123;nr&#125;</span>] ==&gt; PC:<span class="hljs-variable">$&#123;addrToString(current_off)&#125;</span> P<span class="hljs-variable">$&#123;Process.id&#125;</span>-T<span class="hljs-variable">$&#123;Process.getCurrentThreadId()&#125;</span>`<br>            // 构造线程syscall调用参数<br>            const args = Memory.alloc(7 * 8)<br>            args.writePointer(details.context.x8)<br>            <span class="hljs-built_in">let</span> args_reg_arr = &#123;&#125;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-built_in">let</span> index = 0; index &lt; 6; index++) &#123;<br>                <span class="hljs-built_in">eval</span>(`args.add(8 * (index + 1)).writePointer(details.context.x<span class="hljs-variable">$&#123;index&#125;</span>)`)<br>                <span class="hljs-built_in">eval</span>(`args_reg_arr[<span class="hljs-string">&quot;arg<span class="hljs-variable">$&#123;index&#125;</span>&quot;</span>] = details.context.x<span class="hljs-variable">$&#123;index&#125;</span>`)<br>            &#125;<br><br>            // 获取手动堆栈信息<br>            //loginfo += <span class="hljs-string">&quot;\n&quot;</span> + stacktrace(ptr(current_off), details.context.fp, details.context.sp).map(addrToString).<span class="hljs-built_in">join</span>(<span class="hljs-string">&#x27;\n&#x27;</span>)<br><br><br>            // 打印传参<br>            loginfo += <span class="hljs-string">&quot;\nargs = &quot;</span> + JSON.stringify(args_reg_arr)<br><br>            loginfo += <span class="hljs-string">&quot;\npath = &quot;</span> + args_reg_arr.arg1.readCString()<br><br>            // 调用线程syscall 赋值x0寄存器<br>            details.context.x0 = call_task(syscall_thread_ptr, args, 0)<br><br>            loginfo += <span class="hljs-string">&quot;\nret = &quot;</span> + details.context.x0.toString()<br><br>            // 打印信息<br>            call_thread_log(loginfo)<br>            // 解锁<br>            unlock(syscall_thread_ptr)<br>            <span class="hljs-built_in">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>        <span class="hljs-built_in">return</span> <span class="hljs-literal">false</span>;<br>    &#125;)<br>    // openat的调用号<br>    install_filter(Target_NR)<br>&#125;<br><br>// CModule模块编写<br>const cm = new CModule(`<br><span class="hljs-comment">#include &lt;stdio.h&gt;</span><br><span class="hljs-comment">#include &lt;gum/gumprocess.h&gt;</span><br><span class="hljs-comment">#define BPF_STMT(code,k) &#123; (unsigned short) (code), 0, 0, k &#125;</span><br><span class="hljs-comment">#define BPF_JUMP(code,k,jt,jf) &#123; (unsigned short) (code), jt, jf, k &#125;</span><br><span class="hljs-comment">#define BPF_LD 0x00</span><br><span class="hljs-comment">#define BPF_W 0x00</span><br><span class="hljs-comment">#define BPF_ABS 0x20</span><br><span class="hljs-comment">#define BPF_JEQ 0x10</span><br><span class="hljs-comment">#define BPF_JMP 0x05</span><br><span class="hljs-comment">#define BPF_K 0x00</span><br><span class="hljs-comment">#define BPF_RET 0x06</span><br><br><span class="hljs-comment">#define PR_SET_SECCOMP	22</span><br><span class="hljs-comment">#define PR_SET_NO_NEW_PRIVS	38</span><br><span class="hljs-comment">#define SECCOMP_MODE_FILTER	2</span><br><span class="hljs-comment">#define SECCOMP_RET_TRAP 0x00030000U</span><br><span class="hljs-comment">#define SECCOMP_RET_ALLOW 0x7fff0000U</span><br><br><span class="hljs-comment">#define SIGSYS  12</span><br><span class="hljs-comment">#define SIG_UNBLOCK     2</span><br><br>typedef unsigned char __u8;<br>typedef unsigned short __u16;<br>typedef unsigned int __u32;<br>typedef unsigned long long __u64;<br>typedef unsigned long sigset_t;<br>typedef long pthread_t;<br><br>typedef struct &#123;<br>    uint32_t flags;<br>    void* stack_base;<br>    size_t stack_size;<br>    size_t guard_size;<br>    int32_t sched_policy;<br>    int32_t sched_priority;<br>  <span class="hljs-comment">#ifdef __LP64__</span><br>    char __reserved[16];<br>  <span class="hljs-comment">#endif</span><br>  &#125; pthread_attr_t;<br><br>typedef struct &#123;<br><span class="hljs-comment">#if defined(__LP64__)</span><br>  int32_t __private[10];<br><span class="hljs-comment">#else</span><br>  int32_t __private[1];<br><span class="hljs-comment">#endif</span><br>&#125; pthread_mutex_t;<br><br>typedef struct &#123;<br>    int <span class="hljs-built_in">type</span>;<br>    int isTask;<br>    void *args;<br>    int isReturn;<br>    void *ret;<br>    pthread_t thread;<br>    pthread_mutex_t mutex;<br>&#125; thread_syscall_t;<br><br>typedef struct&#123;<br>    const void *phdr;<br>    size_t phnum;<br>    uint64_t base;<br>    size_t size;<br>    void *dynamic;<br>    void *next;<br>&#125; soinfo;<br><br>extern char* strcpy(char* __dst, const char* __src);<br>extern void* fopen(const char* __path, const char* __mode);<br>extern int fclose(void* __fp);<br>extern char* fgets(char* __buf, int __size, void* __fp);<br>extern unsigned long strtoul(const char* __s, char** __end_ptr, int __base);<br>extern char* strtok(char* __s, const char* __delimiter);<br>extern soinfo *solist_get_head();<br>extern int __android_log_print(int prio, const char* tag, const char* <span class="hljs-built_in">fmt</span>, ...);<br>extern void *malloc(size_t __byte_count);<br>extern long syscall(long __number, ...);<br>extern int pthread_create(pthread_t* __pthread_ptr, pthread_attr_t const* __attr, void* (*__start_routine)(void*), void*);<br>extern int pthread_mutex_init(pthread_mutex_t* __mutex, const void* __attr);<br>extern int pthread_mutex_lock(pthread_mutex_t* __mutex);<br>extern int pthread_mutex_unlock(pthread_mutex_t* __mutex);<br>extern int pthread_join(pthread_t __pthread, void** __return_value_ptr);<br>extern void on_message(const gchar *message);<br>extern int prctl(int __option, ...);<br><br>uint64_t get_base(soinfo *si)&#123;<br>    <span class="hljs-built_in">return</span> si-&gt;base;<br>&#125;<br><br>size_t get_size(soinfo *si)&#123;<br>    <span class="hljs-built_in">return</span> si-&gt;size;<br>&#125;<br><br>soinfo *findSoinfoByAddr(void *addr_v) &#123;<br>    uint64_t addr = (uint64_t) addr_v;<br>    <span class="hljs-keyword">for</span> (soinfo *si = (soinfo *)solist_get_head(); si != NULL; si = si-&gt;next) &#123;<br>      <span class="hljs-keyword">if</span> (addr &gt;= si-&gt;base &amp;&amp; addr &lt; (si-&gt;base + si-&gt;size)) &#123;<br>        <span class="hljs-built_in">return</span> si;<br>      &#125;<br>    &#125;<br>    <span class="hljs-built_in">return</span> NULL;<br>&#125;<br><br>static void <span class="hljs-built_in">log</span>(const gchar *format, ...)<br>&#123;<br>    gchar *message;<br>    va_list args;<br>    va_start(args, format);<br>    message = g_strdup_vprintf(format, args);<br>    va_end(args);<br>    on_message(message);<br>    g_free(message);<br>&#125;<br><br>int lock(thread_syscall_t *syscall_thread)&#123;<br>    <span class="hljs-built_in">return</span> pthread_mutex_lock(&amp;syscall_thread-&gt;mutex);<br>&#125;<br><br>int unlock(thread_syscall_t *syscall_thread)&#123;<br>    <span class="hljs-built_in">return</span> pthread_mutex_unlock(&amp;syscall_thread-&gt;mutex);<br>&#125;<br><br>void *call_syscall(void *args)&#123;<br>    void **d_args = (void **)args;<br>    void *ret = (void *)syscall((long)d_args[0] ,d_args[1] ,d_args[2] ,d_args[3], d_args[4], d_args[5], d_args[6]);<br>    <span class="hljs-built_in">return</span> ret;<br>&#125;<br><br>void *call_log(void *args)&#123;<br>    __android_log_print(3, <span class="hljs-string">&quot;tuziSeccmop&quot;</span>, (const char *)args);<br>    <span class="hljs-built_in">return</span> NULL;<br>&#125;<br><br>void *call_read_maps(void *args)&#123;<br>    uint64_t addr = (uint64_t) args;<br>    FILE *fp = fopen(<span class="hljs-string">&quot;/proc/self/maps&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>);<br>    char line[1024];<br>    char _line[1024];<br>    uint64_t start, end;<br>    <span class="hljs-keyword">while</span> (fgets(line, sizeof(line), fp) != NULL) &#123;<br>        strcpy(_line, line);<br>        start = (uint64_t) strtoul(strtok(line, <span class="hljs-string">&quot;-&quot;</span>), NULL, 16);<br>        end = (uint64_t) strtoul(strtok(NULL, <span class="hljs-string">&quot; &quot;</span>), NULL, 16);<br>        <span class="hljs-keyword">if</span> (addr &gt;= start &amp;&amp; addr &lt; end) &#123;<br>          <span class="hljs-built_in">break</span>;<br>        &#125;<br>    &#125;<br>    fclose(fp);<br>    <span class="hljs-built_in">return</span> (void *)_line;<br>&#125;<br><br>void *call_task(thread_syscall_t *syscall_thread,void *args,int <span class="hljs-built_in">type</span>)&#123;<br>    <span class="hljs-keyword">if</span>(syscall_thread-&gt;isTask == 0)&#123;<br>        syscall_thread-&gt;args = args;<br>        syscall_thread-&gt;<span class="hljs-built_in">type</span> = <span class="hljs-built_in">type</span>;<br>        syscall_thread-&gt;isTask = 1;<br>    &#125;<br>    <span class="hljs-keyword">do</span>&#123;<br>        <span class="hljs-keyword">if</span>(syscall_thread-&gt;isReturn)&#123;<br>            syscall_thread-&gt;isReturn = 0;<br>            <span class="hljs-built_in">return</span> syscall_thread-&gt;ret;<br>        &#125;<br>    &#125;<span class="hljs-keyword">while</span>(1);<br>&#125;<br><br>void *pthread_syscall(void *args)&#123;<br>    thread_syscall_t *syscall_thread = (thread_syscall_t *)args;<br>    <span class="hljs-keyword">while</span>(1)&#123;<br>        <span class="hljs-keyword">if</span>(syscall_thread-&gt;isTask)&#123;<br>            <span class="hljs-keyword">if</span>(syscall_thread-&gt;<span class="hljs-built_in">type</span> == 0)&#123;<br>                syscall_thread-&gt;ret = call_syscall(syscall_thread-&gt;args);<br>            &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(syscall_thread-&gt;<span class="hljs-built_in">type</span> == 1)&#123;<br>                syscall_thread-&gt;ret = call_log(syscall_thread-&gt;args);<br>            &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(syscall_thread-&gt;<span class="hljs-built_in">type</span> == 2)&#123;<br>                syscall_thread-&gt;ret = call_read_maps(syscall_thread-&gt;args);<br>            &#125;<br>            syscall_thread-&gt;args = NULL;<br>            syscall_thread-&gt;isReturn = 1;<br>            syscall_thread-&gt;isTask = 0;<br>        &#125;<br>    &#125;<br>    <span class="hljs-built_in">return</span> NULL;<br>&#125;<br><br>//syscall线程创建<br><br>thread_syscall_t *<span class="hljs-function"><span class="hljs-title">pthread_syscall_create</span></span>()&#123;<br>    thread_syscall_t *syscall_thread = (thread_syscall_t *)malloc(sizeof(thread_syscall_t));<br>    syscall_thread-&gt;<span class="hljs-built_in">type</span> = 0;<br>    syscall_thread-&gt;isTask = 0;<br>    syscall_thread-&gt;args = NULL;<br>    syscall_thread-&gt;ret = NULL;<br>    syscall_thread-&gt;isReturn = 0;<br>    pthread_mutex_init(&amp;syscall_thread-&gt;mutex, NULL);<br>    pthread_t threadId;<br>    pthread_create(&amp;threadId, NULL, &amp;pthread_syscall, (void *)syscall_thread);<br>    syscall_thread-&gt;thread = threadId;<br>    <span class="hljs-built_in">return</span> syscall_thread;<br>&#125;<br><br>struct seccomp_data &#123;<br>    int nr;<br>    __u32 <span class="hljs-built_in">arch</span>;<br>    __u64 instruction_pointer;<br>    __u64 args[6];<br>&#125;;<br><br>struct sock_filter &#123;<br>    __u16 code;<br>    __u8 jt;<br>    __u8 jf;<br>    __u32 k;<br>&#125;;<br><br>struct sock_fprog &#123;<br>    unsigned short len;<br>    struct sock_filter * filter;<br>&#125;;<br><br>int install_filter(__u32 nr) &#123;<br>    <span class="hljs-built_in">log</span>(<span class="hljs-string">&quot;install_filter(%lu)&quot;</span>,nr);<br>    struct sock_filter filter[] = &#123;<br>            BPF_STMT(BPF_LD + BPF_W + BPF_ABS, 0),<br>            BPF_JUMP(BPF_JMP + BPF_JEQ + BPF_K, nr, 0, 1),<br>            BPF_STMT(BPF_RET + BPF_K, SECCOMP_RET_TRAP),<br>            BPF_STMT(BPF_RET + BPF_K, SECCOMP_RET_ALLOW),<br>    &#125;;<br>    struct sock_fprog prog = &#123;<br>            .len = (unsigned short) (sizeof(filter) / sizeof(filter[0])),<br>            .filter = filter,<br>    &#125;;<br>    <span class="hljs-keyword">if</span> (prctl(PR_SET_NO_NEW_PRIVS, 1, 0, 0, 0)) &#123;<br>        on_message(<span class="hljs-string">&quot;prctl(NO_NEW_PRIVS)&quot;</span>);<br>        <span class="hljs-built_in">return</span> 1;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (prctl(PR_SET_SECCOMP, SECCOMP_MODE_FILTER, &amp;prog)) &#123;<br>        on_message(<span class="hljs-string">&quot;prctl(PR_SET_SECCOMP)&quot;</span>);<br>        <span class="hljs-built_in">return</span> 1;<br>    &#125;<br>    <span class="hljs-built_in">return</span> 0;<br>&#125;<br>`, &#123;<br>    malloc: malloc_ptr,<br>    prctl: prctl_ptr,<br>    fopen: fopen_ptr,<br>    fclose: fclose_ptr,<br>    fgets: fgets_ptr,<br>    strtok: strtok_ptr,<br>    strcpy: strcpy_ptr,<br>    strtoul: strtoul_ptr,<br>    __android_log_print: __android_log_print_ptr,<br>    pthread_create: pthread_create_ptr,<br>    pthread_join: pthread_join_ptr,<br>    pthread_mutex_init: pthread_mutex_init_ptr,<br>    pthread_mutex_lock: pthread_mutex_lock_ptr,<br>    pthread_mutex_unlock: pthread_mutex_unlock_ptr,<br>    syscall: syscall_ptr,<br>    solist_get_head: solist_get_head_ptr,<br>    on_message: new NativeCallback(messagePtr =&gt; &#123;<br>        const message = messagePtr.readUtf8String();<br>        console.log(message)<br>    &#125;, <span class="hljs-string">&#x27;void&#x27;</span>, [<span class="hljs-string">&#x27;pointer&#x27;</span>])<br>&#125;);<br><br>Interceptor.attach(Module.findExportByName(null, <span class="hljs-string">&quot;android_dlopen_ext&quot;</span>), &#123;<br>    onEnter(args) &#123;<br>        <span class="hljs-keyword">if</span> (install_filter == null) &#123;<br>            init()<br>        &#125;<br>    &#125;<br>&#125;)<br><br><br>const byteToHex = [];<br><br><span class="hljs-keyword">for</span> (<span class="hljs-built_in">let</span> n = 0; n &lt;= 0xff; ++n) &#123;<br>    const hexOctet = n.toString(16).padStart(2, <span class="hljs-string">&quot;0&quot;</span>);<br>    byteToHex.push(hexOctet);<br>&#125;<br><br><span class="hljs-keyword">function</span> hex(arrayBuffer) &#123;<br>    const buff = new Uint8Array(arrayBuffer);<br>    const hexOctets = [];<br>    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">let</span> i = 0; i &lt; buff.length; ++i)<br>        hexOctets.push(byteToHex[buff[i]]);<br>    <span class="hljs-built_in">return</span> hexOctets.<span class="hljs-built_in">join</span>(<span class="hljs-string">&quot;&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">function</span> call_thread_log(str) &#123;<br>    call_task(syscall_thread_ptr, Memory.allocUtf8String(str), 1)<br>&#125;<br><br><span class="hljs-keyword">function</span> call_thread_read_maps(addr) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">let</span> index = 0; index &lt; maps.length; index++) &#123;<br>        const element = maps[index];<br>        <span class="hljs-keyword">if</span> (parseInt(addr.toString()) &gt;= element[0] &amp;&amp; parseInt(addr.toString()) &lt; element[1]) &#123;<br>            <span class="hljs-built_in">return</span> &#123; start: element[0], end: element[1], name: element[2] &#125;<br>        &#125;<br>    &#125;<br>    const map_info = call_task(syscall_thread_ptr, ptr(addr), 2).readUtf8String()<br>    const start = parseInt(<span class="hljs-string">&quot;0x&quot;</span> + map_info.split(<span class="hljs-string">&quot;-&quot;</span>)[0])<br>    const end = parseInt(<span class="hljs-string">&quot;0x&quot;</span> + map_info.split(<span class="hljs-string">&quot;-&quot;</span>)[1].<span class="hljs-built_in">split</span>(<span class="hljs-string">&quot; &quot;</span>)[0])<br>    const name_arr = map_info.split(<span class="hljs-string">&quot;                              &quot;</span>)<br>    const name = name_arr.length == 2 ? name_arr[2] : <span class="hljs-string">&quot;&quot;</span><br>    maps.push([start, end, name])<br>    <span class="hljs-built_in">return</span> &#123; start, end, name &#125;<br>&#125;<br><br><span class="hljs-keyword">function</span> addrToString(addr) &#123;<br>    const add_s = parseInt(addr.toString(10))<br>    const addr_soinfo = findSoinfoByAddr(ptr(add_s));<br>    <span class="hljs-keyword">if</span> (addr_soinfo != 0) &#123;<br>        <span class="hljs-built_in">return</span> `0x<span class="hljs-variable">$&#123;addr.toString(16)&#125;</span>[<span class="hljs-variable">$&#123;get_soname(addr_soinfo).readUtf8String()&#125;</span>:0x<span class="hljs-variable">$&#123;(addr - get_base(addr_soinfo)).toString(16)&#125;</span>]`<br>    &#125;<br>    <span class="hljs-keyword">if</span> (add_s &gt;= linker.base &amp;&amp; add_s &lt; linker.base + linker.size) &#123;<br>        <span class="hljs-built_in">return</span> `0x<span class="hljs-variable">$&#123;add_s.toString(16)&#125;</span>[<span class="hljs-variable">$&#123;linker.name&#125;</span>:0x<span class="hljs-variable">$&#123;(add_s - linker.base).toString(16)&#125;</span>]`<br>    &#125;<br>    const mem_region = call_thread_read_maps(add_s);<br>    <span class="hljs-keyword">if</span> (mem_region.name != <span class="hljs-string">&quot;&quot;</span>) &#123;<br>        <span class="hljs-built_in">return</span> `0x<span class="hljs-variable">$&#123;add_s.toString(16)&#125;</span>[<span class="hljs-variable">$&#123;mem_region.name&#125;</span>:0x<span class="hljs-variable">$&#123;(add_s - mem_region.start).toString(16)&#125;</span>]`<br>    &#125;<br>    <span class="hljs-built_in">return</span> `0x<span class="hljs-variable">$&#123;addr.toString(16)&#125;</span>[unkownmem:]`<br>&#125;<br><br><span class="hljs-keyword">function</span> stacktrace(pc, fp, sp) &#123;<br>    <span class="hljs-built_in">let</span> n = 0, stack_arr = [], fp_c = fp;<br>    stack_arr[n++] = pc;<br>    const mem_region = call_thread_read_maps(sp);<br>    <span class="hljs-keyword">while</span> (n &lt; MAX_STACK_TRACE_DEPTH) &#123;<br>        <span class="hljs-keyword">if</span> (parseInt(fp_c.toString()) &lt; parseInt(sp.toString()) || fp_c &lt; mem_region.start || fp_c &gt; mem_region.end) &#123;<br>            <span class="hljs-built_in">break</span><br>        &#125;<br>        <span class="hljs-built_in">let</span> next_fp = fp_c.readPointer()<br>        <span class="hljs-built_in">let</span> lr = fp_c.add(8).readPointer()<br>        fp_c = next_fp<br>        stack_arr[n++] = lr<br>    &#125;<br>    <span class="hljs-built_in">return</span> stack_arr;<br>&#125;<br><br>const syscalls = [<br>    [0, <span class="hljs-string">&quot;io_setup&quot;</span>, 0x00, <span class="hljs-string">&quot;unsigned nr_reqs&quot;</span>, <span class="hljs-string">&quot;aio_context_t *ctx&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [1, <span class="hljs-string">&quot;io_destroy&quot;</span>, 0x01, <span class="hljs-string">&quot;aio_context_t ctx&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [2, <span class="hljs-string">&quot;io_submit&quot;</span>, 0x02, <span class="hljs-string">&quot;aio_context_t&quot;</span>, <span class="hljs-string">&quot;long&quot;</span>, <span class="hljs-string">&quot;struct iocb * *&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [3, <span class="hljs-string">&quot;io_cancel&quot;</span>, 0x03, <span class="hljs-string">&quot;aio_context_t ctx_id&quot;</span>, <span class="hljs-string">&quot;struct iocb *iocb&quot;</span>, <span class="hljs-string">&quot;struct io_event *result&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [4, <span class="hljs-string">&quot;io_getevents&quot;</span>, 0x04, <span class="hljs-string">&quot;aio_context_t ctx_id&quot;</span>, <span class="hljs-string">&quot;long min_nr&quot;</span>, <span class="hljs-string">&quot;long nr&quot;</span>, <span class="hljs-string">&quot;struct io_event *events&quot;</span>, <span class="hljs-string">&quot;struct __kernel_timespec *timeout&quot;</span>],<br>    [5, <span class="hljs-string">&quot;setxattr&quot;</span>, 0x05, <span class="hljs-string">&quot;const char *path&quot;</span>, <span class="hljs-string">&quot;const char *name&quot;</span>, <span class="hljs-string">&quot;const void *value&quot;</span>, <span class="hljs-string">&quot;size_t size&quot;</span>, <span class="hljs-string">&quot;int flags&quot;</span>],<br>    [6, <span class="hljs-string">&quot;lsetxattr&quot;</span>, 0x06, <span class="hljs-string">&quot;const char *path&quot;</span>, <span class="hljs-string">&quot;const char *name&quot;</span>, <span class="hljs-string">&quot;const void *value&quot;</span>, <span class="hljs-string">&quot;size_t size&quot;</span>, <span class="hljs-string">&quot;int flags&quot;</span>],<br>    [7, <span class="hljs-string">&quot;fsetxattr&quot;</span>, 0x07, <span class="hljs-string">&quot;int fd&quot;</span>, <span class="hljs-string">&quot;const char *name&quot;</span>, <span class="hljs-string">&quot;const void *value&quot;</span>, <span class="hljs-string">&quot;size_t size&quot;</span>, <span class="hljs-string">&quot;int flags&quot;</span>],<br>    [8, <span class="hljs-string">&quot;getxattr&quot;</span>, 0x08, <span class="hljs-string">&quot;const char *path&quot;</span>, <span class="hljs-string">&quot;const char *name&quot;</span>, <span class="hljs-string">&quot;void *value&quot;</span>, <span class="hljs-string">&quot;size_t size&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [9, <span class="hljs-string">&quot;lgetxattr&quot;</span>, 0x09, <span class="hljs-string">&quot;const char *path&quot;</span>, <span class="hljs-string">&quot;const char *name&quot;</span>, <span class="hljs-string">&quot;void *value&quot;</span>, <span class="hljs-string">&quot;size_t size&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [10, <span class="hljs-string">&quot;fgetxattr&quot;</span>, 0x0a, <span class="hljs-string">&quot;int fd&quot;</span>, <span class="hljs-string">&quot;const char *name&quot;</span>, <span class="hljs-string">&quot;void *value&quot;</span>, <span class="hljs-string">&quot;size_t size&quot;</span>],<br>    [11, <span class="hljs-string">&quot;listxattr&quot;</span>, 0x0b, <span class="hljs-string">&quot;const char *path&quot;</span>, <span class="hljs-string">&quot;char *list&quot;</span>, <span class="hljs-string">&quot;size_t size&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [12, <span class="hljs-string">&quot;llistxattr&quot;</span>, 0x0c, <span class="hljs-string">&quot;const char *path&quot;</span>, <span class="hljs-string">&quot;char *list&quot;</span>, <span class="hljs-string">&quot;size_t size&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [13, <span class="hljs-string">&quot;flistxattr&quot;</span>, 0x0d, <span class="hljs-string">&quot;int fd&quot;</span>, <span class="hljs-string">&quot;char *list&quot;</span>, <span class="hljs-string">&quot;size_t size&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [14, <span class="hljs-string">&quot;removexattr&quot;</span>, 0x0e, <span class="hljs-string">&quot;const char *path&quot;</span>, <span class="hljs-string">&quot;const char *name&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [15, <span class="hljs-string">&quot;lremovexattr&quot;</span>, 0x0f, <span class="hljs-string">&quot;const char *path&quot;</span>, <span class="hljs-string">&quot;const char *name&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [16, <span class="hljs-string">&quot;fremovexattr&quot;</span>, 0x10, <span class="hljs-string">&quot;int fd&quot;</span>, <span class="hljs-string">&quot;const char *name&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [17, <span class="hljs-string">&quot;getcwd&quot;</span>, 0x11, <span class="hljs-string">&quot;char *buf&quot;</span>, <span class="hljs-string">&quot;unsigned long size&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [18, <span class="hljs-string">&quot;lookup_dcookie&quot;</span>, 0x12, <span class="hljs-string">&quot;u64 cookie64&quot;</span>, <span class="hljs-string">&quot;char *buf&quot;</span>, <span class="hljs-string">&quot;size_t len&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [19, <span class="hljs-string">&quot;eventfd2&quot;</span>, 0x13, <span class="hljs-string">&quot;unsigned int count&quot;</span>, <span class="hljs-string">&quot;int flags&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [20, <span class="hljs-string">&quot;epoll_create1&quot;</span>, 0x14, <span class="hljs-string">&quot;int flags&quot;</span>],<br>    [21, <span class="hljs-string">&quot;epoll_ctl&quot;</span>, 0x15, <span class="hljs-string">&quot;int epfd&quot;</span>, <span class="hljs-string">&quot;int op&quot;</span>, <span class="hljs-string">&quot;int fd&quot;</span>, <span class="hljs-string">&quot;struct epoll_event *event&quot;</span>],<br>    [22, <span class="hljs-string">&quot;epoll_pwait&quot;</span>, 0x16, <span class="hljs-string">&quot;int epfd&quot;</span>, <span class="hljs-string">&quot;struct epoll_event *events&quot;</span>, <span class="hljs-string">&quot;int maxevents&quot;</span>, <span class="hljs-string">&quot;int timeout&quot;</span>, <span class="hljs-string">&quot;const sigset_t *sigmask&quot;</span>, <span class="hljs-string">&quot;size_t sigsetsize&quot;</span>],<br>    [23, <span class="hljs-string">&quot;dup&quot;</span>, 0x17, <span class="hljs-string">&quot;unsigned int fildes&quot;</span>],<br>    [24, <span class="hljs-string">&quot;dup3&quot;</span>, 0x18, <span class="hljs-string">&quot;unsigned int oldfd&quot;</span>, <span class="hljs-string">&quot;unsigned int newfd&quot;</span>, <span class="hljs-string">&quot;int flags&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [25, <span class="hljs-string">&quot;fcntl&quot;</span>, 0x19, <span class="hljs-string">&quot;unsigned int fd&quot;</span>, <span class="hljs-string">&quot;unsigned int cmd&quot;</span>, <span class="hljs-string">&quot;unsigned long arg&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [26, <span class="hljs-string">&quot;inotify_init1&quot;</span>, 0x1a, <span class="hljs-string">&quot;int flags&quot;</span>],<br>    [27, <span class="hljs-string">&quot;inotify_add_watch&quot;</span>, 0x1b, <span class="hljs-string">&quot;int fd&quot;</span>, <span class="hljs-string">&quot;const char *path&quot;</span>, <span class="hljs-string">&quot;u32 mask&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [28, <span class="hljs-string">&quot;inotify_rm_watch&quot;</span>, 0x1c, <span class="hljs-string">&quot;int fd&quot;</span>, <span class="hljs-string">&quot;__s32 wd&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [29, <span class="hljs-string">&quot;ioctl&quot;</span>, 0x1d, <span class="hljs-string">&quot;unsigned int fd&quot;</span>, <span class="hljs-string">&quot;unsigned int cmd&quot;</span>, <span class="hljs-string">&quot;unsigned long arg&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [30, <span class="hljs-string">&quot;ioprio_set&quot;</span>, 0x1e, <span class="hljs-string">&quot;int which&quot;</span>, <span class="hljs-string">&quot;int who&quot;</span>, <span class="hljs-string">&quot;int ioprio&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [31, <span class="hljs-string">&quot;ioprio_get&quot;</span>, 0x1f, <span class="hljs-string">&quot;int which&quot;</span>, <span class="hljs-string">&quot;int who&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [32, <span class="hljs-string">&quot;flock&quot;</span>, 0x20, <span class="hljs-string">&quot;unsigned int fd&quot;</span>, <span class="hljs-string">&quot;unsigned int cmd&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [33, <span class="hljs-string">&quot;mknodat&quot;</span>, 0x21, <span class="hljs-string">&quot;int dfd&quot;</span>, <span class="hljs-string">&quot;const char * filename&quot;</span>, <span class="hljs-string">&quot;umode_t mode&quot;</span>, <span class="hljs-string">&quot;unsigned dev&quot;</span>],<br>    [34, <span class="hljs-string">&quot;mkdirat&quot;</span>, 0x22, <span class="hljs-string">&quot;int dfd&quot;</span>, <span class="hljs-string">&quot;const char * pathname&quot;</span>, <span class="hljs-string">&quot;umode_t mode&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [35, <span class="hljs-string">&quot;unlinkat&quot;</span>, 0x23, <span class="hljs-string">&quot;int dfd&quot;</span>, <span class="hljs-string">&quot;const char * pathname&quot;</span>, <span class="hljs-string">&quot;int flag&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [36, <span class="hljs-string">&quot;symlinkat&quot;</span>, 0x24, <span class="hljs-string">&quot;const char * oldname&quot;</span>, <span class="hljs-string">&quot;int newdfd&quot;</span>, <span class="hljs-string">&quot;const char * newname&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [37, <span class="hljs-string">&quot;linkat&quot;</span>, 0x25, <span class="hljs-string">&quot;int olddfd&quot;</span>, <span class="hljs-string">&quot;const char *oldname&quot;</span>, <span class="hljs-string">&quot;int newdfd&quot;</span>, <span class="hljs-string">&quot;const char *newname&quot;</span>, <span class="hljs-string">&quot;int flag&quot;</span>],<br>    [38, <span class="hljs-string">&quot;renameat&quot;</span>, 0x26, <span class="hljs-string">&quot;int olddfd&quot;</span>, <span class="hljs-string">&quot;const char * oldname&quot;</span>, <span class="hljs-string">&quot;int newdfd&quot;</span>, <span class="hljs-string">&quot;const char * newname&quot;</span>],<br>    [39, <span class="hljs-string">&quot;umount2&quot;</span>, 0x27, <span class="hljs-string">&quot;?&quot;</span>, <span class="hljs-string">&quot;?&quot;</span>, <span class="hljs-string">&quot;?&quot;</span>, <span class="hljs-string">&quot;?&quot;</span>, <span class="hljs-string">&quot;?&quot;</span>, <span class="hljs-string">&quot;?[&quot;</span>],<br>    [40, <span class="hljs-string">&quot;mount&quot;</span>, 0x28, <span class="hljs-string">&quot;char *dev_name&quot;</span>, <span class="hljs-string">&quot;char *dir_name&quot;</span>, <span class="hljs-string">&quot;char *type&quot;</span>, <span class="hljs-string">&quot;unsigned long flags&quot;</span>, <span class="hljs-string">&quot;void *dat&quot;</span>],<br>    [41, <span class="hljs-string">&quot;pivot_root&quot;</span>, 0x29, <span class="hljs-string">&quot;const char *new_root&quot;</span>, <span class="hljs-string">&quot;const char *put_old&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [42, <span class="hljs-string">&quot;nfsservctl&quot;</span>, 0x2a, <span class="hljs-string">&quot;?&quot;</span>, <span class="hljs-string">&quot;?&quot;</span>, <span class="hljs-string">&quot;?&quot;</span>, <span class="hljs-string">&quot;?&quot;</span>, <span class="hljs-string">&quot;?&quot;</span>, <span class="hljs-string">&quot;?[&quot;</span>],<br>    [43, <span class="hljs-string">&quot;statfs&quot;</span>, 0x2b, <span class="hljs-string">&quot;const char * path&quot;</span>, <span class="hljs-string">&quot;struct statfs *buf&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [44, <span class="hljs-string">&quot;fstatfs&quot;</span>, 0x2c, <span class="hljs-string">&quot;unsigned int fd&quot;</span>, <span class="hljs-string">&quot;struct statfs *buf&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [45, <span class="hljs-string">&quot;truncate&quot;</span>, 0x2d, <span class="hljs-string">&quot;const char *path&quot;</span>, <span class="hljs-string">&quot;long length&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [46, <span class="hljs-string">&quot;ftruncate&quot;</span>, 0x2e, <span class="hljs-string">&quot;unsigned int fd&quot;</span>, <span class="hljs-string">&quot;unsigned long length&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [47, <span class="hljs-string">&quot;fallocate&quot;</span>, 0x2f, <span class="hljs-string">&quot;int fd&quot;</span>, <span class="hljs-string">&quot;int mode&quot;</span>, <span class="hljs-string">&quot;loff_t offset&quot;</span>, <span class="hljs-string">&quot;loff_t len&quot;</span>],<br>    [48, <span class="hljs-string">&quot;faccessat&quot;</span>, 0x30, <span class="hljs-string">&quot;int dfd&quot;</span>, <span class="hljs-string">&quot;const char *filename&quot;</span>, <span class="hljs-string">&quot;int mode&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [49, <span class="hljs-string">&quot;chdir&quot;</span>, 0x31, <span class="hljs-string">&quot;const char *filename&quot;</span>],<br>    [50, <span class="hljs-string">&quot;fchdir&quot;</span>, 0x32, <span class="hljs-string">&quot;unsigned int fd&quot;</span>],<br>    [51, <span class="hljs-string">&quot;chroot&quot;</span>, 0x33, <span class="hljs-string">&quot;const char *filename&quot;</span>],<br>    [52, <span class="hljs-string">&quot;fchmod&quot;</span>, 0x34, <span class="hljs-string">&quot;unsigned int fd&quot;</span>, <span class="hljs-string">&quot;umode_t mode&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [53, <span class="hljs-string">&quot;fchmodat&quot;</span>, 0x35, <span class="hljs-string">&quot;int dfd&quot;</span>, <span class="hljs-string">&quot;const char * filename&quot;</span>, <span class="hljs-string">&quot;umode_t mode&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [54, <span class="hljs-string">&quot;fchownat&quot;</span>, 0x36, <span class="hljs-string">&quot;int dfd&quot;</span>, <span class="hljs-string">&quot;const char *filename&quot;</span>, <span class="hljs-string">&quot;uid_t user&quot;</span>, <span class="hljs-string">&quot;gid_t group&quot;</span>, <span class="hljs-string">&quot;int fla&quot;</span>],<br>    [55, <span class="hljs-string">&quot;fchown&quot;</span>, 0x37, <span class="hljs-string">&quot;unsigned int fd&quot;</span>, <span class="hljs-string">&quot;uid_t user&quot;</span>, <span class="hljs-string">&quot;gid_t group&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [56, <span class="hljs-string">&quot;openat&quot;</span>, 0x38, <span class="hljs-string">&quot;int dfd&quot;</span>, <span class="hljs-string">&quot;const char *filename&quot;</span>, <span class="hljs-string">&quot;int flags&quot;</span>, <span class="hljs-string">&quot;umode_t mode&quot;</span>],<br>    [57, <span class="hljs-string">&quot;close&quot;</span>, 0x39, <span class="hljs-string">&quot;unsigned int fd&quot;</span>],<br>    [58, <span class="hljs-string">&quot;vhangup&quot;</span>, 0x3a, <span class="hljs-string">&quot;-&quot;</span>],<br>    [59, <span class="hljs-string">&quot;pipe2&quot;</span>, 0x3b, <span class="hljs-string">&quot;int *fildes&quot;</span>, <span class="hljs-string">&quot;int flags&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [60, <span class="hljs-string">&quot;quotactl&quot;</span>, 0x3c, <span class="hljs-string">&quot;unsigned int cmd&quot;</span>, <span class="hljs-string">&quot;const char *special&quot;</span>, <span class="hljs-string">&quot;qid_t id&quot;</span>, <span class="hljs-string">&quot;void *addr&quot;</span>],<br>    [61, <span class="hljs-string">&quot;getdents64&quot;</span>, 0x3d, <span class="hljs-string">&quot;unsigned int fd&quot;</span>, <span class="hljs-string">&quot;struct linux_dirent64 *dirent&quot;</span>, <span class="hljs-string">&quot;unsigned int count&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [62, <span class="hljs-string">&quot;lseek&quot;</span>, 0x3e, <span class="hljs-string">&quot;unsigned int fd&quot;</span>, <span class="hljs-string">&quot;off_t offset&quot;</span>, <span class="hljs-string">&quot;unsigned int whence&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [63, <span class="hljs-string">&quot;read&quot;</span>, 0x3f, <span class="hljs-string">&quot;unsigned int fd&quot;</span>, <span class="hljs-string">&quot;char *buf&quot;</span>, <span class="hljs-string">&quot;size_t count&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [64, <span class="hljs-string">&quot;write&quot;</span>, 0x40, <span class="hljs-string">&quot;unsigned int fd&quot;</span>, <span class="hljs-string">&quot;const char *buf&quot;</span>, <span class="hljs-string">&quot;size_t count&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [65, <span class="hljs-string">&quot;readv&quot;</span>, 0x41, <span class="hljs-string">&quot;unsigned long fd&quot;</span>, <span class="hljs-string">&quot;const struct iovec *vec&quot;</span>, <span class="hljs-string">&quot;unsigned long vlen&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [66, <span class="hljs-string">&quot;writev&quot;</span>, 0x42, <span class="hljs-string">&quot;unsigned long fd&quot;</span>, <span class="hljs-string">&quot;const struct iovec *vec&quot;</span>, <span class="hljs-string">&quot;unsigned long vlen&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [67, <span class="hljs-string">&quot;pread64&quot;</span>, 0x43, <span class="hljs-string">&quot;unsigned int fd&quot;</span>, <span class="hljs-string">&quot;char *buf&quot;</span>, <span class="hljs-string">&quot;size_t count&quot;</span>, <span class="hljs-string">&quot;loff_t pos&quot;</span>],<br>    [68, <span class="hljs-string">&quot;pwrite64&quot;</span>, 0x44, <span class="hljs-string">&quot;unsigned int fd&quot;</span>, <span class="hljs-string">&quot;const char *buf&quot;</span>, <span class="hljs-string">&quot;size_t count&quot;</span>, <span class="hljs-string">&quot;loff_t pos&quot;</span>],<br>    [69, <span class="hljs-string">&quot;preadv&quot;</span>, 0x45, <span class="hljs-string">&quot;unsigned long fd&quot;</span>, <span class="hljs-string">&quot;const struct iovec *vec&quot;</span>, <span class="hljs-string">&quot;unsigned long vlen&quot;</span>, <span class="hljs-string">&quot;unsigned long pos_l&quot;</span>, <span class="hljs-string">&quot;unsigned long pos_&quot;</span>],<br>    [70, <span class="hljs-string">&quot;pwritev&quot;</span>, 0x46, <span class="hljs-string">&quot;unsigned long fd&quot;</span>, <span class="hljs-string">&quot;const struct iovec *vec&quot;</span>, <span class="hljs-string">&quot;unsigned long vlen&quot;</span>, <span class="hljs-string">&quot;unsigned long pos_l&quot;</span>, <span class="hljs-string">&quot;unsigned long pos_&quot;</span>],<br>    [71, <span class="hljs-string">&quot;sendfile&quot;</span>, 0x47, <span class="hljs-string">&quot;int out_fd&quot;</span>, <span class="hljs-string">&quot;int in_fd&quot;</span>, <span class="hljs-string">&quot;off_t *offset&quot;</span>, <span class="hljs-string">&quot;size_t count&quot;</span>],<br>    [72, <span class="hljs-string">&quot;pselect6&quot;</span>, 0x48, <span class="hljs-string">&quot;int&quot;</span>, <span class="hljs-string">&quot;fd_set *&quot;</span>, <span class="hljs-string">&quot;fd_set *&quot;</span>, <span class="hljs-string">&quot;fd_set *&quot;</span>, <span class="hljs-string">&quot;struct __kernel_timespec *&quot;</span>, <span class="hljs-string">&quot;void *[&quot;</span>],<br>    [73, <span class="hljs-string">&quot;ppoll&quot;</span>, 0x49, <span class="hljs-string">&quot;struct pollfd *&quot;</span>, <span class="hljs-string">&quot;unsigned int&quot;</span>, <span class="hljs-string">&quot;struct __kernel_timespec *&quot;</span>, <span class="hljs-string">&quot;const sigset_t *&quot;</span>, <span class="hljs-string">&quot;size_&quot;</span>],<br>    [74, <span class="hljs-string">&quot;signalfd4&quot;</span>, 0x4a, <span class="hljs-string">&quot;int ufd&quot;</span>, <span class="hljs-string">&quot;sigset_t *user_mask&quot;</span>, <span class="hljs-string">&quot;size_t sizemask&quot;</span>, <span class="hljs-string">&quot;int flags&quot;</span>],<br>    [75, <span class="hljs-string">&quot;vmsplice&quot;</span>, 0x4b, <span class="hljs-string">&quot;int fd&quot;</span>, <span class="hljs-string">&quot;const struct iovec *iov&quot;</span>, <span class="hljs-string">&quot;unsigned long nr_segs&quot;</span>, <span class="hljs-string">&quot;unsigned int flags&quot;</span>],<br>    [76, <span class="hljs-string">&quot;splice&quot;</span>, 0x4c, <span class="hljs-string">&quot;int fd_in&quot;</span>, <span class="hljs-string">&quot;loff_t *off_in&quot;</span>, <span class="hljs-string">&quot;int fd_out&quot;</span>, <span class="hljs-string">&quot;loff_t *off_out&quot;</span>, <span class="hljs-string">&quot;size_t len&quot;</span>, <span class="hljs-string">&quot;unsigned int flags[&quot;</span>],<br>    [77, <span class="hljs-string">&quot;tee&quot;</span>, 0x4d, <span class="hljs-string">&quot;int fdin&quot;</span>, <span class="hljs-string">&quot;int fdout&quot;</span>, <span class="hljs-string">&quot;size_t len&quot;</span>, <span class="hljs-string">&quot;unsigned int flags&quot;</span>],<br>    [78, <span class="hljs-string">&quot;readlinkat&quot;</span>, 0x4e, <span class="hljs-string">&quot;int dfd&quot;</span>, <span class="hljs-string">&quot;const char *path&quot;</span>, <span class="hljs-string">&quot;char *buf&quot;</span>, <span class="hljs-string">&quot;int bufsiz&quot;</span>],<br>    [79, <span class="hljs-string">&quot;newfstatat&quot;</span>, 0x4f, <span class="hljs-string">&quot;int dfd&quot;</span>, <span class="hljs-string">&quot;const char *filename&quot;</span>, <span class="hljs-string">&quot;struct stat *statbuf&quot;</span>, <span class="hljs-string">&quot;int flag&quot;</span>],<br>    [80, <span class="hljs-string">&quot;fstat&quot;</span>, 0x50, <span class="hljs-string">&quot;unsigned int fd&quot;</span>, <span class="hljs-string">&quot;struct __old_kernel_stat *statbuf&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [81, <span class="hljs-string">&quot;sync&quot;</span>, 0x51, <span class="hljs-string">&quot;-&quot;</span>],<br>    [82, <span class="hljs-string">&quot;fsync&quot;</span>, 0x52, <span class="hljs-string">&quot;unsigned int fd&quot;</span>],<br>    [83, <span class="hljs-string">&quot;fdatasync&quot;</span>, 0x53, <span class="hljs-string">&quot;unsigned int fd&quot;</span>],<br>    [84, <span class="hljs-string">&quot;sync_file_range&quot;</span>, 0x54, <span class="hljs-string">&quot;int fd&quot;</span>, <span class="hljs-string">&quot;loff_t offset&quot;</span>, <span class="hljs-string">&quot;loff_t nbytes&quot;</span>, <span class="hljs-string">&quot;unsigned int flags&quot;</span>],<br>    [85, <span class="hljs-string">&quot;timerfd_create&quot;</span>, 0x55, <span class="hljs-string">&quot;int clockid&quot;</span>, <span class="hljs-string">&quot;int flags&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [86, <span class="hljs-string">&quot;timerfd_settime&quot;</span>, 0x56, <span class="hljs-string">&quot;int ufd&quot;</span>, <span class="hljs-string">&quot;int flags&quot;</span>, <span class="hljs-string">&quot;const struct __kernel_itimerspec *utmr&quot;</span>, <span class="hljs-string">&quot;struct __kernel_itimerspec *otmr&quot;</span>],<br>    [87, <span class="hljs-string">&quot;timerfd_gettime&quot;</span>, 0x57, <span class="hljs-string">&quot;int ufd&quot;</span>, <span class="hljs-string">&quot;struct __kernel_itimerspec *otmr&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [88, <span class="hljs-string">&quot;utimensat&quot;</span>, 0x58, <span class="hljs-string">&quot;int dfd&quot;</span>, <span class="hljs-string">&quot;const char *filename&quot;</span>, <span class="hljs-string">&quot;struct __kernel_timespec *utimes&quot;</span>, <span class="hljs-string">&quot;int flags&quot;</span>],<br>    [89, <span class="hljs-string">&quot;acct&quot;</span>, 0x59, <span class="hljs-string">&quot;const char *name&quot;</span>],<br>    [90, <span class="hljs-string">&quot;capget&quot;</span>, 0x5a, <span class="hljs-string">&quot;cap_user_header_t header&quot;</span>, <span class="hljs-string">&quot;cap_user_data_t dataptr&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [91, <span class="hljs-string">&quot;capset&quot;</span>, 0x5b, <span class="hljs-string">&quot;cap_user_header_t header&quot;</span>, <span class="hljs-string">&quot;const cap_user_data_t data&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [92, <span class="hljs-string">&quot;personality&quot;</span>, 0x5c, <span class="hljs-string">&quot;unsigned int personality&quot;</span>],<br>    [93, <span class="hljs-string">&quot;exit&quot;</span>, 0x5d, <span class="hljs-string">&quot;int error_code&quot;</span>],<br>    [94, <span class="hljs-string">&quot;exit_group&quot;</span>, 0x5e, <span class="hljs-string">&quot;int error_code&quot;</span>],<br>    [95, <span class="hljs-string">&quot;waitid&quot;</span>, 0x5f, <span class="hljs-string">&quot;int which&quot;</span>, <span class="hljs-string">&quot;pid_t pid&quot;</span>, <span class="hljs-string">&quot;struct siginfo *infop&quot;</span>, <span class="hljs-string">&quot;int options&quot;</span>, <span class="hljs-string">&quot;struct rusage *r&quot;</span>],<br>    [96, <span class="hljs-string">&quot;set_tid_address&quot;</span>, 0x60, <span class="hljs-string">&quot;int *tidptr&quot;</span>],<br>    [97, <span class="hljs-string">&quot;unshare&quot;</span>, 0x61, <span class="hljs-string">&quot;unsigned long unshare_flags&quot;</span>],<br>    [98, <span class="hljs-string">&quot;futex&quot;</span>, 0x62, <span class="hljs-string">&quot;u32 *uaddr&quot;</span>, <span class="hljs-string">&quot;int op&quot;</span>, <span class="hljs-string">&quot;u32 val&quot;</span>, <span class="hljs-string">&quot;struct __kernel_timespec *utime&quot;</span>, <span class="hljs-string">&quot;u32 *uaddr2&quot;</span>, <span class="hljs-string">&quot;u32 val3[&quot;</span>],<br>    [99, <span class="hljs-string">&quot;set_robust_list&quot;</span>, 0x63, <span class="hljs-string">&quot;struct robust_list_head *head&quot;</span>, <span class="hljs-string">&quot;size_t len&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [100, <span class="hljs-string">&quot;get_robust_list&quot;</span>, 0x64, <span class="hljs-string">&quot;int pid&quot;</span>, <span class="hljs-string">&quot;struct robust_list_head * *head_ptr&quot;</span>, <span class="hljs-string">&quot;size_t *len_ptr&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [101, <span class="hljs-string">&quot;nanosleep&quot;</span>, 0x65, <span class="hljs-string">&quot;struct __kernel_timespec *rqtp&quot;</span>, <span class="hljs-string">&quot;struct __kernel_timespec *rmtp&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [102, <span class="hljs-string">&quot;getitimer&quot;</span>, 0x66, <span class="hljs-string">&quot;int which&quot;</span>, <span class="hljs-string">&quot;struct itimerval *value&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [103, <span class="hljs-string">&quot;setitimer&quot;</span>, 0x67, <span class="hljs-string">&quot;int which&quot;</span>, <span class="hljs-string">&quot;struct itimerval *value&quot;</span>, <span class="hljs-string">&quot;struct itimerval *ovalue&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [104, <span class="hljs-string">&quot;kexec_load&quot;</span>, 0x68, <span class="hljs-string">&quot;unsigned long entry&quot;</span>, <span class="hljs-string">&quot;unsigned long nr_segments&quot;</span>, <span class="hljs-string">&quot;struct kexec_segment *segments&quot;</span>, <span class="hljs-string">&quot;unsigned long flags&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [105, <span class="hljs-string">&quot;init_module&quot;</span>, 0x69, <span class="hljs-string">&quot;void *umod&quot;</span>, <span class="hljs-string">&quot;unsigned long len&quot;</span>, <span class="hljs-string">&quot;const char *uargs&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [106, <span class="hljs-string">&quot;delete_module&quot;</span>, 0x6a, <span class="hljs-string">&quot;const char *name_user&quot;</span>, <span class="hljs-string">&quot;unsigned int flags&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [107, <span class="hljs-string">&quot;timer_create&quot;</span>, 0x6b, <span class="hljs-string">&quot;clockid_t which_clock&quot;</span>, <span class="hljs-string">&quot;struct sigevent *timer_event_spec&quot;</span>, <span class="hljs-string">&quot;timer_t * created_timer_id&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [108, <span class="hljs-string">&quot;timer_gettime&quot;</span>, 0x6c, <span class="hljs-string">&quot;timer_t timer_id&quot;</span>, <span class="hljs-string">&quot;struct __kernel_itimerspec *setting&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [109, <span class="hljs-string">&quot;timer_getoverrun&quot;</span>, 0x6d, <span class="hljs-string">&quot;timer_t timer_id&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [110, <span class="hljs-string">&quot;timer_settime&quot;</span>, 0x6e, <span class="hljs-string">&quot;timer_t timer_id&quot;</span>, <span class="hljs-string">&quot;int flags&quot;</span>, <span class="hljs-string">&quot;const struct __kernel_itimerspec *new_setting&quot;</span>, <span class="hljs-string">&quot;struct __kernel_itimerspec *old_setting&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [111, <span class="hljs-string">&quot;timer_delete&quot;</span>, 0x6f, <span class="hljs-string">&quot;timer_t timer_id&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [112, <span class="hljs-string">&quot;clock_settime&quot;</span>, 0x70, <span class="hljs-string">&quot;clockid_t which_clock&quot;</span>, <span class="hljs-string">&quot;const struct __kernel_timespec *tp&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [113, <span class="hljs-string">&quot;clock_gettime&quot;</span>, 0x71, <span class="hljs-string">&quot;clockid_t which_clock&quot;</span>, <span class="hljs-string">&quot;struct __kernel_timespec *tp&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [114, <span class="hljs-string">&quot;clock_getres&quot;</span>, 0x72, <span class="hljs-string">&quot;clockid_t which_clock&quot;</span>, <span class="hljs-string">&quot;struct __kernel_timespec *tp&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [115, <span class="hljs-string">&quot;clock_nanosleep&quot;</span>, 0x73, <span class="hljs-string">&quot;clockid_t which_clock&quot;</span>, <span class="hljs-string">&quot;int flags&quot;</span>, <span class="hljs-string">&quot;const struct __kernel_timespec *rqtp&quot;</span>, <span class="hljs-string">&quot;struct __kernel_timespec *rmtp&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [116, <span class="hljs-string">&quot;syslog&quot;</span>, 0x74, <span class="hljs-string">&quot;int type&quot;</span>, <span class="hljs-string">&quot;char *buf&quot;</span>, <span class="hljs-string">&quot;int len&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [117, <span class="hljs-string">&quot;ptrace&quot;</span>, 0x75, <span class="hljs-string">&quot;long request&quot;</span>, <span class="hljs-string">&quot;long pid&quot;</span>, <span class="hljs-string">&quot;unsigned long addr&quot;</span>, <span class="hljs-string">&quot;unsigned long data&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [118, <span class="hljs-string">&quot;sched_setparam&quot;</span>, 0x76, <span class="hljs-string">&quot;pid_t pid&quot;</span>, <span class="hljs-string">&quot;struct sched_param *param&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [119, <span class="hljs-string">&quot;sched_setscheduler&quot;</span>, 0x77, <span class="hljs-string">&quot;pid_t pid&quot;</span>, <span class="hljs-string">&quot;int policy&quot;</span>, <span class="hljs-string">&quot;struct sched_param *param&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [120, <span class="hljs-string">&quot;sched_getscheduler&quot;</span>, 0x78, <span class="hljs-string">&quot;pid_t pid&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [121, <span class="hljs-string">&quot;sched_getparam&quot;</span>, 0x79, <span class="hljs-string">&quot;pid_t pid&quot;</span>, <span class="hljs-string">&quot;struct sched_param *param&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [122, <span class="hljs-string">&quot;sched_setaffinity&quot;</span>, 0x7a, <span class="hljs-string">&quot;pid_t pid&quot;</span>, <span class="hljs-string">&quot;unsigned int len&quot;</span>, <span class="hljs-string">&quot;unsigned long *user_mask_ptr&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [123, <span class="hljs-string">&quot;sched_getaffinity&quot;</span>, 0x7b, <span class="hljs-string">&quot;pid_t pid&quot;</span>, <span class="hljs-string">&quot;unsigned int len&quot;</span>, <span class="hljs-string">&quot;unsigned long *user_mask_ptr&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [124, <span class="hljs-string">&quot;sched_yield&quot;</span>, 0x7c, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [125, <span class="hljs-string">&quot;sched_get_priority_max&quot;</span>, 0x7d, <span class="hljs-string">&quot;int policy&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [126, <span class="hljs-string">&quot;sched_get_priority_min&quot;</span>, 0x7e, <span class="hljs-string">&quot;int policy&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [127, <span class="hljs-string">&quot;sched_rr_get_interval&quot;</span>, 0x7f, <span class="hljs-string">&quot;pid_t pid&quot;</span>, <span class="hljs-string">&quot;struct __kernel_timespec *interval&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [128, <span class="hljs-string">&quot;restart_syscall&quot;</span>, 0x80, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [129, <span class="hljs-string">&quot;kill&quot;</span>, 0x81, <span class="hljs-string">&quot;pid_t pid&quot;</span>, <span class="hljs-string">&quot;int sig&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [130, <span class="hljs-string">&quot;tkill&quot;</span>, 0x82, <span class="hljs-string">&quot;pid_t pid&quot;</span>, <span class="hljs-string">&quot;int sig&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [131, <span class="hljs-string">&quot;tgkill&quot;</span>, 0x83, <span class="hljs-string">&quot;pid_t tgid&quot;</span>, <span class="hljs-string">&quot;pid_t pid&quot;</span>, <span class="hljs-string">&quot;int sig&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [132, <span class="hljs-string">&quot;sigaltstack&quot;</span>, 0x84, <span class="hljs-string">&quot;const struct sigaltstack *uss&quot;</span>, <span class="hljs-string">&quot;struct sigaltstack *uoss&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [133, <span class="hljs-string">&quot;rt_sigsuspend&quot;</span>, 0x85, <span class="hljs-string">&quot;sigset_t *unewset&quot;</span>, <span class="hljs-string">&quot;size_t sigsetsize&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [134, <span class="hljs-string">&quot;rt_sigaction&quot;</span>, 0x86, <span class="hljs-string">&quot;int&quot;</span>, <span class="hljs-string">&quot;const struct sigaction *&quot;</span>, <span class="hljs-string">&quot;struct sigaction *&quot;</span>, <span class="hljs-string">&quot;size_t&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [135, <span class="hljs-string">&quot;rt_sigprocmask&quot;</span>, 0x87, <span class="hljs-string">&quot;int how&quot;</span>, <span class="hljs-string">&quot;sigset_t *set&quot;</span>, <span class="hljs-string">&quot;sigset_t *oset&quot;</span>, <span class="hljs-string">&quot;size_t sigsetsize&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [136, <span class="hljs-string">&quot;rt_sigpending&quot;</span>, 0x88, <span class="hljs-string">&quot;sigset_t *set&quot;</span>, <span class="hljs-string">&quot;size_t sigsetsize&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [137, <span class="hljs-string">&quot;rt_sigtimedwait&quot;</span>, 0x89, <span class="hljs-string">&quot;const sigset_t *uthese&quot;</span>, <span class="hljs-string">&quot;siginfo_t *uinfo&quot;</span>, <span class="hljs-string">&quot;const struct __kernel_timespec *uts&quot;</span>, <span class="hljs-string">&quot;size_t sigsetsize&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [138, <span class="hljs-string">&quot;rt_sigqueueinfo&quot;</span>, 0x8a, <span class="hljs-string">&quot;pid_t pid&quot;</span>, <span class="hljs-string">&quot;int sig&quot;</span>, <span class="hljs-string">&quot;siginfo_t *uinfo&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [139, <span class="hljs-string">&quot;rt_sigreturn&quot;</span>, 0x8b, <span class="hljs-string">&quot;?&quot;</span>, <span class="hljs-string">&quot;?&quot;</span>, <span class="hljs-string">&quot;?&quot;</span>, <span class="hljs-string">&quot;?&quot;</span>, <span class="hljs-string">&quot;?&quot;</span>, <span class="hljs-string">&quot;?&quot;</span>],<br>    [140, <span class="hljs-string">&quot;setpriority&quot;</span>, 0x8c, <span class="hljs-string">&quot;int which&quot;</span>, <span class="hljs-string">&quot;int who&quot;</span>, <span class="hljs-string">&quot;int niceval&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [141, <span class="hljs-string">&quot;getpriority&quot;</span>, 0x8d, <span class="hljs-string">&quot;int which&quot;</span>, <span class="hljs-string">&quot;int who&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [142, <span class="hljs-string">&quot;reboot&quot;</span>, 0x8e, <span class="hljs-string">&quot;int magic1&quot;</span>, <span class="hljs-string">&quot;int magic2&quot;</span>, <span class="hljs-string">&quot;unsigned int cmd&quot;</span>, <span class="hljs-string">&quot;void *arg&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [143, <span class="hljs-string">&quot;setregid&quot;</span>, 0x8f, <span class="hljs-string">&quot;gid_t rgid&quot;</span>, <span class="hljs-string">&quot;gid_t egid&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [144, <span class="hljs-string">&quot;setgid&quot;</span>, 0x90, <span class="hljs-string">&quot;gid_t gid&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [145, <span class="hljs-string">&quot;setreuid&quot;</span>, 0x91, <span class="hljs-string">&quot;uid_t ruid&quot;</span>, <span class="hljs-string">&quot;uid_t euid&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [146, <span class="hljs-string">&quot;setuid&quot;</span>, 0x92, <span class="hljs-string">&quot;uid_t uid&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [147, <span class="hljs-string">&quot;setresuid&quot;</span>, 0x93, <span class="hljs-string">&quot;uid_t ruid&quot;</span>, <span class="hljs-string">&quot;uid_t euid&quot;</span>, <span class="hljs-string">&quot;uid_t suid&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [148, <span class="hljs-string">&quot;getresuid&quot;</span>, 0x94, <span class="hljs-string">&quot;uid_t *ruid&quot;</span>, <span class="hljs-string">&quot;uid_t *euid&quot;</span>, <span class="hljs-string">&quot;uid_t *suid&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [149, <span class="hljs-string">&quot;setresgid&quot;</span>, 0x95, <span class="hljs-string">&quot;gid_t rgid&quot;</span>, <span class="hljs-string">&quot;gid_t egid&quot;</span>, <span class="hljs-string">&quot;gid_t sgid&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [150, <span class="hljs-string">&quot;getresgid&quot;</span>, 0x96, <span class="hljs-string">&quot;gid_t *rgid&quot;</span>, <span class="hljs-string">&quot;gid_t *egid&quot;</span>, <span class="hljs-string">&quot;gid_t *sgid&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [151, <span class="hljs-string">&quot;setfsuid&quot;</span>, 0x97, <span class="hljs-string">&quot;uid_t uid&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [152, <span class="hljs-string">&quot;setfsgid&quot;</span>, 0x98, <span class="hljs-string">&quot;gid_t gid&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [153, <span class="hljs-string">&quot;times&quot;</span>, 0x99, <span class="hljs-string">&quot;struct tms *tbuf&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [154, <span class="hljs-string">&quot;setpgid&quot;</span>, 0x9a, <span class="hljs-string">&quot;pid_t pid&quot;</span>, <span class="hljs-string">&quot;pid_t pgid&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [155, <span class="hljs-string">&quot;getpgid&quot;</span>, 0x9b, <span class="hljs-string">&quot;pid_t pid&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [156, <span class="hljs-string">&quot;getsid&quot;</span>, 0x9c, <span class="hljs-string">&quot;pid_t pid&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [157, <span class="hljs-string">&quot;setsid&quot;</span>, 0x9d, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [158, <span class="hljs-string">&quot;getgroups&quot;</span>, 0x9e, <span class="hljs-string">&quot;int gidsetsize&quot;</span>, <span class="hljs-string">&quot;gid_t *grouplist&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [159, <span class="hljs-string">&quot;setgroups&quot;</span>, 0x9f, <span class="hljs-string">&quot;int gidsetsize&quot;</span>, <span class="hljs-string">&quot;gid_t *grouplist&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [160, <span class="hljs-string">&quot;uname&quot;</span>, 0xa0, <span class="hljs-string">&quot;struct old_utsname *&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [161, <span class="hljs-string">&quot;sethostname&quot;</span>, 0xa1, <span class="hljs-string">&quot;char *name&quot;</span>, <span class="hljs-string">&quot;int len&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [162, <span class="hljs-string">&quot;setdomainname&quot;</span>, 0xa2, <span class="hljs-string">&quot;char *name&quot;</span>, <span class="hljs-string">&quot;int len&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [163, <span class="hljs-string">&quot;getrlimit&quot;</span>, 0xa3, <span class="hljs-string">&quot;unsigned int resource&quot;</span>, <span class="hljs-string">&quot;struct rlimit *rlim&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [164, <span class="hljs-string">&quot;setrlimit&quot;</span>, 0xa4, <span class="hljs-string">&quot;unsigned int resource&quot;</span>, <span class="hljs-string">&quot;struct rlimit *rlim&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [165, <span class="hljs-string">&quot;getrusage&quot;</span>, 0xa5, <span class="hljs-string">&quot;int who&quot;</span>, <span class="hljs-string">&quot;struct rusage *ru&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [166, <span class="hljs-string">&quot;umask&quot;</span>, 0xa6, <span class="hljs-string">&quot;int mask&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [167, <span class="hljs-string">&quot;prctl&quot;</span>, 0xa7, <span class="hljs-string">&quot;int option&quot;</span>, <span class="hljs-string">&quot;unsigned long arg2&quot;</span>, <span class="hljs-string">&quot;unsigned long arg3&quot;</span>, <span class="hljs-string">&quot;unsigned long arg4&quot;</span>, <span class="hljs-string">&quot;unsigned long arg5&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [168, <span class="hljs-string">&quot;getcpu&quot;</span>, 0xa8, <span class="hljs-string">&quot;unsigned *cpu&quot;</span>, <span class="hljs-string">&quot;unsigned *node&quot;</span>, <span class="hljs-string">&quot;struct getcpu_cache *cache&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [169, <span class="hljs-string">&quot;gettimeofday&quot;</span>, 0xa9, <span class="hljs-string">&quot;struct timeval *tv&quot;</span>, <span class="hljs-string">&quot;struct timezone *tz&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [170, <span class="hljs-string">&quot;settimeofday&quot;</span>, 0xaa, <span class="hljs-string">&quot;struct timeval *tv&quot;</span>, <span class="hljs-string">&quot;struct timezone *tz&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [171, <span class="hljs-string">&quot;adjtimex&quot;</span>, 0xab, <span class="hljs-string">&quot;struct __kernel_timex *txc_p&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [172, <span class="hljs-string">&quot;getpid&quot;</span>, 0xac, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [173, <span class="hljs-string">&quot;getppid&quot;</span>, 0xad, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [174, <span class="hljs-string">&quot;getuid&quot;</span>, 0xae, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [175, <span class="hljs-string">&quot;geteuid&quot;</span>, 0xaf, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [176, <span class="hljs-string">&quot;getgid&quot;</span>, 0xb0, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [177, <span class="hljs-string">&quot;getegid&quot;</span>, 0xb1, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [178, <span class="hljs-string">&quot;gettid&quot;</span>, 0xb2, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [179, <span class="hljs-string">&quot;sysinfo&quot;</span>, 0xb3, <span class="hljs-string">&quot;struct sysinfo *info&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [180, <span class="hljs-string">&quot;mq_open&quot;</span>, 0xb4, <span class="hljs-string">&quot;const char *name&quot;</span>, <span class="hljs-string">&quot;int oflag&quot;</span>, <span class="hljs-string">&quot;umode_t mode&quot;</span>, <span class="hljs-string">&quot;struct mq_attr *attr&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [181, <span class="hljs-string">&quot;mq_unlink&quot;</span>, 0xb5, <span class="hljs-string">&quot;const char *name&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [182, <span class="hljs-string">&quot;mq_timedsend&quot;</span>, 0xb6, <span class="hljs-string">&quot;mqd_t mqdes&quot;</span>, <span class="hljs-string">&quot;const char *msg_ptr&quot;</span>, <span class="hljs-string">&quot;size_t msg_len&quot;</span>, <span class="hljs-string">&quot;unsigned int msg_prio&quot;</span>, <span class="hljs-string">&quot;const struct __kernel_timespec *abs_timeout&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [183, <span class="hljs-string">&quot;mq_timedreceive&quot;</span>, 0xb7, <span class="hljs-string">&quot;mqd_t mqdes&quot;</span>, <span class="hljs-string">&quot;char *msg_ptr&quot;</span>, <span class="hljs-string">&quot;size_t msg_len&quot;</span>, <span class="hljs-string">&quot;unsigned int *msg_prio&quot;</span>, <span class="hljs-string">&quot;const struct __kernel_timespec *abs_timeout&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [184, <span class="hljs-string">&quot;mq_notify&quot;</span>, 0xb8, <span class="hljs-string">&quot;mqd_t mqdes&quot;</span>, <span class="hljs-string">&quot;const struct sigevent *notification&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [185, <span class="hljs-string">&quot;mq_getsetattr&quot;</span>, 0xb9, <span class="hljs-string">&quot;mqd_t mqdes&quot;</span>, <span class="hljs-string">&quot;const struct mq_attr *mqstat&quot;</span>, <span class="hljs-string">&quot;struct mq_attr *omqstat&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [186, <span class="hljs-string">&quot;msgget&quot;</span>, 0xba, <span class="hljs-string">&quot;key_t key&quot;</span>, <span class="hljs-string">&quot;int msgflg&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [187, <span class="hljs-string">&quot;msgctl&quot;</span>, 0xbb, <span class="hljs-string">&quot;int msqid&quot;</span>, <span class="hljs-string">&quot;int cmd&quot;</span>, <span class="hljs-string">&quot;struct msqid_ds *buf&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [188, <span class="hljs-string">&quot;msgrcv&quot;</span>, 0xbc, <span class="hljs-string">&quot;int msqid&quot;</span>, <span class="hljs-string">&quot;struct msgbuf *msgp&quot;</span>, <span class="hljs-string">&quot;size_t msgsz&quot;</span>, <span class="hljs-string">&quot;long msgtyp&quot;</span>, <span class="hljs-string">&quot;int msgflg&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [189, <span class="hljs-string">&quot;msgsnd&quot;</span>, 0xbd, <span class="hljs-string">&quot;int msqid&quot;</span>, <span class="hljs-string">&quot;struct msgbuf *msgp&quot;</span>, <span class="hljs-string">&quot;size_t msgsz&quot;</span>, <span class="hljs-string">&quot;int msgflg&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [190, <span class="hljs-string">&quot;semget&quot;</span>, 0xbe, <span class="hljs-string">&quot;key_t key&quot;</span>, <span class="hljs-string">&quot;int nsems&quot;</span>, <span class="hljs-string">&quot;int semflg&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [191, <span class="hljs-string">&quot;semctl&quot;</span>, 0xbf, <span class="hljs-string">&quot;int semid&quot;</span>, <span class="hljs-string">&quot;int semnum&quot;</span>, <span class="hljs-string">&quot;int cmd&quot;</span>, <span class="hljs-string">&quot;unsigned long arg&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [192, <span class="hljs-string">&quot;semtimedop&quot;</span>, 0xc0, <span class="hljs-string">&quot;int semid&quot;</span>, <span class="hljs-string">&quot;struct sembuf *sops&quot;</span>, <span class="hljs-string">&quot;unsigned nsops&quot;</span>, <span class="hljs-string">&quot;const struct __kernel_timespec *timeout&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [193, <span class="hljs-string">&quot;semop&quot;</span>, 0xc1, <span class="hljs-string">&quot;int semid&quot;</span>, <span class="hljs-string">&quot;struct sembuf *sops&quot;</span>, <span class="hljs-string">&quot;unsigned nsops&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [194, <span class="hljs-string">&quot;shmget&quot;</span>, 0xc2, <span class="hljs-string">&quot;key_t key&quot;</span>, <span class="hljs-string">&quot;size_t size&quot;</span>, <span class="hljs-string">&quot;int flag&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [195, <span class="hljs-string">&quot;shmctl&quot;</span>, 0xc3, <span class="hljs-string">&quot;int shmid&quot;</span>, <span class="hljs-string">&quot;int cmd&quot;</span>, <span class="hljs-string">&quot;struct shmid_ds *buf&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [196, <span class="hljs-string">&quot;shmat&quot;</span>, 0xc4, <span class="hljs-string">&quot;int shmid&quot;</span>, <span class="hljs-string">&quot;char *shmaddr&quot;</span>, <span class="hljs-string">&quot;int shmflg&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [197, <span class="hljs-string">&quot;shmdt&quot;</span>, 0xc5, <span class="hljs-string">&quot;char *shmaddr&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [198, <span class="hljs-string">&quot;socket&quot;</span>, 0xc6, <span class="hljs-string">&quot;int&quot;</span>, <span class="hljs-string">&quot;int&quot;</span>, <span class="hljs-string">&quot;int&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [199, <span class="hljs-string">&quot;socketpair&quot;</span>, 0xc7, <span class="hljs-string">&quot;int&quot;</span>, <span class="hljs-string">&quot;int&quot;</span>, <span class="hljs-string">&quot;int&quot;</span>, <span class="hljs-string">&quot;int *&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [200, <span class="hljs-string">&quot;bind&quot;</span>, 0xc8, <span class="hljs-string">&quot;int&quot;</span>, <span class="hljs-string">&quot;struct sockaddr *&quot;</span>, <span class="hljs-string">&quot;int&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [201, <span class="hljs-string">&quot;listen&quot;</span>, 0xc9, <span class="hljs-string">&quot;int&quot;</span>, <span class="hljs-string">&quot;int&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [202, <span class="hljs-string">&quot;accept&quot;</span>, 0xca, <span class="hljs-string">&quot;int&quot;</span>, <span class="hljs-string">&quot;struct sockaddr *&quot;</span>, <span class="hljs-string">&quot;int *&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [203, <span class="hljs-string">&quot;connect&quot;</span>, 0xcb, <span class="hljs-string">&quot;int&quot;</span>, <span class="hljs-string">&quot;struct sockaddr *&quot;</span>, <span class="hljs-string">&quot;int&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [204, <span class="hljs-string">&quot;getsockname&quot;</span>, 0xcc, <span class="hljs-string">&quot;int&quot;</span>, <span class="hljs-string">&quot;struct sockaddr *&quot;</span>, <span class="hljs-string">&quot;int *&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [205, <span class="hljs-string">&quot;getpeername&quot;</span>, 0xcd, <span class="hljs-string">&quot;int&quot;</span>, <span class="hljs-string">&quot;struct sockaddr *&quot;</span>, <span class="hljs-string">&quot;int *&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [206, <span class="hljs-string">&quot;sendto&quot;</span>, 0xce, <span class="hljs-string">&quot;int&quot;</span>, <span class="hljs-string">&quot;void *&quot;</span>, <span class="hljs-string">&quot;size_t&quot;</span>, <span class="hljs-string">&quot;unsigned&quot;</span>, <span class="hljs-string">&quot;struct sockaddr *&quot;</span>, <span class="hljs-string">&quot;int&quot;</span>],<br>    [207, <span class="hljs-string">&quot;recvfrom&quot;</span>, 0xcf, <span class="hljs-string">&quot;int&quot;</span>, <span class="hljs-string">&quot;void *&quot;</span>, <span class="hljs-string">&quot;size_t&quot;</span>, <span class="hljs-string">&quot;unsigned&quot;</span>, <span class="hljs-string">&quot;struct sockaddr *&quot;</span>, <span class="hljs-string">&quot;int *&quot;</span>],<br>    [208, <span class="hljs-string">&quot;setsockopt&quot;</span>, 0xd0, <span class="hljs-string">&quot;int fd&quot;</span>, <span class="hljs-string">&quot;int level&quot;</span>, <span class="hljs-string">&quot;int optname&quot;</span>, <span class="hljs-string">&quot;char *optval&quot;</span>, <span class="hljs-string">&quot;int optlen&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [209, <span class="hljs-string">&quot;getsockopt&quot;</span>, 0xd1, <span class="hljs-string">&quot;int fd&quot;</span>, <span class="hljs-string">&quot;int level&quot;</span>, <span class="hljs-string">&quot;int optname&quot;</span>, <span class="hljs-string">&quot;char *optval&quot;</span>, <span class="hljs-string">&quot;int *optlen&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [210, <span class="hljs-string">&quot;shutdown&quot;</span>, 0xd2, <span class="hljs-string">&quot;int&quot;</span>, <span class="hljs-string">&quot;int&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [211, <span class="hljs-string">&quot;sendmsg&quot;</span>, 0xd3, <span class="hljs-string">&quot;int fd&quot;</span>, <span class="hljs-string">&quot;struct user_msghdr *msg&quot;</span>, <span class="hljs-string">&quot;unsigned flags&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [212, <span class="hljs-string">&quot;recvmsg&quot;</span>, 0xd4, <span class="hljs-string">&quot;int fd&quot;</span>, <span class="hljs-string">&quot;struct user_msghdr *msg&quot;</span>, <span class="hljs-string">&quot;unsigned flags&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [213, <span class="hljs-string">&quot;readahead&quot;</span>, 0xd5, <span class="hljs-string">&quot;int fd&quot;</span>, <span class="hljs-string">&quot;loff_t offset&quot;</span>, <span class="hljs-string">&quot;size_t count&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [214, <span class="hljs-string">&quot;brk&quot;</span>, 0xd6, <span class="hljs-string">&quot;unsigned long brk&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [215, <span class="hljs-string">&quot;munmap&quot;</span>, 0xd7, <span class="hljs-string">&quot;unsigned long addr&quot;</span>, <span class="hljs-string">&quot;size_t len&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [216, <span class="hljs-string">&quot;mremap&quot;</span>, 0xd8, <span class="hljs-string">&quot;unsigned long addr&quot;</span>, <span class="hljs-string">&quot;unsigned long old_len&quot;</span>, <span class="hljs-string">&quot;unsigned long new_len&quot;</span>, <span class="hljs-string">&quot;unsigned long flags&quot;</span>, <span class="hljs-string">&quot;unsigned long new_addr&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [217, <span class="hljs-string">&quot;add_key&quot;</span>, 0xd9, <span class="hljs-string">&quot;const char *_type&quot;</span>, <span class="hljs-string">&quot;const char *_description&quot;</span>, <span class="hljs-string">&quot;const void *_payload&quot;</span>, <span class="hljs-string">&quot;size_t plen&quot;</span>, <span class="hljs-string">&quot;key_serial_t destringid&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [218, <span class="hljs-string">&quot;request_key&quot;</span>, 0xda, <span class="hljs-string">&quot;const char *_type&quot;</span>, <span class="hljs-string">&quot;const char *_description&quot;</span>, <span class="hljs-string">&quot;const char *_callout_info&quot;</span>, <span class="hljs-string">&quot;key_serial_t destringid&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [219, <span class="hljs-string">&quot;keyctl&quot;</span>, 0xdb, <span class="hljs-string">&quot;int cmd&quot;</span>, <span class="hljs-string">&quot;unsigned long arg2&quot;</span>, <span class="hljs-string">&quot;unsigned long arg3&quot;</span>, <span class="hljs-string">&quot;unsigned long arg4&quot;</span>, <span class="hljs-string">&quot;unsigned long arg5&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [220, <span class="hljs-string">&quot;clone&quot;</span>, 0xdc, <span class="hljs-string">&quot;unsigned long&quot;</span>, <span class="hljs-string">&quot;unsigned long&quot;</span>, <span class="hljs-string">&quot;int *&quot;</span>, <span class="hljs-string">&quot;int *&quot;</span>, <span class="hljs-string">&quot;unsigned long&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [221, <span class="hljs-string">&quot;execve&quot;</span>, 0xdd, <span class="hljs-string">&quot;const char *filename&quot;</span>, <span class="hljs-string">&quot;const char *const *argv&quot;</span>, <span class="hljs-string">&quot;const char *const *envp&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [222, <span class="hljs-string">&quot;mmap&quot;</span>, 0xde, <span class="hljs-string">&quot;?&quot;</span>, <span class="hljs-string">&quot;?&quot;</span>, <span class="hljs-string">&quot;?&quot;</span>, <span class="hljs-string">&quot;?&quot;</span>, <span class="hljs-string">&quot;?&quot;</span>, <span class="hljs-string">&quot;?&quot;</span>],<br>    [223, <span class="hljs-string">&quot;fadvise64&quot;</span>, 0xdf, <span class="hljs-string">&quot;int fd&quot;</span>, <span class="hljs-string">&quot;loff_t offset&quot;</span>, <span class="hljs-string">&quot;size_t len&quot;</span>, <span class="hljs-string">&quot;int advice&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [224, <span class="hljs-string">&quot;swapon&quot;</span>, 0xe0, <span class="hljs-string">&quot;const char *specialfile&quot;</span>, <span class="hljs-string">&quot;int swap_flags&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [225, <span class="hljs-string">&quot;swapoff&quot;</span>, 0xe1, <span class="hljs-string">&quot;const char *specialfile&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [226, <span class="hljs-string">&quot;mprotect&quot;</span>, 0xe2, <span class="hljs-string">&quot;unsigned long start&quot;</span>, <span class="hljs-string">&quot;size_t len&quot;</span>, <span class="hljs-string">&quot;unsigned long prot&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [227, <span class="hljs-string">&quot;msync&quot;</span>, 0xe3, <span class="hljs-string">&quot;unsigned long start&quot;</span>, <span class="hljs-string">&quot;size_t len&quot;</span>, <span class="hljs-string">&quot;int flags&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [228, <span class="hljs-string">&quot;mlock&quot;</span>, 0xe4, <span class="hljs-string">&quot;unsigned long start&quot;</span>, <span class="hljs-string">&quot;size_t len&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [229, <span class="hljs-string">&quot;munlock&quot;</span>, 0xe5, <span class="hljs-string">&quot;unsigned long start&quot;</span>, <span class="hljs-string">&quot;size_t len&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [230, <span class="hljs-string">&quot;mlockall&quot;</span>, 0xe6, <span class="hljs-string">&quot;int flags&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [231, <span class="hljs-string">&quot;munlockall&quot;</span>, 0xe7, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [232, <span class="hljs-string">&quot;mincore&quot;</span>, 0xe8, <span class="hljs-string">&quot;unsigned long start&quot;</span>, <span class="hljs-string">&quot;size_t len&quot;</span>, <span class="hljs-string">&quot;unsigned char * vec&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [233, <span class="hljs-string">&quot;madvise&quot;</span>, 0xe9, <span class="hljs-string">&quot;unsigned long start&quot;</span>, <span class="hljs-string">&quot;size_t len&quot;</span>, <span class="hljs-string">&quot;int behavior&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [234, <span class="hljs-string">&quot;remap_file_pages&quot;</span>, 0xea, <span class="hljs-string">&quot;unsigned long start&quot;</span>, <span class="hljs-string">&quot;unsigned long size&quot;</span>, <span class="hljs-string">&quot;unsigned long prot&quot;</span>, <span class="hljs-string">&quot;unsigned long pgoff&quot;</span>, <span class="hljs-string">&quot;unsigned long flags&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [235, <span class="hljs-string">&quot;mbind&quot;</span>, 0xeb, <span class="hljs-string">&quot;unsigned long start&quot;</span>, <span class="hljs-string">&quot;unsigned long len&quot;</span>, <span class="hljs-string">&quot;unsigned long mode&quot;</span>, <span class="hljs-string">&quot;const unsigned long *nmask&quot;</span>, <span class="hljs-string">&quot;unsigned long maxnode&quot;</span>, <span class="hljs-string">&quot;unsigned flags&quot;</span>],<br>    [236, <span class="hljs-string">&quot;get_mempolicy&quot;</span>, 0xec, <span class="hljs-string">&quot;int *policy&quot;</span>, <span class="hljs-string">&quot;unsigned long *nmask&quot;</span>, <span class="hljs-string">&quot;unsigned long maxnode&quot;</span>, <span class="hljs-string">&quot;unsigned long addr&quot;</span>, <span class="hljs-string">&quot;unsigned long flags&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [237, <span class="hljs-string">&quot;set_mempolicy&quot;</span>, 0xed, <span class="hljs-string">&quot;int mode&quot;</span>, <span class="hljs-string">&quot;const unsigned long *nmask&quot;</span>, <span class="hljs-string">&quot;unsigned long maxnode&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [238, <span class="hljs-string">&quot;migrate_pages&quot;</span>, 0xee, <span class="hljs-string">&quot;pid_t pid&quot;</span>, <span class="hljs-string">&quot;unsigned long maxnode&quot;</span>, <span class="hljs-string">&quot;const unsigned long *from&quot;</span>, <span class="hljs-string">&quot;const unsigned long *to&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [239, <span class="hljs-string">&quot;move_pages&quot;</span>, 0xef, <span class="hljs-string">&quot;pid_t pid&quot;</span>, <span class="hljs-string">&quot;unsigned long nr_pages&quot;</span>, <span class="hljs-string">&quot;const void * *pages&quot;</span>, <span class="hljs-string">&quot;const int *nodes&quot;</span>, <span class="hljs-string">&quot;int *status&quot;</span>, <span class="hljs-string">&quot;int flags&quot;</span>],<br>    [240, <span class="hljs-string">&quot;rt_tgsigqueueinfo&quot;</span>, 0xf0, <span class="hljs-string">&quot;pid_t tgid&quot;</span>, <span class="hljs-string">&quot;pid_t pid&quot;</span>, <span class="hljs-string">&quot;int sig&quot;</span>, <span class="hljs-string">&quot;siginfo_t *uinfo&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [241, <span class="hljs-string">&quot;perf_event_open&quot;</span>, 0xf1, <span class="hljs-string">&quot;struct perf_event_attr *attr_uptr&quot;</span>, <span class="hljs-string">&quot;pid_t pid&quot;</span>, <span class="hljs-string">&quot;int cpu&quot;</span>, <span class="hljs-string">&quot;int group_fd&quot;</span>, <span class="hljs-string">&quot;unsigned long flags&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [242, <span class="hljs-string">&quot;accept4&quot;</span>, 0xf2, <span class="hljs-string">&quot;int&quot;</span>, <span class="hljs-string">&quot;struct sockaddr *&quot;</span>, <span class="hljs-string">&quot;int *&quot;</span>, <span class="hljs-string">&quot;int&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [243, <span class="hljs-string">&quot;recvmmsg&quot;</span>, 0xf3, <span class="hljs-string">&quot;int fd&quot;</span>, <span class="hljs-string">&quot;struct mmsghdr *msg&quot;</span>, <span class="hljs-string">&quot;unsigned int vlen&quot;</span>, <span class="hljs-string">&quot;unsigned flags&quot;</span>, <span class="hljs-string">&quot;struct __kernel_timespec *timeout&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [244, <span class="hljs-string">&quot;not implemented&quot;</span>, 0xf4],<br>    [245, <span class="hljs-string">&quot;not implemented&quot;</span>, 0xf5],<br>    [246, <span class="hljs-string">&quot;not implemented&quot;</span>, 0xf6],<br>    [247, <span class="hljs-string">&quot;not implemented&quot;</span>, 0xf7],<br>    [248, <span class="hljs-string">&quot;not implemented&quot;</span>, 0xf8],<br>    [249, <span class="hljs-string">&quot;not implemented&quot;</span>, 0xf9],<br>    [250, <span class="hljs-string">&quot;not implemented&quot;</span>, 0xfa],<br>    [251, <span class="hljs-string">&quot;not implemented&quot;</span>, 0xfb],<br>    [252, <span class="hljs-string">&quot;not implemented&quot;</span>, 0xfc],<br>    [253, <span class="hljs-string">&quot;not implemented&quot;</span>, 0xfd],<br>    [254, <span class="hljs-string">&quot;not implemented&quot;</span>, 0xfe],<br>    [255, <span class="hljs-string">&quot;not implemented&quot;</span>, 0xff],<br>    [256, <span class="hljs-string">&quot;not implemented&quot;</span>, 0x100],<br>    [257, <span class="hljs-string">&quot;not implemented&quot;</span>, 0x101],<br>    [258, <span class="hljs-string">&quot;not implemented&quot;</span>, 0x102],<br>    [259, <span class="hljs-string">&quot;not implemented&quot;</span>, 0x103],<br>    [260, <span class="hljs-string">&quot;wait4&quot;</span>, 0x104, <span class="hljs-string">&quot;pid_t pid&quot;</span>, <span class="hljs-string">&quot;int *stat_addr&quot;</span>, <span class="hljs-string">&quot;int options&quot;</span>, <span class="hljs-string">&quot;struct rusage *ru&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [261, <span class="hljs-string">&quot;prlimit64&quot;</span>, 0x105, <span class="hljs-string">&quot;pid_t pid&quot;</span>, <span class="hljs-string">&quot;unsigned int resource&quot;</span>, <span class="hljs-string">&quot;const struct rlimit64 *new_rlim&quot;</span>, <span class="hljs-string">&quot;struct rlimit64 *old_rlim&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [262, <span class="hljs-string">&quot;fanotify_init&quot;</span>, 0x106, <span class="hljs-string">&quot;unsigned int flags&quot;</span>, <span class="hljs-string">&quot;unsigned int event_f_flags&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [263, <span class="hljs-string">&quot;fanotify_mark&quot;</span>, 0x107, <span class="hljs-string">&quot;int fanotify_fd&quot;</span>, <span class="hljs-string">&quot;unsigned int flags&quot;</span>, <span class="hljs-string">&quot;u64 mask&quot;</span>, <span class="hljs-string">&quot;int fd&quot;</span>, <span class="hljs-string">&quot;const char *pathname&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [264, <span class="hljs-string">&quot;name_to_handle_at&quot;</span>, 0x108, <span class="hljs-string">&quot;int dfd&quot;</span>, <span class="hljs-string">&quot;const char *name&quot;</span>, <span class="hljs-string">&quot;struct file_handle *handle&quot;</span>, <span class="hljs-string">&quot;int *mnt_id&quot;</span>, <span class="hljs-string">&quot;int flag&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [265, <span class="hljs-string">&quot;open_by_handle_at&quot;</span>, 0x109, <span class="hljs-string">&quot;int mountdirfd&quot;</span>, <span class="hljs-string">&quot;struct file_handle *handle&quot;</span>, <span class="hljs-string">&quot;int flags&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [266, <span class="hljs-string">&quot;clock_adjtime&quot;</span>, 0x10a, <span class="hljs-string">&quot;clockid_t which_clock&quot;</span>, <span class="hljs-string">&quot;struct __kernel_timex *tx&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [267, <span class="hljs-string">&quot;syncfs&quot;</span>, 0x10b, <span class="hljs-string">&quot;int fd&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [268, <span class="hljs-string">&quot;setns&quot;</span>, 0x10c, <span class="hljs-string">&quot;int fd&quot;</span>, <span class="hljs-string">&quot;int nstype&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [269, <span class="hljs-string">&quot;sendmmsg&quot;</span>, 0x10d, <span class="hljs-string">&quot;int fd&quot;</span>, <span class="hljs-string">&quot;struct mmsghdr *msg&quot;</span>, <span class="hljs-string">&quot;unsigned int vlen&quot;</span>, <span class="hljs-string">&quot;unsigned flags&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [270, <span class="hljs-string">&quot;process_vm_readv&quot;</span>, 0x10e, <span class="hljs-string">&quot;pid_t pid&quot;</span>, <span class="hljs-string">&quot;const struct iovec *lvec&quot;</span>, <span class="hljs-string">&quot;unsigned long liovcnt&quot;</span>, <span class="hljs-string">&quot;const struct iovec *rvec&quot;</span>, <span class="hljs-string">&quot;unsigned long riovcnt&quot;</span>, <span class="hljs-string">&quot;unsigned long flags&quot;</span>],<br>    [271, <span class="hljs-string">&quot;process_vm_writev&quot;</span>, 0x10f, <span class="hljs-string">&quot;pid_t pid&quot;</span>, <span class="hljs-string">&quot;const struct iovec *lvec&quot;</span>, <span class="hljs-string">&quot;unsigned long liovcnt&quot;</span>, <span class="hljs-string">&quot;const struct iovec *rvec&quot;</span>, <span class="hljs-string">&quot;unsigned long riovcnt&quot;</span>, <span class="hljs-string">&quot;unsigned long flags&quot;</span>],<br>    [272, <span class="hljs-string">&quot;kcmp&quot;</span>, 0x110, <span class="hljs-string">&quot;pid_t pid1&quot;</span>, <span class="hljs-string">&quot;pid_t pid2&quot;</span>, <span class="hljs-string">&quot;int type&quot;</span>, <span class="hljs-string">&quot;unsigned long idx1&quot;</span>, <span class="hljs-string">&quot;unsigned long idx2&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [273, <span class="hljs-string">&quot;finit_module&quot;</span>, 0x111, <span class="hljs-string">&quot;int fd&quot;</span>, <span class="hljs-string">&quot;const char *uargs&quot;</span>, <span class="hljs-string">&quot;int flags&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [274, <span class="hljs-string">&quot;sched_setattr&quot;</span>, 0x112, <span class="hljs-string">&quot;pid_t pid&quot;</span>, <span class="hljs-string">&quot;struct sched_attr *attr&quot;</span>, <span class="hljs-string">&quot;unsigned int flags&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [275, <span class="hljs-string">&quot;sched_getattr&quot;</span>, 0x113, <span class="hljs-string">&quot;pid_t pid&quot;</span>, <span class="hljs-string">&quot;struct sched_attr *attr&quot;</span>, <span class="hljs-string">&quot;unsigned int size&quot;</span>, <span class="hljs-string">&quot;unsigned int flags&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [276, <span class="hljs-string">&quot;renameat2&quot;</span>, 0x114, <span class="hljs-string">&quot;int olddfd&quot;</span>, <span class="hljs-string">&quot;const char *oldname&quot;</span>, <span class="hljs-string">&quot;int newdfd&quot;</span>, <span class="hljs-string">&quot;const char *newname&quot;</span>, <span class="hljs-string">&quot;unsigned int flags&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [277, <span class="hljs-string">&quot;seccomp&quot;</span>, 0x115, <span class="hljs-string">&quot;unsigned int op&quot;</span>, <span class="hljs-string">&quot;unsigned int flags&quot;</span>, <span class="hljs-string">&quot;void *uargs&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [278, <span class="hljs-string">&quot;getrandom&quot;</span>, 0x116, <span class="hljs-string">&quot;char *buf&quot;</span>, <span class="hljs-string">&quot;size_t count&quot;</span>, <span class="hljs-string">&quot;unsigned int flags&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [279, <span class="hljs-string">&quot;memfd_create&quot;</span>, 0x117, <span class="hljs-string">&quot;const char *uname_ptr&quot;</span>, <span class="hljs-string">&quot;unsigned int flags&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [280, <span class="hljs-string">&quot;bpf&quot;</span>, 0x118, <span class="hljs-string">&quot;int cmd&quot;</span>, <span class="hljs-string">&quot;union bpf_attr *attr&quot;</span>, <span class="hljs-string">&quot;unsigned int size&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [281, <span class="hljs-string">&quot;execveat&quot;</span>, 0x119, <span class="hljs-string">&quot;int dfd&quot;</span>, <span class="hljs-string">&quot;const char *filename&quot;</span>, <span class="hljs-string">&quot;const char *const *argv&quot;</span>, <span class="hljs-string">&quot;const char *const *envp&quot;</span>, <span class="hljs-string">&quot;int flags&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [282, <span class="hljs-string">&quot;userfaultfd&quot;</span>, 0x11a, <span class="hljs-string">&quot;int flags&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [283, <span class="hljs-string">&quot;membarrier&quot;</span>, 0x11b, <span class="hljs-string">&quot;int cmd&quot;</span>, <span class="hljs-string">&quot;int flags&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [284, <span class="hljs-string">&quot;mlock2&quot;</span>, 0x11c, <span class="hljs-string">&quot;unsigned long start&quot;</span>, <span class="hljs-string">&quot;size_t len&quot;</span>, <span class="hljs-string">&quot;int flags&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [285, <span class="hljs-string">&quot;copy_file_range&quot;</span>, 0x11d, <span class="hljs-string">&quot;int fd_in&quot;</span>, <span class="hljs-string">&quot;loff_t *off_in&quot;</span>, <span class="hljs-string">&quot;int fd_out&quot;</span>, <span class="hljs-string">&quot;loff_t *off_out&quot;</span>, <span class="hljs-string">&quot;size_t len&quot;</span>, <span class="hljs-string">&quot;unsigned int flags&quot;</span>],<br>    [286, <span class="hljs-string">&quot;preadv2&quot;</span>, 0x11e, <span class="hljs-string">&quot;unsigned long fd&quot;</span>, <span class="hljs-string">&quot;const struct iovec *vec&quot;</span>, <span class="hljs-string">&quot;unsigned long vlen&quot;</span>, <span class="hljs-string">&quot;unsigned long pos_l&quot;</span>, <span class="hljs-string">&quot;unsigned long pos_h&quot;</span>, <span class="hljs-string">&quot;rwf_t flags&quot;</span>],<br>    [287, <span class="hljs-string">&quot;pwritev2&quot;</span>, 0x11f, <span class="hljs-string">&quot;unsigned long fd&quot;</span>, <span class="hljs-string">&quot;const struct iovec *vec&quot;</span>, <span class="hljs-string">&quot;unsigned long vlen&quot;</span>, <span class="hljs-string">&quot;unsigned long pos_l&quot;</span>, <span class="hljs-string">&quot;unsigned long pos_h&quot;</span>, <span class="hljs-string">&quot;rwf_t flags&quot;</span>],<br>    [288, <span class="hljs-string">&quot;pkey_mprotect&quot;</span>, 0x120, <span class="hljs-string">&quot;unsigned long start&quot;</span>, <span class="hljs-string">&quot;size_t len&quot;</span>, <span class="hljs-string">&quot;unsigned long prot&quot;</span>, <span class="hljs-string">&quot;int pkey&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [289, <span class="hljs-string">&quot;pkey_alloc&quot;</span>, 0x121, <span class="hljs-string">&quot;unsigned long flags&quot;</span>, <span class="hljs-string">&quot;unsigned long init_val&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [290, <span class="hljs-string">&quot;pkey_free&quot;</span>, 0x122, <span class="hljs-string">&quot;int pkey&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>],<br>    [291, <span class="hljs-string">&quot;statx&quot;</span>, 0x123, <span class="hljs-string">&quot;int dfd&quot;</span>, <span class="hljs-string">&quot;const char *path&quot;</span>, <span class="hljs-string">&quot;unsigned flags&quot;</span>, <span class="hljs-string">&quot;unsigned mask&quot;</span>, <span class="hljs-string">&quot;struct statx *buffer&quot;</span>, <span class="hljs-string">&quot;-&quot;</span>]<br>];<br><br></code></pre></td></tr></table></figure>
<h3 id="jniTrace"><a href="#jniTrace" class="headerlink" title="jniTrace"></a>jniTrace</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br></pre></td><td class="code"><pre><code class="hljs bash">(<span class="hljs-function"><span class="hljs-title">function</span></span>()&#123;<br><br>    (<span class="hljs-function"><span class="hljs-title">function</span></span>()&#123;<span class="hljs-keyword">function</span> r(e,n,t)&#123;<span class="hljs-keyword">function</span> o(i,f)&#123;<span class="hljs-keyword">if</span>(!n[i])&#123;<span class="hljs-keyword">if</span>(!e[i])&#123;var c=<span class="hljs-string">&quot;function&quot;</span>==typeof require&amp;&amp;require;<span class="hljs-keyword">if</span>(!f&amp;&amp;c)<span class="hljs-built_in">return</span> c(i,!0);<span class="hljs-keyword">if</span>(u)<span class="hljs-built_in">return</span> u(i,!0);var a=new Error(<span class="hljs-string">&quot;Cannot find module &#x27;&quot;</span>+i+<span class="hljs-string">&quot;&#x27;&quot;</span>);throw a.code=<span class="hljs-string">&quot;MODULE_NOT_FOUND&quot;</span>,a&#125;var p=n[i]=&#123;exports:&#123;&#125;&#125;;e[i][0].call(p.exports,<span class="hljs-keyword">function</span>(r)&#123;var n=e[i][1][r];<span class="hljs-built_in">return</span> o(n||r)&#125;,p,p.exports,r,e,n,t)&#125;<span class="hljs-built_in">return</span> n[i].exports&#125;<span class="hljs-keyword">for</span>(var u=<span class="hljs-string">&quot;function&quot;</span>==typeof require&amp;&amp;require,i=0;i&lt;t.length;i++)o(t[i]);<span class="hljs-built_in">return</span> o&#125;<span class="hljs-built_in">return</span> r&#125;)()(&#123;1:[<span class="hljs-keyword">function</span>(require,module,exports)&#123;<br>            const jni = require(<span class="hljs-string">&quot;./utils/jni_struct.js&quot;</span>)<br><br>            var library_name = <span class="hljs-string">&quot;%moduleName%&quot;</span> // ex: libsqlite.so<br>            var function_name = <span class="hljs-string">&quot;%methodName%&quot;</span> // ex: JNI_OnLoad<br>            var library_loaded = 0<br><br>            <span class="hljs-keyword">function</span> klog(data)&#123;<br>                var message=&#123;&#125;;<br>                message[<span class="hljs-string">&quot;jsname&quot;</span>]=<span class="hljs-string">&quot;jni_trace_new&quot;</span>;<br>                message[<span class="hljs-string">&quot;data&quot;</span>]=data;<br>                send(message);<br>            &#125;<br>            <span class="hljs-keyword">function</span> klogData(data,key,value)&#123;<br>                var message=&#123;&#125;;<br>                message[<span class="hljs-string">&quot;jsname&quot;</span>]=<span class="hljs-string">&quot;jni_trace_new&quot;</span>;<br>                message[<span class="hljs-string">&quot;data&quot;</span>]=data;<br>                message[key]=value;<br>                send(message);<br>            &#125;<br><br>// Function that will process the JNICall after calculating it from<br>// the jnienv pointer <span class="hljs-keyword">in</span> args[0]<br>            <span class="hljs-keyword">function</span> hook_jni(library_name, function_name)&#123;<br>                // To get the list of exports<br>                Module.enumerateExportsSync(library_name).forEach(<span class="hljs-keyword">function</span>(symbol)&#123;<br>                    // console.log(symbol.name);<br>                    <span class="hljs-keyword">if</span>(symbol.name == function_name)&#123;<br>                        klog(<span class="hljs-string">&quot;[...] Hooking : &quot;</span> + library_name + <span class="hljs-string">&quot; -&gt; &quot;</span> + function_name + <span class="hljs-string">&quot; at &quot;</span> + symbol.address)<br>                        Interceptor.attach(symbol.address,&#123;<br>                            onEnter: <span class="hljs-keyword">function</span>(args)&#123;<br><br>                                var jnienv_addr = 0x0<br>                                Java.perform(<span class="hljs-function"><span class="hljs-title">function</span></span>()&#123;<br>                                    jnienv_addr = Java.vm.getEnv().handle.readPointer();<br>                                &#125;);<br><br><br>                                // console.log(<span class="hljs-string">&quot;[+] Hooked successfully, JNIEnv base adress :&quot;</span> + jnienv_addr)<br>                                klog(<span class="hljs-string">&quot;[+] Hooked successfully, JNIEnv base adress :&quot;</span> + jnienv_addr)<br>                                /*<br>                                 Here you can choose <span class="hljs-built_in">which</span> <span class="hljs-keyword">function</span> to hook<br>                                 Either you hook all to have an overview of the <span class="hljs-keyword">function</span> called<br>                                */<br><br>                                jni.hook_all(jnienv_addr)<br><br>                                /*<br>                                Either you hook the one you want by precising what to <span class="hljs-keyword">do</span> with it<br>                                */<br><br>                                Interceptor.attach(jni.getJNIFunctionAdress(jnienv_addr,<span class="hljs-string">&quot;FindClass&quot;</span>),&#123;<br>                                    onEnter: <span class="hljs-keyword">function</span>(args)&#123;<br>                                        klog(<span class="hljs-string">&quot;env-&gt;FindClass(\&quot;&quot;</span> + Memory.readCString(args[1]) + <span class="hljs-string">&quot;\&quot;)&quot;</span>);<br>                                    &#125;<br>                                &#125;)<br>                            &#125;,<br>                            onLeave: <span class="hljs-keyword">function</span>(args)&#123;<br>                                // Prevent from displaying junk from other <span class="hljs-built_in">functions</span><br>                                Interceptor.detachAll()<br>                                klog(<span class="hljs-string">&quot;[-] Detaching all interceptors&quot;</span>)<br>                            &#125;<br>                        &#125;)<br>                    &#125;<br>                &#125;)<br>            &#125;<br><br>            <span class="hljs-keyword">if</span>(library_name == <span class="hljs-string">&quot;&quot;</span> || function_name == <span class="hljs-string">&quot;&quot;</span>)&#123;<br>                klog(<span class="hljs-string">&quot;[-] You must provide a function name and a library name to hook&quot;</span>)<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br><br>                klogData(<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;init&quot;</span>,<span class="hljs-string">&quot;jni_trace_new.js init hook success library_name:&quot;</span>+library_name+<span class="hljs-string">&quot;,function_name:&quot;</span>+function_name);<br><br>// First Step : waiting <span class="hljs-keyword">for</span> the application to load the good library<br>// https://android.googlesource.com/platform/system/core/+/master/libnativeloader/native_loader.cpp<span class="hljs-comment">#746</span><br>//<br>// OpenNativeLibrary is called when you loadLibrary from Java, it <span class="hljs-keyword">then</span> call android_dlopen_ext<br>                var isSpawn=<span class="hljs-string">&quot;%spawn%&quot;</span>;<br>                <span class="hljs-keyword">if</span>(isSpawn)&#123;<br>                    Interceptor.attach(Module.findExportByName(null, <span class="hljs-string">&#x27;android_dlopen_ext&#x27;</span>),&#123;<br>                        onEnter: <span class="hljs-keyword">function</span>(args)&#123;<br>                            // first arg is the path to the library loaded<br>                            var library_path = Memory.readCString(args[0])<br><br>                            <span class="hljs-keyword">if</span>( library_path.includes(library_name))&#123;<br>                                klog(<span class="hljs-string">&quot;[...] Loading library : &quot;</span> + library_path)<br>                                library_loaded = 1<br>                            &#125;<br>                        &#125;,<br>                        onLeave: <span class="hljs-keyword">function</span>(args)&#123;<br><br>                            // <span class="hljs-keyword">if</span> it<span class="hljs-string">&#x27;s the library we want to hook, hooking it</span><br><span class="hljs-string">                            if(library_loaded ==  1)&#123;</span><br><span class="hljs-string">                                klog(&quot;[+] Loaded&quot;)</span><br><span class="hljs-string">                                hook_jni(library_name, function_name)</span><br><span class="hljs-string">                                library_loaded = 0</span><br><span class="hljs-string">                            &#125;</span><br><span class="hljs-string">                        &#125;</span><br><span class="hljs-string">                    &#125;)</span><br><span class="hljs-string">                &#125;else&#123;</span><br><span class="hljs-string">                    hook_jni(library_name, function_name);</span><br><span class="hljs-string">                &#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">            &#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">        &#125;,&#123;&quot;./utils/jni_struct.js&quot;:2&#125;],2:[function(require,module,exports)&#123;</span><br><span class="hljs-string">// class created from</span><br><span class="hljs-string">// struct JNINativeInterface :</span><br><span class="hljs-string">// https://android.googlesource.com/platform/libnativehelper/+/master/include_jni/jni.h#129</span><br><span class="hljs-string"></span><br><span class="hljs-string">            const jni_struct_array = [</span><br><span class="hljs-string">                &quot;reserved0&quot;,</span><br><span class="hljs-string">                &quot;reserved1&quot;,</span><br><span class="hljs-string">                &quot;reserved2&quot;,</span><br><span class="hljs-string">                &quot;reserved3&quot;,</span><br><span class="hljs-string">                &quot;GetVersion&quot;,</span><br><span class="hljs-string">                &quot;DefineClass&quot;,</span><br><span class="hljs-string">                &quot;FindClass&quot;,</span><br><span class="hljs-string">                &quot;FromReflectedMethod&quot;,</span><br><span class="hljs-string">                &quot;FromReflectedField&quot;,</span><br><span class="hljs-string">                &quot;ToReflectedMethod&quot;,</span><br><span class="hljs-string">                &quot;GetSuperclass&quot;,</span><br><span class="hljs-string">                &quot;IsAssignableFrom&quot;,</span><br><span class="hljs-string">                &quot;ToReflectedField&quot;,</span><br><span class="hljs-string">                &quot;Throw&quot;,</span><br><span class="hljs-string">                &quot;ThrowNew&quot;,</span><br><span class="hljs-string">                &quot;ExceptionOccurred&quot;,</span><br><span class="hljs-string">                &quot;ExceptionDescribe&quot;,</span><br><span class="hljs-string">                &quot;ExceptionClear&quot;,</span><br><span class="hljs-string">                &quot;FatalError&quot;,</span><br><span class="hljs-string">                &quot;PushLocalFrame&quot;,</span><br><span class="hljs-string">                &quot;PopLocalFrame&quot;,</span><br><span class="hljs-string">                &quot;NewGlobalRef&quot;,</span><br><span class="hljs-string">                &quot;DeleteGlobalRef&quot;,</span><br><span class="hljs-string">                &quot;DeleteLocalRef&quot;,</span><br><span class="hljs-string">                &quot;IsSameObject&quot;,</span><br><span class="hljs-string">                &quot;NewLocalRef&quot;,</span><br><span class="hljs-string">                &quot;EnsureLocalCapacity&quot;,</span><br><span class="hljs-string">                &quot;AllocObject&quot;,</span><br><span class="hljs-string">                &quot;NewObject&quot;,</span><br><span class="hljs-string">                &quot;NewObjectV&quot;,</span><br><span class="hljs-string">                &quot;NewObjectA&quot;,</span><br><span class="hljs-string">                &quot;GetObjectClass&quot;,</span><br><span class="hljs-string">                &quot;IsInstanceOf&quot;,</span><br><span class="hljs-string">                &quot;GetMethodID&quot;,</span><br><span class="hljs-string">                &quot;CallObjectMethod&quot;,</span><br><span class="hljs-string">                &quot;CallObjectMethodV&quot;,</span><br><span class="hljs-string">                &quot;CallObjectMethodA&quot;,</span><br><span class="hljs-string">                &quot;CallBooleanMethod&quot;,</span><br><span class="hljs-string">                &quot;CallBooleanMethodV&quot;,</span><br><span class="hljs-string">                &quot;CallBooleanMethodA&quot;,</span><br><span class="hljs-string">                &quot;CallByteMethod&quot;,</span><br><span class="hljs-string">                &quot;CallByteMethodV&quot;,</span><br><span class="hljs-string">                &quot;CallByteMethodA&quot;,</span><br><span class="hljs-string">                &quot;CallCharMethod&quot;,</span><br><span class="hljs-string">                &quot;CallCharMethodV&quot;,</span><br><span class="hljs-string">                &quot;CallCharMethodA&quot;,</span><br><span class="hljs-string">                &quot;CallShortMethod&quot;,</span><br><span class="hljs-string">                &quot;CallShortMethodV&quot;,</span><br><span class="hljs-string">                &quot;CallShortMethodA&quot;,</span><br><span class="hljs-string">                &quot;CallIntMethod&quot;,</span><br><span class="hljs-string">                &quot;CallIntMethodV&quot;,</span><br><span class="hljs-string">                &quot;CallIntMethodA&quot;,</span><br><span class="hljs-string">                &quot;CallLongMethod&quot;,</span><br><span class="hljs-string">                &quot;CallLongMethodV&quot;,</span><br><span class="hljs-string">                &quot;CallLongMethodA&quot;,</span><br><span class="hljs-string">                &quot;CallFloatMethod&quot;,</span><br><span class="hljs-string">                &quot;CallFloatMethodV&quot;,</span><br><span class="hljs-string">                &quot;CallFloatMethodA&quot;,</span><br><span class="hljs-string">                &quot;CallDoubleMethod&quot;,</span><br><span class="hljs-string">                &quot;CallDoubleMethodV&quot;,</span><br><span class="hljs-string">                &quot;CallDoubleMethodA&quot;,</span><br><span class="hljs-string">                &quot;CallVoidMethod&quot;,</span><br><span class="hljs-string">                &quot;CallVoidMethodV&quot;,</span><br><span class="hljs-string">                &quot;CallVoidMethodA&quot;,</span><br><span class="hljs-string">                &quot;CallNonvirtualObjectMethod&quot;,</span><br><span class="hljs-string">                &quot;CallNonvirtualObjectMethodV&quot;,</span><br><span class="hljs-string">                &quot;CallNonvirtualObjectMethodA&quot;,</span><br><span class="hljs-string">                &quot;CallNonvirtualBooleanMethod&quot;,</span><br><span class="hljs-string">                &quot;CallNonvirtualBooleanMethodV&quot;,</span><br><span class="hljs-string">                &quot;CallNonvirtualBooleanMethodA&quot;,</span><br><span class="hljs-string">                &quot;CallNonvirtualByteMethod&quot;,</span><br><span class="hljs-string">                &quot;CallNonvirtualByteMethodV&quot;,</span><br><span class="hljs-string">                &quot;CallNonvirtualByteMethodA&quot;,</span><br><span class="hljs-string">                &quot;CallNonvirtualCharMethod&quot;,</span><br><span class="hljs-string">                &quot;CallNonvirtualCharMethodV&quot;,</span><br><span class="hljs-string">                &quot;CallNonvirtualCharMethodA&quot;,</span><br><span class="hljs-string">                &quot;CallNonvirtualShortMethod&quot;,</span><br><span class="hljs-string">                &quot;CallNonvirtualShortMethodV&quot;,</span><br><span class="hljs-string">                &quot;CallNonvirtualShortMethodA&quot;,</span><br><span class="hljs-string">                &quot;CallNonvirtualIntMethod&quot;,</span><br><span class="hljs-string">                &quot;CallNonvirtualIntMethodV&quot;,</span><br><span class="hljs-string">                &quot;CallNonvirtualIntMethodA&quot;,</span><br><span class="hljs-string">                &quot;CallNonvirtualLongMethod&quot;,</span><br><span class="hljs-string">                &quot;CallNonvirtualLongMethodV&quot;,</span><br><span class="hljs-string">                &quot;CallNonvirtualLongMethodA&quot;,</span><br><span class="hljs-string">                &quot;CallNonvirtualFloatMethod&quot;,</span><br><span class="hljs-string">                &quot;CallNonvirtualFloatMethodV&quot;,</span><br><span class="hljs-string">                &quot;CallNonvirtualFloatMethodA&quot;,</span><br><span class="hljs-string">                &quot;CallNonvirtualDoubleMethod&quot;,</span><br><span class="hljs-string">                &quot;CallNonvirtualDoubleMethodV&quot;,</span><br><span class="hljs-string">                &quot;CallNonvirtualDoubleMethodA&quot;,</span><br><span class="hljs-string">                &quot;CallNonvirtualVoidMethod&quot;,</span><br><span class="hljs-string">                &quot;CallNonvirtualVoidMethodV&quot;,</span><br><span class="hljs-string">                &quot;CallNonvirtualVoidMethodA&quot;,</span><br><span class="hljs-string">                &quot;GetFieldID&quot;,</span><br><span class="hljs-string">                &quot;GetObjectField&quot;,</span><br><span class="hljs-string">                &quot;GetBooleanField&quot;,</span><br><span class="hljs-string">                &quot;GetByteField&quot;,</span><br><span class="hljs-string">                &quot;GetCharField&quot;,</span><br><span class="hljs-string">                &quot;GetShortField&quot;,</span><br><span class="hljs-string">                &quot;GetIntField&quot;,</span><br><span class="hljs-string">                &quot;GetLongField&quot;,</span><br><span class="hljs-string">                &quot;GetFloatField&quot;,</span><br><span class="hljs-string">                &quot;GetDoubleField&quot;,</span><br><span class="hljs-string">                &quot;SetObjectField&quot;,</span><br><span class="hljs-string">                &quot;SetBooleanField&quot;,</span><br><span class="hljs-string">                &quot;SetByteField&quot;,</span><br><span class="hljs-string">                &quot;SetCharField&quot;,</span><br><span class="hljs-string">                &quot;SetShortField&quot;,</span><br><span class="hljs-string">                &quot;SetIntField&quot;,</span><br><span class="hljs-string">                &quot;SetLongField&quot;,</span><br><span class="hljs-string">                &quot;SetFloatField&quot;,</span><br><span class="hljs-string">                &quot;SetDoubleField&quot;,</span><br><span class="hljs-string">                &quot;GetStaticMethodID&quot;,</span><br><span class="hljs-string">                &quot;CallStaticObjectMethod&quot;,</span><br><span class="hljs-string">                &quot;CallStaticObjectMethodV&quot;,</span><br><span class="hljs-string">                &quot;CallStaticObjectMethodA&quot;,</span><br><span class="hljs-string">                &quot;CallStaticBooleanMethod&quot;,</span><br><span class="hljs-string">                &quot;CallStaticBooleanMethodV&quot;,</span><br><span class="hljs-string">                &quot;CallStaticBooleanMethodA&quot;,</span><br><span class="hljs-string">                &quot;CallStaticByteMethod&quot;,</span><br><span class="hljs-string">                &quot;CallStaticByteMethodV&quot;,</span><br><span class="hljs-string">                &quot;CallStaticByteMethodA&quot;,</span><br><span class="hljs-string">                &quot;CallStaticCharMethod&quot;,</span><br><span class="hljs-string">                &quot;CallStaticCharMethodV&quot;,</span><br><span class="hljs-string">                &quot;CallStaticCharMethodA&quot;,</span><br><span class="hljs-string">                &quot;CallStaticShortMethod&quot;,</span><br><span class="hljs-string">                &quot;CallStaticShortMethodV&quot;,</span><br><span class="hljs-string">                &quot;CallStaticShortMethodA&quot;,</span><br><span class="hljs-string">                &quot;CallStaticIntMethod&quot;,</span><br><span class="hljs-string">                &quot;CallStaticIntMethodV&quot;,</span><br><span class="hljs-string">                &quot;CallStaticIntMethodA&quot;,</span><br><span class="hljs-string">                &quot;CallStaticLongMethod&quot;,</span><br><span class="hljs-string">                &quot;CallStaticLongMethodV&quot;,</span><br><span class="hljs-string">                &quot;CallStaticLongMethodA&quot;,</span><br><span class="hljs-string">                &quot;CallStaticFloatMethod&quot;,</span><br><span class="hljs-string">                &quot;CallStaticFloatMethodV&quot;,</span><br><span class="hljs-string">                &quot;CallStaticFloatMethodA&quot;,</span><br><span class="hljs-string">                &quot;CallStaticDoubleMethod&quot;,</span><br><span class="hljs-string">                &quot;CallStaticDoubleMethodV&quot;,</span><br><span class="hljs-string">                &quot;CallStaticDoubleMethodA&quot;,</span><br><span class="hljs-string">                &quot;CallStaticVoidMethod&quot;,</span><br><span class="hljs-string">                &quot;CallStaticVoidMethodV&quot;,</span><br><span class="hljs-string">                &quot;CallStaticVoidMethodA&quot;,</span><br><span class="hljs-string">                &quot;GetStaticFieldID&quot;,</span><br><span class="hljs-string">                &quot;GetStaticObjectField&quot;,</span><br><span class="hljs-string">                &quot;GetStaticBooleanField&quot;,</span><br><span class="hljs-string">                &quot;GetStaticByteField&quot;,</span><br><span class="hljs-string">                &quot;GetStaticCharField&quot;,</span><br><span class="hljs-string">                &quot;GetStaticShortField&quot;,</span><br><span class="hljs-string">                &quot;GetStaticIntField&quot;,</span><br><span class="hljs-string">                &quot;GetStaticLongField&quot;,</span><br><span class="hljs-string">                &quot;GetStaticFloatField&quot;,</span><br><span class="hljs-string">                &quot;GetStaticDoubleField&quot;,</span><br><span class="hljs-string">                &quot;SetStaticObjectField&quot;,</span><br><span class="hljs-string">                &quot;SetStaticBooleanField&quot;,</span><br><span class="hljs-string">                &quot;SetStaticByteField&quot;,</span><br><span class="hljs-string">                &quot;SetStaticCharField&quot;,</span><br><span class="hljs-string">                &quot;SetStaticShortField&quot;,</span><br><span class="hljs-string">                &quot;SetStaticIntField&quot;,</span><br><span class="hljs-string">                &quot;SetStaticLongField&quot;,</span><br><span class="hljs-string">                &quot;SetStaticFloatField&quot;,</span><br><span class="hljs-string">                &quot;SetStaticDoubleField&quot;,</span><br><span class="hljs-string">                &quot;NewString&quot;,</span><br><span class="hljs-string">                &quot;GetStringLength&quot;,</span><br><span class="hljs-string">                &quot;GetStringChars&quot;,</span><br><span class="hljs-string">                &quot;ReleaseStringChars&quot;,</span><br><span class="hljs-string">                &quot;NewStringUTF&quot;,</span><br><span class="hljs-string">                &quot;GetStringUTFLength&quot;,</span><br><span class="hljs-string">                &quot;GetStringUTFChars&quot;,</span><br><span class="hljs-string">                &quot;ReleaseStringUTFChars&quot;,</span><br><span class="hljs-string">                &quot;GetArrayLength&quot;,</span><br><span class="hljs-string">                &quot;NewObjectArray&quot;,</span><br><span class="hljs-string">                &quot;GetObjectArrayElement&quot;,</span><br><span class="hljs-string">                &quot;SetObjectArrayElement&quot;,</span><br><span class="hljs-string">                &quot;NewBooleanArray&quot;,</span><br><span class="hljs-string">                &quot;NewByteArray&quot;,</span><br><span class="hljs-string">                &quot;NewCharArray&quot;,</span><br><span class="hljs-string">                &quot;NewShortArray&quot;,</span><br><span class="hljs-string">                &quot;NewIntArray&quot;,</span><br><span class="hljs-string">                &quot;NewLongArray&quot;,</span><br><span class="hljs-string">                &quot;NewFloatArray&quot;,</span><br><span class="hljs-string">                &quot;NewDoubleArray&quot;,</span><br><span class="hljs-string">                &quot;GetBooleanArrayElements&quot;,</span><br><span class="hljs-string">                &quot;GetByteArrayElements&quot;,</span><br><span class="hljs-string">                &quot;GetCharArrayElements&quot;,</span><br><span class="hljs-string">                &quot;GetShortArrayElements&quot;,</span><br><span class="hljs-string">                &quot;GetIntArrayElements&quot;,</span><br><span class="hljs-string">                &quot;GetLongArrayElements&quot;,</span><br><span class="hljs-string">                &quot;GetFloatArrayElements&quot;,</span><br><span class="hljs-string">                &quot;GetDoubleArrayElements&quot;,</span><br><span class="hljs-string">                &quot;ReleaseBooleanArrayElements&quot;,</span><br><span class="hljs-string">                &quot;ReleaseByteArrayElements&quot;,</span><br><span class="hljs-string">                &quot;ReleaseCharArrayElements&quot;,</span><br><span class="hljs-string">                &quot;ReleaseShortArrayElements&quot;,</span><br><span class="hljs-string">                &quot;ReleaseIntArrayElements&quot;,</span><br><span class="hljs-string">                &quot;ReleaseLongArrayElements&quot;,</span><br><span class="hljs-string">                &quot;ReleaseFloatArrayElements&quot;,</span><br><span class="hljs-string">                &quot;ReleaseDoubleArrayElements&quot;,</span><br><span class="hljs-string">                &quot;GetBooleanArrayRegion&quot;,</span><br><span class="hljs-string">                &quot;GetByteArrayRegion&quot;,</span><br><span class="hljs-string">                &quot;GetCharArrayRegion&quot;,</span><br><span class="hljs-string">                &quot;GetShortArrayRegion&quot;,</span><br><span class="hljs-string">                &quot;GetIntArrayRegion&quot;,</span><br><span class="hljs-string">                &quot;GetLongArrayRegion&quot;,</span><br><span class="hljs-string">                &quot;GetFloatArrayRegion&quot;,</span><br><span class="hljs-string">                &quot;GetDoubleArrayRegion&quot;,</span><br><span class="hljs-string">                &quot;SetBooleanArrayRegion&quot;,</span><br><span class="hljs-string">                &quot;SetByteArrayRegion&quot;,</span><br><span class="hljs-string">                &quot;SetCharArrayRegion&quot;,</span><br><span class="hljs-string">                &quot;SetShortArrayRegion&quot;,</span><br><span class="hljs-string">                &quot;SetIntArrayRegion&quot;,</span><br><span class="hljs-string">                &quot;SetLongArrayRegion&quot;,</span><br><span class="hljs-string">                &quot;SetFloatArrayRegion&quot;,</span><br><span class="hljs-string">                &quot;SetDoubleArrayRegion&quot;,</span><br><span class="hljs-string">                &quot;RegisterNatives&quot;,</span><br><span class="hljs-string">                &quot;UnregisterNatives&quot;,</span><br><span class="hljs-string">                &quot;MonitorEnter&quot;,</span><br><span class="hljs-string">                &quot;MonitorExit&quot;,</span><br><span class="hljs-string">                &quot;GetJavaVM&quot;,</span><br><span class="hljs-string">                &quot;GetStringRegion&quot;,</span><br><span class="hljs-string">                &quot;GetStringUTFRegion&quot;,</span><br><span class="hljs-string">                &quot;GetPrimitiveArrayCritical&quot;,</span><br><span class="hljs-string">                &quot;ReleasePrimitiveArrayCritical&quot;,</span><br><span class="hljs-string">                &quot;GetStringCritical&quot;,</span><br><span class="hljs-string">                &quot;ReleaseStringCritical&quot;,</span><br><span class="hljs-string">                &quot;NewWeakGlobalRef&quot;,</span><br><span class="hljs-string">                &quot;DeleteWeakGlobalRef&quot;,</span><br><span class="hljs-string">                &quot;ExceptionCheck&quot;,</span><br><span class="hljs-string">                &quot;NewDirectByteBuffer&quot;,</span><br><span class="hljs-string">                &quot;GetDirectBufferAddress&quot;,</span><br><span class="hljs-string">                &quot;GetDirectBufferCapacity&quot;,</span><br><span class="hljs-string">                &quot;GetObjectRefType&quot;</span><br><span class="hljs-string">            ]</span><br><span class="hljs-string"></span><br><span class="hljs-string">            /*</span><br><span class="hljs-string">            Calculate the given funcName address from the JNIEnv pointer</span><br><span class="hljs-string">            */</span><br><span class="hljs-string">            function getJNIFunctionAdress(jnienv_addr,func_name)&#123;</span><br><span class="hljs-string">                var offset = jni_struct_array.indexOf(func_name) * Process.pointerSize</span><br><span class="hljs-string"></span><br><span class="hljs-string">                // console.log(&quot;offset : 0x&quot; + offset.toString(16))</span><br><span class="hljs-string"></span><br><span class="hljs-string">                return Memory.readPointer(jnienv_addr.add(offset))</span><br><span class="hljs-string">            &#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">// Hook all function to have an overview of the function called</span><br><span class="hljs-string">            function hook_all(jnienv_addr)&#123;</span><br><span class="hljs-string">                jni_struct_array.forEach(function(func_name)&#123;</span><br><span class="hljs-string">                    // Calculating the address of the function</span><br><span class="hljs-string">                    if(!func_name.includes(&quot;reserved&quot;))</span><br><span class="hljs-string">                    &#123;</span><br><span class="hljs-string">                        var func_addr = getJNIFunctionAdress(jnienv_addr,func_name)</span><br><span class="hljs-string">                        Interceptor.attach(func_addr,&#123;</span><br><span class="hljs-string">                            onEnter: function(args)&#123;</span><br><span class="hljs-string">                                klog(&quot;[+] Entered : &quot; + func_name)</span><br><span class="hljs-string">                            &#125;</span><br><span class="hljs-string">                        &#125;)</span><br><span class="hljs-string">                    &#125;</span><br><span class="hljs-string">                &#125;)</span><br><span class="hljs-string">            &#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">            exports.getJNIFunctionAdress = getJNIFunctionAdress</span><br><span class="hljs-string">            exports.hook_all = hook_all</span><br><span class="hljs-string">        &#125;,&#123;&#125;]&#125;,&#123;&#125;,[1])</span><br><span class="hljs-string"></span><br><span class="hljs-string">&#125;)();</span><br></code></pre></td></tr></table></figure>


<h1 id="frida-的一些简单检测方式"><a href="#frida-的一些简单检测方式" class="headerlink" title="frida 的一些简单检测方式"></a>frida 的一些简单检测方式</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs bash">//frida 检测相关的方法<br>/**<br> * 1.ptrace 占坑<br> * 在函数开始时 自己执行 ptrace(0,0,0,0);<br> * 因为一个进程只能附加一次 自己附加自己 frida 和ida就不能进行附加了<br> * 经典报错 Failed to attach: unable to access process with pid xxx due to system restrictions: try <span class="hljs-string">&#x27;sudo sysctl kernel.yama.ptrace_scope=0&#x27;</span> , or run Frida as root<br> * 就是自己的app已经被别的app注入了  可以使用 frida -U -f 启动前就进行附加 自己附加了 ptrace占坑就没效果了<br> * 开启一个子进程附加父进程  代表：梆梆加固<br> *    守护进程<br> *    子进程附加父进程 目的是不让别人附加<br> *    普通的多进程<br> *    如果进程已经有两个同名的进程了可以通过pid注入 因为有两个包名一样的进程 可以通过 -p注入<br> * 2.进程名检测，遍历运行的进程列表，检测frida-server是否运行  如果开启了fridaserver在进程中是存在的<br> * 3. 端口检测，检测frida-server默认端口27042是否开放  frida 默认的端口是27042 修改了27042就可以了<br> *<br> * 4. D-Bus协议通信<br> * ps -A|grep packg<br> * Frida使用D-Bus协议通信，可以遍历/proc/net/tcp文件，或者直接从0-65535<br> * 向每个开放的端口发送D-Bus认证消息，哪个端口回复了REJECT，就是frida-server<br> *<br> * 5.扫描maps文件<br> * maps文件用于显示当前app中加载的依赖库<br> * Frida在运行时会先确定路径下是否有re.frida.server文件夹<br> * 若没有则创建该文件夹并存放frida-agent.so等文件，该so会出现在maps文件中<br> *<br> * 6. 扫描task目录<br> * 扫描目录下所有/task/pid/status中的Name字段<br> * 寻找是否存在frida注入的特征<br> * 具体线程名为gmain、gdbus、gum-js-loop、pool-frida等<br> *<br> * 7. 通过<span class="hljs-built_in">readlink</span>查看/proc/self/fd、/proc/self/task/pid/fd下所有打开的文件，检测是否有Frida相关文件<br> *<br> * 8. 常见用于检测的系统函数<br> * strstr、strcmp、open、<span class="hljs-built_in">read</span>、fread、<span class="hljs-built_in">readlink</span><br> *<br> * 9. 扫描内存中是否有Frida库特征出现，例如字符串LIBFRIDA<br> *<br> *<br> * 1. 双进程，子进程附加主进程的问题<br> * 守护进程<br> * 占坑，为了防止调试<br> * 程序自身确实需要双进程<br> * 可以以pid的方式注入，也可以spawn方式启动<br> * 2. Hook dlopen可以用来查看，加载哪个so时程序退出<br> * 3. Hook pthread_create查看为哪些函数开启了子线程<br> * 4. Hook strstr、strcmp等比较字符串的函数，查看是否存在关键字<br> * 5. 常见检测关键字<br> * tmp、frida、gum-js-loop、gmain、linjector<br> * 6. 不建议直接在strstr、strcmp中修改<br> * 7. Hook open可以用来查看，访问了哪些文件<br> * 监控open执行，查看读取maps、task等敏感文件<br> * 主动读取这些文件，并把除去包含关键字的行，保存到新文件中<br> * 将open打开的文件，指向新文件<br> * 8. Hook常用系统函数，打印函数栈，去对应的检测so中分析代码<br> * 9. 其他常见需要Hook的函数 <span class="hljs-built_in">readlink</span><br> *<br> * 1. 通常比较会被检测的文件<br> * riru的特征文件<br> * /system/lib/libmemtrack.so<br> * /system/lib/libmemtrack_real.so<br> * cmdline 检测进程名，防重打包<br> * status 检测进程是否被附加  S 没有被调试<br> * <span class="hljs-built_in">stat</span> 检测进程是否被附加  S 没有被调试<br> * task/xxx/cmdline 检测进程名，防重打包<br> * task/xxx/stat 检测进程是否被附加<br> * task/xxx/status 检测线程name是否包含Frida关键字<br> * fd/xxx 检测app是否打开的Frida相关文件<br> * maps 检测app是否加载的依赖库里是否有Frida<br> * net/tcp 检测app打开的端口<br> *<br> *<br> *<br> */<br><br></code></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">听说你是小兔叽</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2022/11/29/frida%E5%B8%B8%E7%94%A8%E4%BB%A3%E7%A0%81/">http://example.com/2022/11/29/frida%E5%B8%B8%E7%94%A8%E4%BB%A3%E7%A0%81/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">听说你是小兔叽的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/frida/">frida</a><a class="post-meta__tags" href="/tags/%E5%9F%BA%E7%A1%80/">基础</a></div><div class="post_share"><div class="social-share" data-image="/img/5521.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2022/11/15/frida%E7%BC%96%E8%AF%91%E8%BF%87%E6%A3%80%E6%B5%8B/"><img class="next-cover" src="/img/5520.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">frida编译过检测</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/06/26/Frida%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0/" title="Frida工作原理学习"><img class="cover" src="/img/5522.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-06-26</div><div class="title">Frida工作原理学习</div></div></a></div><div><a href="/2022/11/15/frida%E7%BC%96%E8%AF%91%E8%BF%87%E6%A3%80%E6%B5%8B/" title="frida编译过检测"><img class="cover" src="/img/5520.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-11-15</div><div class="title">frida编译过检测</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#JAVA"><span class="toc-number">1.</span> <span class="toc-text">JAVA</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E4%BB%A3%E7%A0%81"><span class="toc-number">1.1.</span> <span class="toc-text">常用代码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E5%87%BD%E6%95%B0hook"><span class="toc-number">1.1.1.</span> <span class="toc-text">普通函数hook</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E5%90%8D%E6%88%96%E8%80%85%E7%B1%BB%E5%90%8D%E5%8A%A0%E5%AF%86%E5%87%BD%E6%95%B0"><span class="toc-number">1.1.2.</span> <span class="toc-text">函数名或者类名加密函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#frida-%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8"><span class="toc-number">1.1.3.</span> <span class="toc-text">frida 主动调用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E5%87%BD%E6%95%B0"><span class="toc-number">1.1.3.1.</span> <span class="toc-text">静态函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%9E%E9%9D%99%E6%80%81%E5%87%BD%E6%95%B0"><span class="toc-number">1.1.3.2.</span> <span class="toc-text">非静态函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A0%86%E6%A0%88%E4%BB%A3%E7%A0%81%E7%9A%84%E6%89%93%E5%8D%B0-%E6%89%93%E5%8D%B0%E5%BC%82%E5%B8%B8%E8%BE%93%E5%87%BA%E4%BF%A1%E6%81%AF"><span class="toc-number">1.1.4.</span> <span class="toc-text">堆栈代码的打印 打印异常输出信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hookMethods"><span class="toc-number">1.1.5.</span> <span class="toc-text">hookMethods</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#enumclass"><span class="toc-number">1.1.6.</span> <span class="toc-text">enumclass</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5dex"><span class="toc-number">1.1.7.</span> <span class="toc-text">注入dex</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8activity"><span class="toc-number">1.1.8.</span> <span class="toc-text">启动activity</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#getContext"><span class="toc-number">1.1.9.</span> <span class="toc-text">getContext</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="toc-number">1.1.10.</span> <span class="toc-text">类型转换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E6%95%B0%E7%BB%84"><span class="toc-number">1.1.11.</span> <span class="toc-text">构造数组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BDso"><span class="toc-number">1.1.12.</span> <span class="toc-text">加载so</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%9A%84%E5%AE%9A%E4%BD%8D%E6%89%8B%E6%AE%B5"><span class="toc-number">1.2.</span> <span class="toc-text">常用的定位手段</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%BD%8D%E5%BC%B9%E7%AA%97"><span class="toc-number">1.2.1.</span> <span class="toc-text">定位弹窗</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#String%E7%9A%84getBytes%E3%80%81isEmpty%E6%96%B9%E6%B3%95"><span class="toc-number">1.2.2.</span> <span class="toc-text">String的getBytes、isEmpty方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#getContext-1"><span class="toc-number">1.2.3.</span> <span class="toc-text">getContext</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hookJSON"><span class="toc-number">1.2.4.</span> <span class="toc-text">hookJSON</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hook%E5%8A%A0%E5%9B%BA%E7%9A%84app"><span class="toc-number">1.2.5.</span> <span class="toc-text">hook加固的app</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#java%E5%B1%82%E7%9A%84%E5%90%84%E7%A7%8D%E5%A5%BD%E7%94%A8%E5%B7%A5%E5%85%B7"><span class="toc-number">1.3.</span> <span class="toc-text">java层的各种好用工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#r0trace-%E8%82%89%E4%B8%9D%E5%A4%A7%E4%BD%AC"><span class="toc-number">1.3.1.</span> <span class="toc-text">r0trace   肉丝大佬</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dump%E8%AF%81%E4%B9%A6"><span class="toc-number">1.3.2.</span> <span class="toc-text">dump证书</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#r0capture"><span class="toc-number">1.3.3.</span> <span class="toc-text">r0capture</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SO"><span class="toc-number">2.</span> <span class="toc-text">SO</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E4%BB%A3%E7%A0%81-1"><span class="toc-number">2.1.</span> <span class="toc-text">常用代码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%8D%B0%E5%A0%86%E6%A0%88"><span class="toc-number">2.1.1.</span> <span class="toc-text">打印堆栈</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hook%E6%9F%90%E6%A8%A1%E5%9D%97%E6%9F%90%E5%9C%B0%E5%9D%80-%E5%8A%A0%E5%8F%82%E6%95%B0"><span class="toc-number">2.1.2.</span> <span class="toc-text">hook某模块某地址 加参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%95%B0%E5%80%BC%E5%8F%82%E6%95%B0%E7%9A%84%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="toc-number">2.1.3.</span> <span class="toc-text">修改数值参数的返回值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%BD%8D%E5%87%BD%E6%95%B0"><span class="toc-number">2.1.4.</span> <span class="toc-text">定位函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%9A%E4%B8%BE%E5%AF%BC%E5%85%A5-%E5%AF%BC%E5%87%BA%E8%A1%A8%E6%89%80%E6%9C%89%E5%87%BD%E6%95%B0"><span class="toc-number">2.1.5.</span> <span class="toc-text">枚举导入 导出表所有函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dumpSo"><span class="toc-number">2.1.6.</span> <span class="toc-text">dumpSo</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%BF%E6%8D%A2%E6%9F%90%E5%9C%B0%E5%9D%80%E6%9C%BA%E5%99%A8%E7%A0%81"><span class="toc-number">2.1.7.</span> <span class="toc-text">替换某地址机器码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8c%E5%87%BD%E6%95%B0"><span class="toc-number">2.1.8.</span> <span class="toc-text">主动调用c函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%99%E6%96%87%E4%BB%B6"><span class="toc-number">2.1.9.</span> <span class="toc-text">写文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8frida%E5%B0%81%E8%A3%85%E7%9A%84%E5%87%BD%E6%95%B0%E6%9D%A5%E8%B0%83%E7%94%A8jni"><span class="toc-number">2.1.10.</span> <span class="toc-text">使用frida封装的函数来调用jni</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NativeFunction%E6%96%B9%E5%BC%8F%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8"><span class="toc-number">2.1.11.</span> <span class="toc-text">NativeFunction方式主动调用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E7%BA%A7%E6%8C%87%E9%92%88%E7%9A%84hook"><span class="toc-number">2.1.12.</span> <span class="toc-text">二级指针的hook</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hook-init-array"><span class="toc-number">2.1.13.</span> <span class="toc-text">hook init_array</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hook-jnionLoad"><span class="toc-number">2.1.14.</span> <span class="toc-text">hook jnionLoad</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Frida-%E5%AE%9E%E7%8E%B0%E7%9A%84%E5%86%85%E5%AD%98%E8%AF%BB%E5%86%99%E7%9B%91%E6%8E%A7"><span class="toc-number">2.1.15.</span> <span class="toc-text">Frida 实现的内存读写监控</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#frida-%E5%86%85%E5%AD%98%E6%A3%80%E7%B4%A2"><span class="toc-number">2.1.16.</span> <span class="toc-text">frida 内存检索</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E7%BA%BF%E7%A8%8Bid"><span class="toc-number">2.1.17.</span> <span class="toc-text">获取当前线程id</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#so%E5%B1%82%E7%9A%84%E5%A5%BD%E7%94%A8%E5%B7%A5%E5%85%B7"><span class="toc-number">2.2.</span> <span class="toc-text">so层的好用工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#hook-art-imyang"><span class="toc-number">2.2.1.</span> <span class="toc-text">hook_art         @imyang</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%86%85%E5%AD%98%E4%B8%AD%E6%90%9C%E7%B4%A2svc%E6%8C%87%E4%BB%A4%E6%8F%90%E5%89%8D%E8%BF%9B%E8%A1%8C-patch"><span class="toc-number">2.2.2.</span> <span class="toc-text">从内存中搜索svc指令提前进行 patch</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87-linke%E5%AF%B9so%E5%8A%A0%E8%BD%BD%E8%BF%9B%E8%A1%8C%E7%9B%91%E6%8E%A7"><span class="toc-number">2.2.3.</span> <span class="toc-text">通过 linke对so加载进行监控</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Stalker-Trace-%E5%AF%B9%E7%9D%80%E5%AD%A6stalker%E6%97%B6%E5%86%99%E7%9A%84%E4%B8%80%E4%B8%AA%E5%B0%8F%E8%84%9A%E6%9C%AC%E5%8F%AF%E4%BB%A5%E5%92%8Cida-trace%E4%B8%80%E6%A0%B7%E8%BE%93%E5%87%BA"><span class="toc-number">2.2.4.</span> <span class="toc-text">Stalker Trace    对着学stalker时写的一个小脚本可以和ida trace一样输出</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#frida-seccomp-%E6%8B%A6%E6%88%AAsvc"><span class="toc-number">2.2.5.</span> <span class="toc-text">frida + seccomp     拦截svc</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jniTrace"><span class="toc-number">2.2.6.</span> <span class="toc-text">jniTrace</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#frida-%E7%9A%84%E4%B8%80%E4%BA%9B%E7%AE%80%E5%8D%95%E6%A3%80%E6%B5%8B%E6%96%B9%E5%BC%8F"><span class="toc-number">3.</span> <span class="toc-text">frida 的一些简单检测方式</span></a></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By 听说你是小兔叽</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk(Object.assign({
      clientID: '1b2ada67a8742b0079ce',
      clientSecret: '376bf937f2dacbc08bc3ccfdf2f80cd6b3246980',
      repo: 'xiaotujinbnb.github.io',
      owner: 'xiaotujinbnb',
      admin: ['xiaotujinbnb'],
      id: '3876d134865ba97bdcf73b23b4479535',
      updateCountCallback: commentCount
    },null))

    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    getScript('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js').then(initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Gitalk' === 'Gitalk' || !false) {
  if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>